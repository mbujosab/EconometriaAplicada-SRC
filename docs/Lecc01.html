<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es-es" xml:lang="es-es">
<head>
<!-- 2024-08-27 mar 22:29 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Econometría Aplicada. Lección 1</title>
<meta name="author" content="Marcos Bujosa" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Econometría Aplicada. Lección 1</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org43fd9d4">Carga de algunos módulos de python</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf005a99">1. Procesos estocásticos y datos de series temporales</a>
<ul>
<li><a href="#orgcc6281d">1.1. Datos de sección cruzada vs datos de series temporales</a></li>
<li><a href="#org811b7b8">1.2. El desafío</a></li>
</ul>
</li>
<li><a href="#orgf24d349">2. Estacionariedad</a>
<ul>
<li><a href="#org67d5e18">2.1. Estacionariedad en sentido débil</a></li>
<li><a href="#org1f93747">2.2. Función de autocovarianzas y función de autocorrelación</a></li>
</ul>
</li>
<li><a href="#org821b5f0">3. Transformaciones de realizaciones de procesos estocásticos NO estacionarios</a>
<ul>
<li><a href="#org791e80c">3.1. Internat. airline passengers: monthly totals in thousands. Jan 49 – Dec 60</a>
<ul>
<li><a href="#orge59ac3e">3.1.1. Trasformación logarítmica de los datos</a></li>
<li><a href="#orgc67d797">3.1.2. Primera diferencia del logarítmo de los datos</a></li>
<li><a href="#orgd25965c">3.1.3. Diferencia estacional de la primera diferencia del logarítmo de los datos</a></li>
</ul>
</li>
<li><a href="#orgf3a224f">3.2. Tasa logarítmica de crecimiento</a>
<ul>
<li><a href="#org3244b9f">3.2.1. Comentarios sobre los datos transformados</a></li>
</ul>
</div>
</div>
<div class="ABSTRACT" id="org3dedc1c">
<p>
En esta lección veremos algunos transformaciones de los datos para
<i>"hacerlos estacionarios"</i>.
</p>

</div>

<ul class="org-ul">
<li><a href="https://mbujosab.github.io/EconometriaAplicada-SRC/Lecc01.html">lección en html</a></li>
<li><a href="https://mybinder.org/v2/gh/mbujosab/EconometriaAplicada-SRC/HEAD?labpath=Lecc01.ipynb">lección en mybinder</a></li>
</ul>
<div id="outline-container-org43fd9d4" class="outline-4">
<h4 id="org43fd9d4">Carga de algunos módulos de python</h4>
<div class="outline-text-4" id="text-org43fd9d4">
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Para trabajar con los datos y dibujarlos necesitamos cargar algunos m&#243;dulos de python</span>
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">linear algebra</span>
<span style="color: #0000FF;">import</span> pandas <span style="color: #0000FF;">as</span> pd <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">data processing, CSV file I/O (e.g. pd.read_csv)</span>
<span style="color: #0000FF;">import</span> matplotlib <span style="color: #0000FF;">as</span> mpl
mpl.rc(<span style="color: #008000;">'text'</span>, usetex=<span style="color: #D0372D;">True</span>)
mpl.rc(<span style="color: #008000;">'text.latex'</span>, preamble=r<span style="color: #008000;">'\usepackage{amsmath}'</span>)
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">data visualization</span>
<span style="color: #0000FF;">import</span> dataframe_image <span style="color: #0000FF;">as</span> dfi
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">from</span> sympy.printing.preview <span style="color: #0000FF;">import</span> preview

<span style="color: #0000FF;">def</span> <span style="color: #006699;">repr_png</span>(tex, ImgFile):
    <span style="color: #BA36A5;">preamble</span> = <span style="color: #008000;">"</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">documentclass[preview]{standalone}</span><span style="color: #D0372D;">\n</span><span style="color: #008000;">"</span> \
        <span style="color: #008000;">"</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">usepackage{booktabs,amsmath,amsfonts}</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">begin{document}"</span>    
    preview(tex, filename=ImgFile, viewer=<span style="color: #008000;">'file'</span>, preamble=preamble, dvioptions=[<span style="color: #008000;">'-D'</span>,<span style="color: #008000;">'250'</span>])
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf005a99" class="outline-2">
<h2 id="orgf005a99"><span class="section-number-2">1.</span> Procesos estocásticos y datos de series temporales</h2>
<div class="outline-text-2" id="text-1">
<dl class="org-dl">
<dt>Proceso estocástico</dt><dd>es una secuencia de variables aleatorias,
\(X_t\) donde el índice \(t\) recorre el conjunto de números enteros
\((\mathbb{Z})\).  \[\boldsymbol{X}\;=\;
  (\ldots,X_{-2},X_{-1},X_0,X_1,\ldots)\;=\; 
  (X_t \mid t\in\mathbb{Z});\]</dd>

<dt>Serie temporal</dt><dd><p>
es una secuencia finita de datos tomados a lo
largo del tiempo
</p>

<p>
\[\boldsymbol{x} = (x_1, x_2,\ldots x_n)\]
</p>

<ul class="org-ul">
<li>Consideraremos cada dato \(x_t\) como una <i>realización de</i> \(X_t\).</li>

<li><p>
Consecuentemente, consideraremos que una <i>serie temporal</i> es una
<i>realización de un tramo finito</i> de un proceso estocástico:
</p>

<p>
\[(x_1, x_2,\ldots x_n) \text{ es una realización de }(X_t \mid t=1:n).\]
</p></li>
</ul></dd>
</dl>
</div>
<div id="outline-container-orgcc6281d" class="outline-3">
<h3 id="orgcc6281d"><span class="section-number-3">1.1.</span> Datos de sección cruzada vs datos de series temporales</h3>
<div class="outline-text-3" id="text-1-1">
<dl class="org-dl">
<dt>Sección cruzada</dt><dd>el índice NO es cronológico. La numeración (la
indexación) de cada dato es solo una asignación arbitraria de
<i>etiquetas</i> que identifican a cada individuo, empresa, objeto,
etc. que ha sido medido. Consecuentemente:

<ul class="org-ul">
<li><i>el orden en el que aparecen los datos en la muestra es irrelevante</i>.</li>

<li>es decir, conocer únicamente el índice de un dato no permite
deducir nada respecto de cualquier otro dato.</li>
</ul></dd>
</dl>

<dl class="org-dl">
<dt>Series temporales</dt><dd>Corresponden a mediciones de un mismo objeto a
lo largo del tiempo. El índice indica el instante de cada medición.
<i>Es habitual que el orden cronológico de los datos sea importante</i>
para explicar cada uno de ellos.

<ul class="org-ul">
<li>con frecuencia la medición en un instante de tiempo está
relacionada con otras mediciones próximas en el tiempo. En tal
caso&#x2026;</li>

<li>no debemos asumir que las variables aleatorias del
proceso estocástico subyacente, 
\(\boldsymbol{X}=(X_t \mid t\in\mathbb{Z})\), 
sean independientes entre sí.</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-org811b7b8" class="outline-3">
<h3 id="org811b7b8"><span class="section-number-3">1.2.</span> El desafío</h3>
<div class="outline-text-3" id="text-1-2">
<p>
El análisis de <i>series temporales</i> trata sobre la inferencia
estadística de muestras que <b>frecuentemente NO podemos asumir que sean
realizaciones</b> de variables aleatorias <i>i.i.d.</i> (<i>independientes e
idénticamente distribuidas</i>). 
</p>


<p>
Además,
</p>
<ul class="org-ul">
<li><p>
Aunque el marco ideal es que la serie temporal analizada "<b>sea estacionaria</b>"
</p>
<p>
(<i>abuso del lenguaje que expresa que podemos asumir que la serie es
una realización de un proceso estocástico estacionario</i>)
</p></li>
<li>lo habitual es que, por distintos motivos, <b>NO lo sea</b></li>
</ul>


<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">path</span> = <span style="color: #008000;">'./datos/'</span>
<span style="color: #BA36A5;">df1</span> = pd.read_csv(path+<span style="color: #008000;">'PIB_UEM.csv'</span>)
<span style="color: #BA36A5;">df2</span> = pd.read_csv(path+<span style="color: #008000;">'ProduccionCemento.csv'</span>)
<span style="color: #BA36A5;">df3</span> = pd.read_csv(path+<span style="color: #008000;">'IBEX35.csv'</span>)
<span style="color: #BA36A5;">df4</span> = pd.read_csv(path+<span style="color: #008000;">'ExportacionDeAcero.csv'</span>)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">print(df1.head())</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python">df1.plot(x=<span style="color: #008000;">'obs'</span>,xlabel=<span style="color: #008000;">''</span>,title=<span style="color: #008000;">'PIB UEM'</span>, figsize=(15,4))
</pre>
</div>


<div id="org13e3839" class="figure">
<p><img src="./img/lecc01/PIB_UEM.png" alt="PIB_UEM.png" width="900px" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python">df2.plot(x=<span style="color: #008000;">'obs'</span>,xlabel=<span style="color: #008000;">''</span>,title=<span style="color: #008000;">'Producci&#243;n de cemento en Espa&#241;a'</span>, figsize=(15,4))
</pre>
</div>


<div id="org57b5c9d" class="figure">
<p><img src="./img/lecc01/ProduccionCemento.png" alt="ProduccionCemento.png" width="900px" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python">df3.plot(x=<span style="color: #008000;">'obs'</span>,xlabel=<span style="color: #008000;">''</span>,title=<span style="color: #008000;">'Rendimiento porcentual diario del IBEX 35'</span>, figsize=(15,4))
</pre>
</div>


<div id="org6e75292" class="figure">
<p><img src="./img/lecc01/IBEX35.png" alt="IBEX35.png" width="900px" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python">df4.plot(x=<span style="color: #008000;">'obs'</span>,xlabel=<span style="color: #008000;">''</span>,title=<span style="color: #008000;">'Exportaciones espa&#241;olas de acero'</span>, figsize=(15,4))
</pre>
</div>


<div id="org9d0648b" class="figure">
<p><img src="./img/lecc01/ExportacionDeAcero.png" alt="ExportacionDeAcero.png" width="900px" />
</p>
</div>



<p>
El desafío para el analista es
</p>
<dl class="org-dl">
<dt>primero</dt><dd>transformar los datos para lograr que sean "<b><i>estacionarios</i></b>"</dd>
<dt>y después</dt><dd><p>
transformar los datos estacionarios en una secuencia de
"<b>datos <i>i.i.d</i></b>"
</p>
<p>
(<i>nuevo abuso del lenguaje que expresa que podemos asumir que los
datos son realizaciones de variables aleatorias i.i.d.</i>)
</p></dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-orgf24d349" class="outline-2">
<h2 id="orgf24d349"><span class="section-number-2">2.</span> Estacionariedad</h2>
<div class="outline-text-2" id="text-2">
<p>
El mayor objetivo del <i>análisis de series temporales</i> es inferir la
distribución de \(\boldsymbol{X}=(X_t \mid t\in\mathbb{Z})\) usando una
muestra finita (serie temporal) \(\boldsymbol{x}=(x_t \mid t=1:n)\).  
</p>

<p>
Así podremos
</p>
<dl class="org-dl">
<dt>Predecir</dt><dd>datos futuros</dd>
<dt>Controlar</dt><dd>datos futuros</dd>
</dl>
<p>
Pero esto es casi imposible si los datos son inestables o caóticos a
lo largo del tiempo
</p>

<p>
Por tanto, algún tipo de <span class="underline">estabilidad</span> o <span class="underline">estacionariedad</span> es
necesaria.
</p>
</div>
<div id="outline-container-org67d5e18" class="outline-3">
<h3 id="org67d5e18"><span class="section-number-3">2.1.</span> Estacionariedad en sentido débil</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Un proceso estocástico \(\boldsymbol{X}\) se dice <b>estacionario</b> (<i>en
sentido débil</i>) si para todo \(t,k\in\mathbb{Z}\)
</p>

\begin{equation}
\label{org3c1c597}
E(X_t)  = \mu
\end{equation}

\begin{equation}
\label{orga2f4266}
Cov(X_t,X_{t-k}) = \gamma_k 
\end{equation}

<ul class="org-ul">
<li>(\eqref{org3c1c597}) sugiere que las realizaciones de
\(\boldsymbol{X}\) generalmente oscilan entorno a \(\mu\).</li>

<li><p>
(\eqref{orga2f4266}) sugiere que la variabilidad de las
realizaciones de \(\boldsymbol{X}\) entorno a \(\mu\) es constante, pues
para el caso particular \(k=0\)
</p>

<p>
\[Cov(X_t,X_{t-0})=Var(X_t) = \gamma_0\quad\text{ para todo } t\]
</p>

<p>
Es decir, \(\gamma_0\) es la varianza común a todas las variables
aleatorias del proceso.
</p></li>
</ul>

<p>
Es más, la desigualdad de Chebyshev
\[P\left(|X_t-\mu|\geq c\sigma\right)\leq\frac{1}{c^2},\quad\text{ donde } \sigma=\sqrt{\gamma_0}\]
sugiere que para cualquier proceso estacionario (y un \(c\) grande), al
pintar una realización, tan solo un pequeño porcentaje de los datos
caerán fuera de la franja \(\left(\mu-c\sigma, \mu+c\sigma\right)\).
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> statsmodels.api <span style="color: #0000FF;">as</span> sm
np.random.seed(12345)
<span style="color: #BA36A5;">arparams</span> = np.array([.75, -.25])
<span style="color: #BA36A5;">maparams</span> = np.array([.65, .35])
<span style="color: #BA36A5;">ar</span> = np.r_[1, -arparams] <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">add zero-lag and negate</span>
<span style="color: #BA36A5;">ma</span> = np.r_[1, maparams] <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">add zero-lag</span>
<span style="color: #BA36A5;">y</span> = sm.tsa.arma_generate_sample(ar, ma, 250)
plt.figure(figsize=(15,5))
plt.plot(y)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plt.savefig("./img/lecc01/stationaryTimeSeriesExample.png")</span>
</pre>
</div>


<div id="org2bf0a3e" class="figure">
<p><img src="./img/lecc01/stationaryTimeSeriesExample.png" alt="stationaryTimeSeriesExample.png" width="900px" />
</p>
</div>
</div>
</div>
<div id="outline-container-org1f93747" class="outline-3">
<h3 id="org1f93747"><span class="section-number-3">2.2.</span> Función de autocovarianzas y función de autocorrelación</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Cuando \(\boldsymbol{X}\) es un proceso estocástico (débilmente) <b>estacionario</b> 
</p>
<ul class="org-ul">
<li>La secuencia \(\;(\gamma_k \mid k\in\mathbb{Z}),\;\) donde 
\(\;\gamma_k = Cov(X_t,X_{t-k})\;\)
se denomina <i>función de autocovarianzas</i></li>
</ul>

<p>
Debido a la estacionariedad, la correlación entre \(X_t\) y \(X_{t+k}\) no
depende de \(t\); tan solo depende de la distancia temporal \(k\) entre
ambas variables.
</p>
<ul class="org-ul">
<li>La secuencia \(\;(\rho_k \mid k\in\mathbb{Z}),\;\) donde
\(\;\rho_k=\frac{Cov(X_t,X_{t-k})}{\sqrt{Var(X_t)Var(X_{t-k})}}=\frac{\gamma_k}{\gamma_0}\;\)
se denomina <i>función de autocorrelación</i> (ACF).</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org821b5f0" class="outline-2">
<h2 id="org821b5f0"><span class="section-number-2">3.</span> Transformaciones de realizaciones de procesos estocásticos NO estacionarios</h2>
<div class="outline-text-2" id="text-3">
<p>
Un proceso estocástico \(\boldsymbol{X}=(X_t \mid t\in\mathbb{Z})\) puede ser
</p>
<dl class="org-dl">
<dt>NO estacionario en media</dt><dd>porque \(E(X_t)\) depende de \(t\).</dd>

<dt>NO estacionario en covarianza</dt><dd>porque \(Cov(X_t,X_{t-k})\) depende de \(t\).</dd>
</dl>
<p>
Separar o distinguir ambos tipos de no estacionariedad no es sencillo.
</p>

<p>
Veamos un ejemplo de serie temporal para la que 
</p>
<ul class="org-ul">
<li>no podemos asumir que sea realización de un proceso estocástico
estacionario</li>
<li><p>
y algunos intentos de transformación para obtener datos
"<b>estacionarios</b>" (*)
</p>
<p>
(<i>recuerde que esta expresión, aunque extendida, es un abuso del
lenguaje</i>).
</p></li>
</ul>
</div>
<div id="outline-container-org791e80c" class="outline-3">
<h3 id="org791e80c"><span class="section-number-3">3.1.</span> Internat. airline passengers: monthly totals in thousands. Jan 49 – Dec 60</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Leemos los datos de un fichero csv y generamos un dataframe de pandas.</span>
<span style="color: #BA36A5;">OrigData</span> = pd.read_csv(<span style="color: #008000;">'./database/Datasets-master/airline-passengers.csv'</span>)
<span style="color: #BA36A5;">OrigData</span>[<span style="color: #008000;">'Month'</span>]=pd.to_datetime(OrigData[<span style="color: #008000;">'Month'</span>])
<span style="color: #BA36A5;">OrigData</span>=OrigData.set_index([<span style="color: #008000;">'Month'</span>])
<span style="color: #006FE0;">print</span>(OrigData.head())
</pre>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-python" id="orgfd9398e">plt.figure(figsize=(15,5))
plt.subplot(1, 2, 1)
plt.plot(OrigData[<span style="color: #008000;">'Passengers'</span>])
plt.xlabel(<span style="color: #008000;">"Month"</span>)
plt.ylabel(r<span style="color: #008000;">"Number of Air Passengers, ($\boldsymbol{x}$)"</span>)
plt.subplot(1, 2, 2)
plt.hist(OrigData[<span style="color: #008000;">'Passengers'</span>], edgecolor=<span style="color: #008000;">'white'</span>, bins=11)
plt.tight_layout()
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plt.savefig("./img/lecc01/airlinepass+hist.png")</span>
</pre>
</div>


<div id="orgafdfc83" class="figure">
<p><img src="./img/lecc01/airlinepass+hist.png" alt="airlinepass+hist.png" width="900px" />
</p>
</div>

<p>
\[\boldsymbol{x}=(x_1,\ldots x_{114})\]
</p>

<p>
Serie <i>"no estacionaria"</i> (*):
</p>
<ul class="org-ul">
<li>La media crece de año en año</li>
<li>La variabilidad estacional crece de año en año (fíjese en la
diferencia entre el verano y el otoño de cada año)</li>
</ul>
</div>
<div id="outline-container-orge59ac3e" class="outline-4">
<h4 id="orge59ac3e"><span class="section-number-4">3.1.1.</span> Trasformación logarítmica de los datos</h4>
<div class="outline-text-4" id="text-3-1-1">
<ul class="org-ul">
<li>Al aplicar la función logarítmica transformamos <b>monótonamente</b> los
datos estabilizando la varianza cuando los valores son mayores que
0.567 (aprox.)</li>

<li>Pero ocurre lo contrario cuando los valores son pequeños (aumenta el
valor absoluto de aquellos entre 0 y 0.567 aprox.). De hecho,
\(\lim\limits_{x\to0} \ln(x)=-\infty\).</li>

<li>Además, <i>el logaritmo no está definido para valores negativos</i>.</li>
</ul>

<div class="org-src-container">
<pre class="src src-jupyter-python" id="org445eedb"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Definir el rango de valores para x (empezando desde un n&#250;mero positivo ya que log(0) no est&#225; definido)</span>
<span style="color: #BA36A5;">x</span> = np.linspace(0.01, 7, 400)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Valores de 0.1 a 10</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Calcular y = log(x)</span>
<span style="color: #BA36A5;">y</span> = np.log(x)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Crear el gr&#225;fico</span>
plt.figure(figsize=(16, 5))
plt.plot(x, y, label=<span style="color: #008000;">'y = ln(x)'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">A&#241;adir etiquetas y t&#237;tulo</span>
plt.xlabel(<span style="color: #008000;">'x'</span>)
plt.ylabel(<span style="color: #008000;">'ln(x)'</span>)
plt.title(<span style="color: #008000;">'Gr&#225;fico de la funci&#243;n logar&#237;tmica y = ln(x)'</span>)
plt.axhline(0, color=<span style="color: #008000;">'black'</span>,linewidth=0.5)
plt.axvline(0, color=<span style="color: #008000;">'black'</span>,linewidth=0.5)
plt.grid(color = <span style="color: #008000;">'gray'</span>, linestyle = <span style="color: #008000;">'--'</span>, linewidth = 0.5)
plt.legend()
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plt.savefig("./img/lecc01/funcion_logaritmica.png")</span>
</pre>
</div>


<div id="orgcd9dd71" class="figure">
<p><img src="./img/lecc01/funcion_logaritmica.png" alt="funcion_logaritmica.png" width="900px" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Creamos un nuevo dataframe con los datos originales y varias transformaciones de los mismos</span>
<span style="color: #BA36A5;">TransformedData</span> = OrigData.copy()
<span style="color: #BA36A5;">TransformedData</span>[<span style="color: #008000;">'dataLog'</span>] = np.log(OrigData[<span style="color: #008000;">'Passengers'</span>])
<span style="color: #BA36A5;">TransformedData</span>[<span style="color: #008000;">'dataLogDiff'</span>] = TransformedData[<span style="color: #008000;">'dataLog'</span>].diff(1)
<span style="color: #BA36A5;">TransformedData</span>[<span style="color: #008000;">'dataLogDiffDiff12'</span>] = TransformedData[<span style="color: #008000;">'dataLogDiff'</span>].diff(12)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python" id="org7e37e03">plt.figure(figsize=(15,5))
plt.subplot(1, 2, 1)
plt.plot(TransformedData[<span style="color: #008000;">'dataLog'</span>])
plt.xlabel(<span style="color: #008000;">"Month"</span>)
plt.ylabel(r<span style="color: #008000;">"Log-Passengers, ($\ln\boldsymbol{x}$) "</span>)
plt.subplot(1, 2, 2)
plt.hist(TransformedData[<span style="color: #008000;">'dataLog'</span>], edgecolor=<span style="color: #008000;">'white'</span>, bins=11)
plt.tight_layout()
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plt.savefig("./img/lecc01/airlinepass_log+hist.png")</span>
</pre>
</div>


<div id="org402eac4" class="figure">
<p><img src="./img/lecc01/airlinepass_log+hist.png" alt="airlinepass_log+hist.png" width="900px" />
</p>
</div>

<p>
\[\ln\boldsymbol{x}=\Big(\ln(x_1),\ldots \ln(x_{114})\Big)\]
</p>

<p>
Ésta tampoco parece la realización de un proceso estocástico <i>estacionario</i>
</p>
<ul class="org-ul">
<li>Ahora la variabilidad estacional parece mantenerse de año en año</li>
<li>Pero la media sigue creciendo de año en año</li>
</ul>
</div>
</div>
<div id="outline-container-orgc67d797" class="outline-4">
<h4 id="orgc67d797"><span class="section-number-4">3.1.2.</span> Primera diferencia del logarítmo de los datos</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-jupyter-python" id="org1b3963b">plt.figure(figsize=(15,5))
plt.subplot(1, 2, 1)
plt.plot(TransformedData[<span style="color: #008000;">'dataLogDiff'</span>])
plt.xlabel(<span style="color: #008000;">"Month"</span>)
plt.ylabel(r<span style="color: #008000;">"$\nabla\ln\boldsymbol{x}$"</span>)
plt.subplot(1, 2, 2)
plt.hist(TransformedData[<span style="color: #008000;">'dataLogDiff'</span>], edgecolor=<span style="color: #008000;">'white'</span>, bins=11)
plt.tight_layout()
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plt.savefig("./img/lecc01/airlinepass_logDiff+hist.png")</span>
</pre>
</div>


<div id="orgbe17fa0" class="figure">
<p><img src="./img/lecc01/airlinepass_logDiff+hist.png" alt="airlinepass_logDiff+hist.png" width="900px" />
</p>
</div>

<p>
\[\boldsymbol{y}=\nabla\ln\boldsymbol{x}=\Big(\big[\ln(x_2)-\ln(x_1)\big],\ldots\; \big[\ln(x_{114})-\ln(x_{113})\big]\Big)\]
</p>

<p>
Esta serie tampoco parece <i>"estacionaria"</i> (*)
</p>
<ul class="org-ul">
<li>Hay un componente periódico (de naturaleza estacional), debido a que
hay pocos viajes en otoño y muchos en Navidad, Semana Santa y verano
(i.e., el número esperado de viajeros parece cambiar en función del
mes o estación del año).</li>
</ul>
</div>
</div>
<div id="outline-container-orgd25965c" class="outline-4">
<h4 id="orgd25965c"><span class="section-number-4">3.1.3.</span> Diferencia estacional de la primera diferencia del logarítmo de los datos</h4>
<div class="outline-text-4" id="text-3-1-3">
<div class="org-src-container">
<pre class="src src-jupyter-python" id="org2c0a225">plt.figure(figsize=(15,5))
plt.subplot(1, 2, 1)
plt.plot(TransformedData[<span style="color: #008000;">'dataLogDiffDiff12'</span>])
plt.xlabel(<span style="color: #008000;">"Month"</span>)
plt.ylabel(r<span style="color: #008000;">"$\nabla_{12}(\nabla\ln\boldsymbol{x})$"</span>)
plt.subplot(1, 2, 2)
plt.hist(TransformedData[<span style="color: #008000;">'dataLogDiffDiff12'</span>], edgecolor=<span style="color: #008000;">'white'</span>, bins=11)
plt.tight_layout()
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plt.savefig("./img/lecc01/airlinepass_logDiffDiff12+hist.png")</span>
</pre>
</div>


<div id="orgb3d2f48" class="figure">
<p><img src="./img/lecc01/airlinepass_logDiffDiff12+hist.png" alt="airlinepass_logDiffDiff12+hist.png" width="900px" />
</p>
</div>

<p>
\[\boldsymbol{z}=\nabla_{12}(\nabla\ln\boldsymbol{x})=\nabla_{12}(\boldsymbol{y})=\Big((y_{13}-y_{1}),\ldots\; (y_{113}-y_{101})\Big)\]
</p>

<p>
Esta serie se aproxima más al aspecto de la realización de un proceso <i>estacionario</i>
</p>
<ul class="org-ul">
<li>Aunque parece haber más varianza a principios de los 50 que a finales</li>
<li>De propina, el histograma sugiere una distribución aproximadamente Gaussiana</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgf3a224f" class="outline-3">
<h3 id="orgf3a224f"><span class="section-number-3">3.2.</span> Tasa logarítmica de crecimiento</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">START</span> = 100
<span style="color: #BA36A5;">UnoPorCiento</span> = <span style="color: #0000FF;">lambda</span> n0, t: n0 <span style="color: #0000FF;">if</span> t&lt;=1 <span style="color: #0000FF;">else</span> 1.01 * UnoPorCiento(n0, t-1)
<span style="color: #BA36A5;">TasaLogCrecimiento</span> = pd.DataFrame({<span style="color: #008000;">'$y_t$'</span>:[UnoPorCiento(START,t+1) <span style="color: #0000FF;">for</span> t <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(10)]})
<span style="color: #BA36A5;">TasaLogCrecimiento</span>[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">frac{y_t-y_{t-1}}{y_{t-1}}$'</span>] = TasaLogCrecimiento[<span style="color: #008000;">'$y_t$'</span>].pct_change()
<span style="color: #BA36A5;">TasaLogCrecimiento</span>[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln y_t$'</span>] = np.log(TasaLogCrecimiento[<span style="color: #008000;">'$y_t$'</span>])
<span style="color: #BA36A5;">TasaLogCrecimiento</span>[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">nabla</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">boldsymbol{y}$'</span>] = TasaLogCrecimiento[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln y_t$'</span>] - TasaLogCrecimiento[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln y_t$'</span>].shift(+1)
<span style="color: #BA36A5;">TasaLogCrecimiento</span>[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">frac{y_t-y_{0}}{y_{0}}$'</span>] = TasaLogCrecimiento[<span style="color: #008000;">'$y_t$'</span>].<span style="color: #006FE0;">apply</span>(<span style="color: #0000FF;">lambda</span> x: ((x/START)-1))
<span style="color: #BA36A5;">TasaLogCrecimiento</span>[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln y_t- </span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln y_{0}$'</span>] = TasaLogCrecimiento[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln y_t$'</span>] - TasaLogCrecimiento[<span style="color: #008000;">'$</span><span style="color: #D0372D;">\\</span><span style="color: #008000;">ln y_t$'</span>].iloc[0]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python">dfi.export(TasaLogCrecimiento, <span style="color: #008000;">"./img/lecc01/TasaLogCrecimiento.png"</span>, use_mathjax=<span style="color: #D0372D;">True</span>, dpi=200, table_conversion=<span style="color: #008000;">"matplotlib"</span>)
</pre>
</div>

<p>
La tasa logarítmica de variación de \(\boldsymbol{y}\) se define como
\(z_t=\ln{y_t}-\ln{y_{t-1}};\) es decir
</p>

<p>
\[\boldsymbol{z}=\nabla\ln\boldsymbol{y} = \Big(\big[\ln(y_2)-\ln(y_1)\big],\ldots\; \big[\ln(y_{n})-\ln(y_{n-1})\big]\Big)\]
</p>

<p>
y se <i>aproxima</i> a la tasa de crecimiento (en tanto por uno) si el
incremento es pequeño.
</p>



<div id="orga360e35" class="figure">
<p><img src="./img/lecc01/TasaLogCrecimiento.png" alt="TasaLogCrecimiento.png" width="500px" />
</p>
</div>
</div>
<div id="outline-container-org3244b9f" class="outline-4">
<h4 id="org3244b9f"><span class="section-number-4">3.2.1.</span> Comentarios sobre los datos transformados</h4>
<div class="outline-text-4" id="text-3-2-1">
<style>
.reveal  td {font-size: 95%;}
</style>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Transformación  de la serie temporal \(\displaystyle \boldsymbol{y}=\{y_t\},\; t=1:n\)</th>
<th scope="col" class="org-left">Comentario</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(\boldsymbol{z}=\ln\boldsymbol{y}=\{\ln y_t\}\)</td>
<td class="org-left">A veces independiza la volatilidad del nivel e induce normalidad.</td>
</tr>

<tr>
<td class="org-left">\(\boldsymbol{z}=\nabla\boldsymbol{y}=\{y_t-y_{t-1}\}\)</td>
<td class="org-left">Indica al crecimiento absoluto entre  periodos consecutivos.</td>
</tr>

<tr>
<td class="org-left">\(\boldsymbol{z}=\nabla\ln\boldsymbol{y}\)</td>
<td class="org-left">Tasa logarítmica de crecimiento. Aproximación del crecimiento relativo entre periodos consecutivos.</td>
</tr>

<tr>
<td class="org-left">\(\boldsymbol{z}=\nabla\nabla\ln\boldsymbol{y}=\nabla^2\ln\boldsymbol{y}\)</td>
<td class="org-left">Cambio en la tasa log, de crecimiento. Indica la “aceleración” en el crecimiento relativo.</td>
</tr>

<tr>
<td class="org-left">\(\boldsymbol{z}=\nabla_{s}\ln\boldsymbol{y}=\) \(\{\ln{y_t}-\ln{y_{t-s}}\}\)</td>
<td class="org-left">Tasa de crecimiento acumulada en un ciclo estacional completo (\(s\) períodos). Cuando el período estacional es de un año, se conoce como “tasa anual” o “tasa interanual”.</td>
</tr>

<tr>
<td class="org-left">\(\boldsymbol{z}=\nabla\nabla_{s}\ln\boldsymbol{y}\)</td>
<td class="org-left">Cambio en la tasa de crecimiento acumulada en un ciclo estacional completo. Es un indicador de aceleración en el crecimiento acumulado.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Marcos Bujosa</p>
<p class="date">Created: 2024-08-27 mar 22:29</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
