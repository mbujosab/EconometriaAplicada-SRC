<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-07-27 sáb 17:54 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="Marcos Bujosa" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5f5b6c9">1. Internat. airline passengers: monthly totals in thousands. Jan 49 – Dec 60</a>
<ul>
<li>
<ul>
<li><a href="#orgc67e324">1.0.1. Forecast</a></li>
<li><a href="#org8dd9495">1.0.2. uc</a></li>
<li><a href="#org7b2a9d3">1.0.3. con dummies</a></li>
</ul>
</li>
<li><a href="#orgce4ea00">1.1. ECM</a></li>
</ul>
</li>
<li><a href="#org827f70d">2. Descomposición estructural de una serie temporal</a>
<ul>
<li><a href="#org4a978c0">2.1. Tendencia determinista <i>lineal</i></a></li>
<li><a href="#orgea81008">2.2. Tendencia determinista <i>cuadrática</i></a></li>
<li><a href="#orgd073e38">2.3. Tendencia cuadrática más estacionalidad determinista mediante <i>dummies</i></a>
<ul>
<li><a href="#orgcb22aa2">2.3.1. Ajuste y componente irregular \(\boldsymbol{e}=\boldsymbol{y}-\boldsymbol{t}-\boldsymbol{s}\)</a></li>
<li><a href="#orgff06def">2.3.2. Valoración de modelos con componentes deterministas</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7a8d178">3. Autocorrelación</a>
<ul>
<li><a href="#org3882970">3.1. Test de Breusch y Godfrey</a></li>
<li><a href="#org05873b3">3.2. Errores estándar robustos</a></li>
<li><a href="#orge707cc8">3.3. Modelo del errorg</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #D0372D;">library</span>(ggplot2)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Mostrando la serie capinst </span>
p <span style="color: #D0372D;">&lt;-</span> ggplot(data_frame, aes(x = obs))
p <span style="color: #D0372D;">&lt;-</span> p + geom_line(aes(y = GNP), colour=<span style="color: #008000;">"blue"</span>)


<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">como capinst tiene una escala mayor que infla se</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">requiere ajustar los datos</span>
sf<span style="color: #D0372D;">&lt;-</span>max(data_frame[<span style="color: #008000;">'GNP'</span>])/max(data_frame[<span style="color: #008000;">'Melanoma'</span>])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Se agrega infla a Y multiplicada por el factor</span>
p <span style="color: #D0372D;">&lt;-</span> p + geom_line(aes(y = Melanoma*sf), colour=<span style="color: #008000;">"red"</span>)

p <span style="color: #D0372D;">&lt;-</span> p + scale_y_continuous(sec.axis = sec_axis(~.*sf, name = <span style="color: #008000;">"Inflaci&#243;n Escalada"</span>))
p <span style="color: #D0372D;">&lt;-</span> p + labs(y = <span style="color: #008000;">"GNP"</span>,
              x = <span style="color: #008000;">"xFechas"</span>,
              colour = <span style="color: #008000;">"Parameter"</span>)
p <span style="color: #D0372D;">&lt;-</span> p + theme(legend.position = c(0.8, 0.9))
p
</pre>
</div>


<div id="org4b18d92" class="figure">
<p><img src="./.ob-jupyter/6ac38045ce084ed03fe6f4fa0aeb02f6b63e0909.png" alt="6ac38045ce084ed03fe6f4fa0aeb02f6b63e0909.png" />
</p>
</div>



<div class="org-src-container">
<pre class="src src-jupyter-R">dias <span style="color: #D0372D;">&lt;-</span>100
capinst<span style="color: #D0372D;">&lt;-</span>rnorm(dias, mean=80, sd=10)
infla<span style="color: #D0372D;">&lt;-</span>rweibull(dias, shape=1, scale=0.75)
index <span style="color: #D0372D;">&lt;-</span> 1:dias

capinfl<span style="color: #D0372D;">&lt;-</span> data.frame(
    capinst=capinst,
    infla=infla,
    index = index
    )
head(capinfl,3)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">&#xa0;</th>
<th scope="col" class="org-right">capinst</th>
<th scope="col" class="org-right">infla</th>
<th scope="col" class="org-right">index</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-right">&lt;dbl&gt;</td>
<td class="org-right">&lt;dbl&gt;</td>
<td class="org-right">&lt;int&gt;</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">93.45184</td>
<td class="org-right">0.009721363</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">70.16630</td>
<td class="org-right">0.767510729</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">75.57155</td>
<td class="org-right">0.060896392</td>
<td class="org-right">3</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-jupyter-R">head(datos_ts, 5)
head(data_frame, 5)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">obs</th>
<th scope="col" class="org-right">GNP</th>
<th scope="col" class="org-right">Melanoma</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1936</td>
<td class="org-right">193.0</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-right">1937</td>
<td class="org-right">203.2</td>
<td class="org-right">0.8</td>
</tr>

<tr>
<td class="org-right">1938</td>
<td class="org-right">192.9</td>
<td class="org-right">0.8</td>
</tr>

<tr>
<td class="org-right">1939</td>
<td class="org-right">209.4</td>
<td class="org-right">1.4</td>
</tr>

<tr>
<td class="org-right">1940</td>
<td class="org-right">227.2</td>
<td class="org-right">1.2</td>
</tr>
</tbody>
</table>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> A matrix: 5 × 3 of type dbl</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">obs</th>
<th scope="col" class="org-right">GNP</th>
<th scope="col" class="org-right">Melanoma</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&lt;dbl&gt;</td>
<td class="org-right">&lt;dbl&gt;</td>
<td class="org-right">&lt;dbl&gt;</td>
</tr>

<tr>
<td class="org-right">1936</td>
<td class="org-right">193.0</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-right">1937</td>
<td class="org-right">203.2</td>
<td class="org-right">0.8</td>
</tr>

<tr>
<td class="org-right">1938</td>
<td class="org-right">192.9</td>
<td class="org-right">0.8</td>
</tr>

<tr>
<td class="org-right">1939</td>
<td class="org-right">209.4</td>
<td class="org-right">1.4</td>
</tr>

<tr>
<td class="org-right">1940</td>
<td class="org-right">227.2</td>
<td class="org-right">1.2</td>
</tr>
</tbody>
</table>


<div class="org-src-container">
<pre class="src src-jupyter-R">data_frame[<span style="color: #008000;">'GNP'</span>]
</pre>
</div>



<div id="orgaeb31b0" class="figure">
<p><img src="./.ob-jupyter/0fc71b38df2f16f7a7beb1142c331f61fde7c3c8.png" alt="0fc71b38df2f16f7a7beb1142c331f61fde7c3c8.png" />
</p>
</div>




<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #D0372D;">library</span>(latticeExtra)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">se puede mostrar las dos variables en el mismo tiempo</span>
kk <span style="color: #D0372D;">&lt;-</span> xyplot(capinst + infla ~ index, capinfl, type=<span style="color: #008000;">"l"</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">se agrega dos ejes Y</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">se construye cada serie por separado</span>
obj1 <span style="color: #D0372D;">&lt;-</span> xyplot(capinst  ~ index, capinfl, type = <span style="color: #008000;">"l"</span> , lwd=2, ylab=<span style="color: #008000;">"capinst"</span>,  xlab=<span style="color: #008000;">"xD&#237;as"</span>)
obj2 <span style="color: #D0372D;">&lt;-</span> xyplot(infla ~ index, capinfl, type = <span style="color: #008000;">"l"</span>, lwd=2, ylab=<span style="color: #008000;">"inflacion"</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">--&gt; se realiza la grafica con el segundo eje Y</span>
doubleYScale(obj1, obj2, add.ylab2 = <span style="color: #6434A3;">TRUE</span>)
</pre>
</div>


<div id="org44d6177" class="figure">
<p><img src="./.ob-jupyter/5e4361de77bc86e0227d123f9abaeb87df7070c1.png" alt="5e4361de77bc86e0227d123f9abaeb87df7070c1.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">head(capinfl,3)
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">&#xa0;</th>
<th scope="col" class="org-right">capinst</th>
<th scope="col" class="org-right">infla</th>
<th scope="col" class="org-right">index</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-right">&lt;dbl&gt;</td>
<td class="org-right">&lt;dbl&gt;</td>
<td class="org-right">&lt;int&gt;</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">93.45184</td>
<td class="org-right">0.009721363</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">70.16630</td>
<td class="org-right">0.767510729</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">75.57155</td>
<td class="org-right">0.060896392</td>
<td class="org-right">3</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #D0372D;">library</span>(ggplot2)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Mostrando la serie capinst </span>
p <span style="color: #D0372D;">&lt;-</span> ggplot(capinfl, aes(x = index))
p <span style="color: #D0372D;">&lt;-</span> p + geom_line(aes(y = capinst), colour=<span style="color: #008000;">"blue"</span>)


<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">como capinst tiene una escala mayor que infla se</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">requiere ajustar los datos</span>
sf<span style="color: #D0372D;">&lt;-</span>max(capinst)/max(infla)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Se agrega infla a Y multiplicada por el factor</span>
p <span style="color: #D0372D;">&lt;-</span> p + geom_line(aes(y = infla*sf), colour=<span style="color: #008000;">"red"</span>)

p <span style="color: #D0372D;">&lt;-</span> p + scale_y_continuous(sec.axis = sec_axis(~.*sf, name = <span style="color: #008000;">"Inflaci&#243;n Escalada"</span>))
p <span style="color: #D0372D;">&lt;-</span> p + labs(y = <span style="color: #008000;">"Capinst"</span>,
              x = <span style="color: #008000;">"xFechas"</span>,
              colour = <span style="color: #008000;">"Parameter"</span>)
p <span style="color: #D0372D;">&lt;-</span> p + theme(legend.position = c(0.8, 0.9))
p
</pre>
</div>


<div id="org0b1a296" class="figure">
<p><img src="./.ob-jupyter/a5e52ae62b2355e72c8275bc37bec5f489917048.png" alt="a5e52ae62b2355e72c8275bc37bec5f489917048.png" />
</p>
</div>



<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">library(ggplot2)</span>
<span style="color: #D0372D;">library</span>(tidyverse)
<span style="color: #D0372D;">library</span>(hrbrthemes)

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">letal_mexico &lt;- data.frame(FECHA_TOTAL = rep(as.Date('2020-01-01') + 1:50,2), </span>
<span style="color: #8D8D84;">#                           </span><span style="color: #8D8D84; font-style: italic;">ENT_REGIS = sample(100:300, 100),</span>
<span style="color: #8D8D84;">#                           </span><span style="color: #8D8D84; font-style: italic;">SEXO = rep(1:2, each=50))</span>

data_frame <span style="color: #D0372D;">%&gt;%</span> 
  ggplot(aes(x=obs,y=GNP, color=ifelse(SEXO==1, <span style="color: #008000;">'Hombres'</span>, <span style="color: #008000;">'Mujeres'</span>))) +
  geom_line() +
  ylab(<span style="color: #008000;">"Muertes"</span>) +
  xlab(<span style="color: #008000;">"Fecha"</span>) +
  scale_color_manual(values = c(<span style="color: #008000;">"blue"</span>, <span style="color: #008000;">"red"</span>)) +
  theme_ipsum() +
  theme(legend.title=element_blank())
</pre>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">grafico <span style="color: #D0372D;">&lt;-</span> ggplot(datos_ts, aes(x = time)) +
  geom_line(aes(y = GNP), color = <span style="color: #008000;">"red"</span>) +
  geom_line(aes(y = Melanoma), color = <span style="color: #008000;">"blue"</span>)
grafico
</pre>
</div>



<div class="org-src-container">
<pre class="src src-jupyter-R">plot(datos_ts[, <span style="color: #008000;">"obs"</span>], datos_ts[, <span style="color: #008000;">"GNP"</span>], type = <span style="color: #008000;">"l"</span>, col = <span style="color: #008000;">"red"</span>, ylab = <span style="color: #008000;">"Variable 1"</span>)
axis(side = 2, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Crea el eje y derecho</span>
     x = datos_ts[, <span style="color: #008000;">"obs"</span>], 
     y = datos_ts[, <span style="color: #008000;">"Melanoma"</span>], 
     col = <span style="color: #008000;">"blue"</span>, 
     ylab = <span style="color: #008000;">"Variable 2"</span>)
</pre>
</div>

<pre class="example">
Warning message in axis(side = 2, x = datos_ts[, "obs"], y = datos_ts[, "Melanoma"], :
“"x" is not a graphical parameter”
Warning message in axis(side = 2, x = datos_ts[, "obs"], y = datos_ts[, "Melanoma"], :
“"y" is not a graphical parameter”
</pre>


<div id="org5ff6e19" class="figure">
<p><img src="./.ob-jupyter/05ed965669d86e84f4e997edf33f80bd6df505af.png" alt="05ed965669d86e84f4e997edf33f80bd6df505af.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">plot(datos_ts[, <span style="color: #008000;">"GNP"</span>], datos_ts[, <span style="color: #008000;">"Melanoma"</span>], type = <span style="color: #008000;">"l"</span>, col = <span style="color: #008000;">"red"</span>, ylab = <span style="color: #008000;">"Variable 1"</span>)
lines(datos_ts[, <span style="color: #008000;">"GNP"</span>], datos_ts[, <span style="color: #008000;">"Melanoma"</span>], col = <span style="color: #008000;">"blue"</span>, ylab = <span style="color: #008000;">"Variable 2"</span>)
</pre>
</div>

<pre class="example">
Error in plot.xy(xy.coords(x, y), type = type, ...): invalid plot type
Traceback:

1. lines(datos_ts[, "GNP"], datos_ts[, "Melanoma"], col = "blue", 
 .     ylab = "Variable 2")
2. lines.ts(datos_ts[, "GNP"], datos_ts[, "Melanoma"], col = "blue", 
 .     ylab = "Variable 2")
3. lines.default(time(as.ts(x)), x, ...)
4. plot.xy(xy.coords(x, y), type = type, ...)
5. stop(gettextf("invalid plot type"))
</pre>


<div id="orgcd79f4f" class="figure">
<p><img src="./.ob-jupyter/9c2b2fe611b2c5fb95ac6430cac47448204e7f0f.png" alt="9c2b2fe611b2c5fb95ac6430cac47448204e7f0f.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">scaleFactor <span style="color: #D0372D;">&lt;-</span> max(data_frame$GNP) / max(data_frame$Melanoma)
scaleFactor
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">ggplot(data) </span>
<span style="color: #8D8D84;">#  </span><span style="color: #8D8D84; font-style: italic;">geom_col() +</span>
<span style="color: #8D8D84;">#  </span><span style="color: #8D8D84; font-style: italic;">geom_line(aes(y = a + Temp*b), color = "red") +</span>
<span style="color: #8D8D84;">#  </span><span style="color: #8D8D84; font-style: italic;">scale_y_continuous("Precipitation", sec.axis = sec_axis(~ (. - a)/b, name = "Temperature")) +</span>
<span style="color: #8D8D84;">#  </span><span style="color: #8D8D84; font-style: italic;">scale_x_continuous("Month", breaks = 1:12) +</span>
<span style="color: #8D8D84;">#  </span><span style="color: #8D8D84; font-style: italic;">ggtitle("Climatogram for Oslo (1961-1990)")  </span>
</pre>
</div>

<p>
149.528301886792
</p>


<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #D0372D;">library</span>(ggplot2)
<span style="color: #D0372D;">library</span>(scales)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Function factory for secondary axis transforms</span>
<span style="color: #006699;">train_sec</span> <span style="color: #D0372D;">&lt;-</span> <span style="color: #0000FF;">function</span>(primary, secondary, na.rm = <span style="color: #6434A3;">TRUE</span>) {
  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Thanks Henry Holm for including the na.rm argument!</span>
  from <span style="color: #D0372D;">&lt;-</span> range(secondary, na.rm = na.rm)
  to   <span style="color: #D0372D;">&lt;-</span> range(primary, na.rm = na.rm)
  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Forward transform for the data</span>
  <span style="color: #006699;">forward</span> <span style="color: #D0372D;">&lt;-</span> <span style="color: #0000FF;">function</span>(x) {
    rescale(x, from = from, to = to)
  }
  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Reverse transform for the secondary axis</span>
  <span style="color: #006699;">reverse</span> <span style="color: #D0372D;">&lt;-</span> <span style="color: #0000FF;">function</span>(x) {
    rescale(x, from = to, to = from)
  }
  list(fwd = forward, rev = reverse)
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Rescaling the maximum</span>
sec <span style="color: #D0372D;">&lt;-</span> with(data, train_sec(c(0, max(data[,<span style="color: #008000;">'GNP'</span>])),
                            c(0, max(data[,<span style="color: #008000;">'Melanoma'</span>]))))
sec
</pre>
</div>

<pre class="example">
Error in eval(substitute(expr), data, enclos = parent.frame()): argumento 'envir' númerico no tiene longitud uno
Traceback:

1. with(data, train_sec(c(0, max(data[, "GNP"])), c(0, max(data[, 
 .     "Melanoma"]))))
2. with.default(data, train_sec(c(0, max(data[, "GNP"])), c(0, max(data[, 
 .     "Melanoma"]))))
3. eval(substitute(expr), data, enclos = parent.frame())
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Rescaling the maximum</span>
sec <span style="color: #D0372D;">&lt;-</span> with(data, train_sec(c(0, max(data[,<span style="color: #008000;">'GNP'</span>])),
                            c(0, max(data[,<span style="color: #008000;">'Melanoma'</span>]))))

ggplot(data, aes(date)) +
  geom_line(aes(y = GNP), colour = <span style="color: #008000;">"blue"</span>) +
  geom_line(aes(y = sec$fwd(Melanoma)), colour = <span style="color: #008000;">"red"</span>) +
  scale_y_continuous(sec.axis = sec_axis(~sec$rev(.), name = <span style="color: #008000;">"Melanoma"</span>))

</pre>
</div>

<pre class="example">
Error in eval(substitute(expr), data, enclos = parent.frame()): argumento 'envir' númerico no tiene longitud uno
Traceback:

1. with(data, train_sec(c(0, max(data[, "GNP"])), c(0, max(data[, 
 .     "Melanoma"]))))
2. with.default(data, train_sec(c(0, max(data[, "GNP"])), c(0, max(data[, 
 .     "Melanoma"]))))
3. eval(substitute(expr), data, enclos = parent.frame())
</pre>



<div class="org-src-container">
<pre class="src src-jupyter-R">scaleFactor <span style="color: #D0372D;">&lt;-</span> max(data[,<span style="color: #008000;">'GNP'</span>]) / max(data[,<span style="color: #008000;">'Melanoma'</span>])
scaleFactor

ggplot(data, aes(x = time)) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">+</span>
  geom_line(aes(y = GNP), color = <span style="color: #008000;">"red"</span>) +
  geom_line(aes(y = Melanoma), ylab = <span style="color: #008000;">"Variable 2"</span>, axis.title.y = element_text(hjust = 1), color = <span style="color: #008000;">"blue"</span>) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">+</span>
  scaleYright(name = <span style="color: #008000;">"Variable 1"</span>)

</pre>
</div>

<p>
149.528301886792
</p>
<pre class="example" id="org92fea1f">
Don't know how to automatically pick scale for object of type &lt;function&gt;.
Defaulting to continuous.
ERROR while rich displaying an object: Error in `geom_blank()`:
! Problem while computing aesthetics.
ℹ Error occurred in the 1st layer.
Caused by error in `compute_aesthetics()`:
! Aesthetics are not valid data columns.
✖ The following aesthetics are invalid:
✖ `x = time`
ℹ Did you mistype the name of a data column or forget to add `after_stat()`?

Traceback:
1. tryCatch(withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler), error = outer_handler)
2. tryCatchList(expr, classes, parentenv, handlers)
3. tryCatchOne(expr, names, parentenv, handlers[[1L]])
4. doTryCatch(return(expr), name, parentenv, handler)
5. withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler)
6. repr::mime2repr[[mime]](obj)
7. repr_text.default(obj)
8. paste(capture.output(print(obj)), collapse = "\n")
9. capture.output(print(obj))
10. withVisible(...elt(i))
11. print(obj)
12. print.ggplot(obj)
13. ggplot_build(x)
14. ggplot_build.ggplot(x)
15. by_layer(function(l, d) l$compute_aesthetics(d, plot), layers, 
  .     data, "computing aesthetics")
16. try_fetch(for (i in seq_along(data)) {
  .     out[[i]] &lt;- f(l = layers[[i]], d = data[[i]])
  . }, error = function(cnd) {
  .     cli::cli_abort(c("Problem while {step}.", i = "Error occurred in the {ordinal(i)} layer."), 
  .         call = layers[[i]]$constructor, parent = cnd)
  . })
17. tryCatch(withCallingHandlers(expr, condition = function(cnd) {
  .     {
  .         .__handler_frame__. &lt;- TRUE
  .         .__setup_frame__. &lt;- frame
  .         if (inherits(cnd, "message")) {
  .             except &lt;- c("warning", "error")
  .         }
  .         else if (inherits(cnd, "warning")) {
  .             except &lt;- "error"
  .         }
  .         else {
  .             except &lt;- ""
  .         }
  .     }
  .     while (!is_null(cnd)) {
  .         if (inherits(cnd, "error")) {
  .             out &lt;- handlers[[1L]](cnd)
  .             if (!inherits(out, "rlang_zap")) 
  .                 throw(out)
  .         }
  .         inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .         if (is_false(inherit)) {
  .             return()
  .         }
  .         cnd &lt;- .subset2(cnd, "parent")
  .     }
  . }), stackOverflowError = handlers[[1L]])
18. tryCatchList(expr, classes, parentenv, handlers)
19. tryCatchOne(expr, names, parentenv, handlers[[1L]])
20. doTryCatch(return(expr), name, parentenv, handler)
21. withCallingHandlers(expr, condition = function(cnd) {
  .     {
  .         .__handler_frame__. &lt;- TRUE
  .         .__setup_frame__. &lt;- frame
  .         if (inherits(cnd, "message")) {
  .             except &lt;- c("warning", "error")
  .         }
  .         else if (inherits(cnd, "warning")) {
  .             except &lt;- "error"
  .         }
  .         else {
  .             except &lt;- ""
  .         }
  .     }
  .     while (!is_null(cnd)) {
  .         if (inherits(cnd, "error")) {
  .             out &lt;- handlers[[1L]](cnd)
  .             if (!inherits(out, "rlang_zap")) 
  .                 throw(out)
  .         }
  .         inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .         if (is_false(inherit)) {
  .             return()
  .         }
  .         cnd &lt;- .subset2(cnd, "parent")
  .     }
  . })
22. f(l = layers[[i]], d = data[[i]])
23. l$compute_aesthetics(d, plot)
24. compute_aesthetics(..., self = self)
25. cli::cli_abort(c("Aesthetics are not valid data columns.", x = "The following aesthetics are invalid:", 
  .     issues, i = "Did you mistype the name of a data column or forget to add {.fn after_stat}?"))
26. rlang::abort(message, ..., call = call, use_cli_format = TRUE, 
  .     .frame = .frame)
27. signal_abort(cnd, .file)
28. signalCondition(cnd)
29. (function (cnd) 
  . {
  .     {
  .         .__handler_frame__. &lt;- TRUE
  .         .__setup_frame__. &lt;- frame
  .         if (inherits(cnd, "message")) {
  .             except &lt;- c("warning", "error")
  .         }
  .         else if (inherits(cnd, "warning")) {
  .             except &lt;- "error"
  .         }
  .         else {
  .             except &lt;- ""
  .         }
  .     }
  .     while (!is_null(cnd)) {
  .         if (inherits(cnd, "error")) {
  .             out &lt;- handlers[[1L]](cnd)
  .             if (!inherits(out, "rlang_zap")) 
  .                 throw(out)
  .         }
  .         inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .         if (is_false(inherit)) {
  .             return()
  .         }
  .         cnd &lt;- .subset2(cnd, "parent")
  .     }
  . })(structure(list(message = structure("Aesthetics are not valid data columns.", names = ""), 
  .     trace = structure(list(call = list(IRkernel::main(), kernel$run(), 
  .         handle_shell(), executor$execute(msg), tryCatch(evaluate(request$content$code, 
  .             envir = .GlobalEnv, output_handler = oh, stop_on_error = 1L), 
  .             interrupt = function(cond) {
  .                 log_debug("Interrupt during execution")
  .                 interrupted &lt;&lt;- TRUE
  .             }, error = .self$handle_error), tryCatchList(expr, 
  .             classes, parentenv, handlers), tryCatchOne(tryCatchList(expr, 
  .             names[-nh], parentenv, handlers[-nh]), names[nh], 
  .             parentenv, handlers[[nh]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), tryCatchList(expr, names[-nh], 
  .             parentenv, handlers[-nh]), tryCatchOne(expr, names, 
  .             parentenv, handlers[[1L]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), evaluate(request$content$code, 
  .             envir = .GlobalEnv, output_handler = oh, stop_on_error = 1L), 
  .         evaluate_call(expr, parsed$src[[i]], envir = envir, enclos = enclos, 
  .             debug = debug, last = i == length(out), use_try = stop_on_error != 
  .                 2L, keep_warning = keep_warning, keep_message = keep_message, 
  .             output_handler = output_handler, include_timing = include_timing), 
  .         handle(pv &lt;- withCallingHandlers(withVisible(value_fun(ev$value, 
  .             ev$visible)), warning = wHandler, error = eHandler, 
  .             message = mHandler)), try(f, silent = TRUE), tryCatch(expr, 
  .             error = function(e) {
  .                 call &lt;- conditionCall(e)
  .                 if (!is.null(call)) {
  .                   if (identical(call[[1L]], quote(doTryCatch))) 
  .                     call &lt;- sys.call(-4L)
  .                   dcall &lt;- deparse(call, nlines = 1L)
  .                   prefix &lt;- paste("Error in", dcall, ": ")
  .                   LONG &lt;- 75L
  .                   sm &lt;- strsplit(conditionMessage(e), "\n")[[1L]]
  .                   w &lt;- 14L + nchar(dcall, type = "w") + nchar(sm[1L], 
  .                     type = "w")
  .                   if (is.na(w)) 
  .                     w &lt;- 14L + nchar(dcall, type = "b") + nchar(sm[1L], 
  .                       type = "b")
  .                   if (w &gt; LONG) 
  .                     prefix &lt;- paste0(prefix, "\n  ")
  .                 }
  .                 else prefix &lt;- "Error : "
  .                 msg &lt;- paste0(prefix, conditionMessage(e), "\n")
  .                 .Internal(seterrmessage(msg[1L]))
  .                 if (!silent &amp;&amp; isTRUE(getOption("show.error.messages"))) {
  .                   cat(msg, file = outFile)
  .                   .Internal(printDeferredWarnings())
  .                 }
  .                 invisible(structure(msg, class = "try-error", 
  .                   condition = e))
  .             }), tryCatchList(expr, classes, parentenv, handlers), 
  .         tryCatchOne(expr, names, parentenv, handlers[[1L]]), 
  .         doTryCatch(return(expr), name, parentenv, handler), withCallingHandlers(withVisible(value_fun(ev$value, 
  .             ev$visible)), warning = wHandler, error = eHandler, 
  .             message = mHandler), withVisible(value_fun(ev$value, 
  .             ev$visible)), value_fun(ev$value, ev$visible), prepare_mimebundle_kernel(obj, 
  .             .self$handle_display_error), prepare_mimebundle(obj, 
  .             "text/plain", error_handler = handle_display_error), 
  .         filter_map(mimetypes, function(mime) {
  .             tryCatch(withCallingHandlers({
  .                 if (!mime %in% names(repr::mime2repr)) 
  .                   stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
  .                 rpr &lt;- repr::mime2repr[[mime]](obj)
  .                 if (is.null(rpr)) 
  .                   return(NULL)
  .                 prepare_content(is.raw(rpr), rpr)
  .             }, error = error_handler), error = outer_handler)
  .         }), Filter(Negate(is.null), sapply(x, f, simplify = simplify)), 
  .         unlist(lapply(x, f)), lapply(x, f), sapply(x, f, simplify = simplify), 
  .         lapply(X = X, FUN = FUN, ...), FUN(X[[i]], ...), tryCatch(withCallingHandlers({
  .             if (!mime %in% names(repr::mime2repr)) 
  .                 stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
  .             rpr &lt;- repr::mime2repr[[mime]](obj)
  .             if (is.null(rpr)) 
  .                 return(NULL)
  .             prepare_content(is.raw(rpr), rpr)
  .         }, error = error_handler), error = outer_handler), tryCatchList(expr, 
  .             classes, parentenv, handlers), tryCatchOne(expr, 
  .             names, parentenv, handlers[[1L]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), withCallingHandlers({
  .             if (!mime %in% names(repr::mime2repr)) 
  .                 stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
  .             rpr &lt;- repr::mime2repr[[mime]](obj)
  .             if (is.null(rpr)) 
  .                 return(NULL)
  .             prepare_content(is.raw(rpr), rpr)
  .         }, error = error_handler), repr::mime2repr[[mime]](obj), 
  .         repr_text.default(obj), paste(capture.output(print(obj)), 
  .             collapse = "\n"), capture.output(print(obj)), withVisible(...elt(i)), 
  .         print(obj), print.ggplot(obj), ggplot_build(x), ggplot_build.ggplot(x), 
  .         by_layer(function(l, d) l$compute_aesthetics(d, plot), 
  .             layers, data, "computing aesthetics"), try_fetch(for (i in seq_along(data)) {
  .             out[[i]] &lt;- f(l = layers[[i]], d = data[[i]])
  .         }, error = function(cnd) {
  .             cli::cli_abort(c("Problem while {step}.", i = "Error occurred in the {ordinal(i)} layer."), 
  .                 call = layers[[i]]$constructor, parent = cnd)
  .         }), tryCatch(withCallingHandlers(expr, condition = function(cnd) {
  .             {
  .                 .__handler_frame__. &lt;- TRUE
  .                 .__setup_frame__. &lt;- frame
  .                 if (inherits(cnd, "message")) {
  .                   except &lt;- c("warning", "error")
  .                 }
  .                 else if (inherits(cnd, "warning")) {
  .                   except &lt;- "error"
  .                 }
  .                 else {
  .                   except &lt;- ""
  .                 }
  .             }
  .             while (!is_null(cnd)) {
  .                 if (inherits(cnd, "error")) {
  .                   out &lt;- handlers[[1L]](cnd)
  .                   if (!inherits(out, "rlang_zap")) 
  .                     throw(out)
  .                 }
  .                 inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .                 if (is_false(inherit)) {
  .                   return()
  .                 }
  .                 cnd &lt;- .subset2(cnd, "parent")
  .             }
  .         }), stackOverflowError = handlers[[1L]]), tryCatchList(expr, 
  .             classes, parentenv, handlers), tryCatchOne(expr, 
  .             names, parentenv, handlers[[1L]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), withCallingHandlers(expr, 
  .             condition = function(cnd) {
  .                 {
  .                   .__handler_frame__. &lt;- TRUE
  .                   .__setup_frame__. &lt;- frame
  .                   if (inherits(cnd, "message")) {
  .                     except &lt;- c("warning", "error")
  .                   }
  .                   else if (inherits(cnd, "warning")) {
  .                     except &lt;- "error"
  .                   }
  .                   else {
  .                     except &lt;- ""
  .                   }
  .                 }
  .                 while (!is_null(cnd)) {
  .                   if (inherits(cnd, "error")) {
  .                     out &lt;- handlers[[1L]](cnd)
  .                     if (!inherits(out, "rlang_zap")) 
  .                       throw(out)
  .                   }
  .                   inherit &lt;- .subset2(.subset2(cnd, "rlang"), 
  .                     "inherit")
  .                   if (is_false(inherit)) {
  .                     return()
  .                   }
  .                   cnd &lt;- .subset2(cnd, "parent")
  .                 }
  .             }), f(l = layers[[i]], d = data[[i]]), l$compute_aesthetics(d, 
  .             plot), compute_aesthetics(..., self = self), cli::cli_abort(c("Aesthetics are not valid data columns.", 
  .             x = "The following aesthetics are invalid:", issues, 
  .             i = "Did you mistype the name of a data column or forget to add {.fn after_stat}?")), 
  .         rlang::abort(message, ..., call = call, use_cli_format = TRUE, 
  .             .frame = .frame)), parent = c(0L, 1L, 2L, 3L, 4L, 
  .     5L, 6L, 7L, 6L, 9L, 10L, 4L, 12L, 13L, 14L, 15L, 16L, 17L, 
  .     18L, 13L, 13L, 13L, 22L, 23L, 24L, 25L, 26L, 26L, 25L, 29L, 
  .     30L, 31L, 32L, 33L, 34L, 31L, 31L, 31L, 38L, 38L, 40L, 38L, 
  .     38L, 43L, 43L, 45L, 46L, 47L, 48L, 49L, 50L, 47L, 46L, 53L, 
  .     54L, 55L, 56L), visible = c(TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     FALSE, FALSE), namespace = c("IRkernel", NA, "IRkernel", 
  .     NA, "base", "base", "base", "base", "base", "base", "base", 
  .     "evaluate", "evaluate", "evaluate", "base", "base", "base", 
  .     "base", "base", "base", "base", "IRkernel", "IRkernel", "IRdisplay", 
  .     "IRdisplay", "base", "base", "base", "base", "base", "IRdisplay", 
  .     "base", "base", "base", "base", "base", NA, "repr", "base", 
  .     "utils", "base", "base", "ggplot2", "ggplot2", "ggplot2", 
  .     "ggplot2", "rlang", "base", "base", "base", "base", "base", 
  .     "ggplot2", NA, "ggplot2", "cli", "rlang"), scope = c("::", 
  .     NA, "local", NA, "::", "local", "local", "local", "local", 
  .     "local", "local", "::", ":::", "local", "::", "::", "local", 
  .     "local", "local", "::", "::", "local", ":::", "::", ":::", 
  .     "::", "::", "::", "::", "::", "local", "::", "local", "local", 
  .     "local", "::", NA, ":::", "::", "::", "::", "::", ":::", 
  .     "::", ":::", ":::", "::", "::", "local", "local", "local", 
  .     "::", "local", NA, "local", "::", "::"), error_frame = c(FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, 
  .     FALSE, FALSE)), row.names = c(NA, -57L), version = 2L, class = c("rlang_trace", 
  .     "rlib_trace", "tbl", "data.frame")), parent = NULL, body = c(x = "The following aesthetics are invalid:", 
  .     x = "`x = time`", i = "Did you mistype the name of a data column or forget to add `after_stat()`?"
  .     ), rlang = list(inherit = TRUE), call = compute_aesthetics(..., 
  .         self = self), use_cli_format = TRUE), class = c("rlang_error", 
  . "error", "condition")))
30. handlers[[1L]](cnd)
31. cli::cli_abort(c("Problem while {step}.", i = "Error occurred in the {ordinal(i)} layer."), 
  .     call = layers[[i]]$constructor, parent = cnd)
32. rlang::abort(message, ..., call = call, use_cli_format = TRUE, 
  .     .frame = .frame)
33. signal_abort(cnd, .file)
Warning message in geom_line(aes(y = Melanoma), ylab = "Variable 2", axis.title.y = element_text(hjust = 1), :
“Ignoring unknown parameters: `ylab` and `axis.title.y`”
</pre>

<pre class="example" id="org7fb2c1b">
Error:
! Cannot add &lt;ggproto&gt; objects together
ℹ Did you forget to add this object to a &lt;ggplot&gt; object?
Traceback:

1. `+.gg`(geom_line(aes(y = GNP), color = "red"), geom_line(aes(y = Melanoma), 
 .     ylab = "Variable 2", axis.title.y = element_text(hjust = 1), 
 .     color = "blue"))
2. cli::cli_abort(c("Cannot add {.cls ggproto} objects together", 
 .     i = "Did you forget to add this object to a {.cls ggplot} object?"))
3. rlang::abort(message, ..., call = call, use_cli_format = TRUE, 
 .     .frame = .frame)
4. signal_abort(cnd, .file)
</pre>




<div class="org-src-container">
<pre class="src src-jupyter-R">ggplot(data_frame) + 
  geom_line(aes(x= date, y= GNP), color = <span style="color: #008000;">'dodgerblue'</span>) +
  geom_line(aes(x= date, y = Melanoma), color = <span style="color: #008000;">'black'</span>)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">+ </span>
<span style="color: #8D8D84;">#  </span><span style="color: #8D8D84; font-style: italic;">scale_y_continuous(sec.axis = sec_axis(~./scale_value, name = 'NEW'))</span>
</pre>
</div>

<pre class="example" id="org82a9868">
Don't know how to automatically pick scale for object of type &lt;function&gt;.
Defaulting to continuous.
ERROR while rich displaying an object: Error in `geom_line()`:
! Problem while computing aesthetics.
ℹ Error occurred in the 1st layer.
Caused by error in `compute_aesthetics()`:
! Aesthetics are not valid data columns.
✖ The following aesthetics are invalid:
✖ `x = date`
ℹ Did you mistype the name of a data column or forget to add `after_stat()`?

Traceback:
1. tryCatch(withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler), error = outer_handler)
2. tryCatchList(expr, classes, parentenv, handlers)
3. tryCatchOne(expr, names, parentenv, handlers[[1L]])
4. doTryCatch(return(expr), name, parentenv, handler)
5. withCallingHandlers({
 .     if (!mime %in% names(repr::mime2repr)) 
 .         stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
 .     rpr &lt;- repr::mime2repr[[mime]](obj)
 .     if (is.null(rpr)) 
 .         return(NULL)
 .     prepare_content(is.raw(rpr), rpr)
 . }, error = error_handler)
6. repr::mime2repr[[mime]](obj)
7. repr_text.default(obj)
8. paste(capture.output(print(obj)), collapse = "\n")
9. capture.output(print(obj))
10. withVisible(...elt(i))
11. print(obj)
12. print.ggplot(obj)
13. ggplot_build(x)
14. ggplot_build.ggplot(x)
15. by_layer(function(l, d) l$compute_aesthetics(d, plot), layers, 
  .     data, "computing aesthetics")
16. try_fetch(for (i in seq_along(data)) {
  .     out[[i]] &lt;- f(l = layers[[i]], d = data[[i]])
  . }, error = function(cnd) {
  .     cli::cli_abort(c("Problem while {step}.", i = "Error occurred in the {ordinal(i)} layer."), 
  .         call = layers[[i]]$constructor, parent = cnd)
  . })
17. tryCatch(withCallingHandlers(expr, condition = function(cnd) {
  .     {
  .         .__handler_frame__. &lt;- TRUE
  .         .__setup_frame__. &lt;- frame
  .         if (inherits(cnd, "message")) {
  .             except &lt;- c("warning", "error")
  .         }
  .         else if (inherits(cnd, "warning")) {
  .             except &lt;- "error"
  .         }
  .         else {
  .             except &lt;- ""
  .         }
  .     }
  .     while (!is_null(cnd)) {
  .         if (inherits(cnd, "error")) {
  .             out &lt;- handlers[[1L]](cnd)
  .             if (!inherits(out, "rlang_zap")) 
  .                 throw(out)
  .         }
  .         inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .         if (is_false(inherit)) {
  .             return()
  .         }
  .         cnd &lt;- .subset2(cnd, "parent")
  .     }
  . }), stackOverflowError = handlers[[1L]])
18. tryCatchList(expr, classes, parentenv, handlers)
19. tryCatchOne(expr, names, parentenv, handlers[[1L]])
20. doTryCatch(return(expr), name, parentenv, handler)
21. withCallingHandlers(expr, condition = function(cnd) {
  .     {
  .         .__handler_frame__. &lt;- TRUE
  .         .__setup_frame__. &lt;- frame
  .         if (inherits(cnd, "message")) {
  .             except &lt;- c("warning", "error")
  .         }
  .         else if (inherits(cnd, "warning")) {
  .             except &lt;- "error"
  .         }
  .         else {
  .             except &lt;- ""
  .         }
  .     }
  .     while (!is_null(cnd)) {
  .         if (inherits(cnd, "error")) {
  .             out &lt;- handlers[[1L]](cnd)
  .             if (!inherits(out, "rlang_zap")) 
  .                 throw(out)
  .         }
  .         inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .         if (is_false(inherit)) {
  .             return()
  .         }
  .         cnd &lt;- .subset2(cnd, "parent")
  .     }
  . })
22. f(l = layers[[i]], d = data[[i]])
23. l$compute_aesthetics(d, plot)
24. compute_aesthetics(..., self = self)
25. cli::cli_abort(c("Aesthetics are not valid data columns.", x = "The following aesthetics are invalid:", 
  .     issues, i = "Did you mistype the name of a data column or forget to add {.fn after_stat}?"))
26. rlang::abort(message, ..., call = call, use_cli_format = TRUE, 
  .     .frame = .frame)
27. signal_abort(cnd, .file)
28. signalCondition(cnd)
29. (function (cnd) 
  . {
  .     {
  .         .__handler_frame__. &lt;- TRUE
  .         .__setup_frame__. &lt;- frame
  .         if (inherits(cnd, "message")) {
  .             except &lt;- c("warning", "error")
  .         }
  .         else if (inherits(cnd, "warning")) {
  .             except &lt;- "error"
  .         }
  .         else {
  .             except &lt;- ""
  .         }
  .     }
  .     while (!is_null(cnd)) {
  .         if (inherits(cnd, "error")) {
  .             out &lt;- handlers[[1L]](cnd)
  .             if (!inherits(out, "rlang_zap")) 
  .                 throw(out)
  .         }
  .         inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .         if (is_false(inherit)) {
  .             return()
  .         }
  .         cnd &lt;- .subset2(cnd, "parent")
  .     }
  . })(structure(list(message = structure("Aesthetics are not valid data columns.", names = ""), 
  .     trace = structure(list(call = list(IRkernel::main(), kernel$run(), 
  .         handle_shell(), executor$execute(msg), tryCatch(evaluate(request$content$code, 
  .             envir = .GlobalEnv, output_handler = oh, stop_on_error = 1L), 
  .             interrupt = function(cond) {
  .                 log_debug("Interrupt during execution")
  .                 interrupted &lt;&lt;- TRUE
  .             }, error = .self$handle_error), tryCatchList(expr, 
  .             classes, parentenv, handlers), tryCatchOne(tryCatchList(expr, 
  .             names[-nh], parentenv, handlers[-nh]), names[nh], 
  .             parentenv, handlers[[nh]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), tryCatchList(expr, names[-nh], 
  .             parentenv, handlers[-nh]), tryCatchOne(expr, names, 
  .             parentenv, handlers[[1L]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), evaluate(request$content$code, 
  .             envir = .GlobalEnv, output_handler = oh, stop_on_error = 1L), 
  .         evaluate_call(expr, parsed$src[[i]], envir = envir, enclos = enclos, 
  .             debug = debug, last = i == length(out), use_try = stop_on_error != 
  .                 2L, keep_warning = keep_warning, keep_message = keep_message, 
  .             output_handler = output_handler, include_timing = include_timing), 
  .         handle(pv &lt;- withCallingHandlers(withVisible(value_fun(ev$value, 
  .             ev$visible)), warning = wHandler, error = eHandler, 
  .             message = mHandler)), try(f, silent = TRUE), tryCatch(expr, 
  .             error = function(e) {
  .                 call &lt;- conditionCall(e)
  .                 if (!is.null(call)) {
  .                   if (identical(call[[1L]], quote(doTryCatch))) 
  .                     call &lt;- sys.call(-4L)
  .                   dcall &lt;- deparse(call, nlines = 1L)
  .                   prefix &lt;- paste("Error in", dcall, ": ")
  .                   LONG &lt;- 75L
  .                   sm &lt;- strsplit(conditionMessage(e), "\n")[[1L]]
  .                   w &lt;- 14L + nchar(dcall, type = "w") + nchar(sm[1L], 
  .                     type = "w")
  .                   if (is.na(w)) 
  .                     w &lt;- 14L + nchar(dcall, type = "b") + nchar(sm[1L], 
  .                       type = "b")
  .                   if (w &gt; LONG) 
  .                     prefix &lt;- paste0(prefix, "\n  ")
  .                 }
  .                 else prefix &lt;- "Error : "
  .                 msg &lt;- paste0(prefix, conditionMessage(e), "\n")
  .                 .Internal(seterrmessage(msg[1L]))
  .                 if (!silent &amp;&amp; isTRUE(getOption("show.error.messages"))) {
  .                   cat(msg, file = outFile)
  .                   .Internal(printDeferredWarnings())
  .                 }
  .                 invisible(structure(msg, class = "try-error", 
  .                   condition = e))
  .             }), tryCatchList(expr, classes, parentenv, handlers), 
  .         tryCatchOne(expr, names, parentenv, handlers[[1L]]), 
  .         doTryCatch(return(expr), name, parentenv, handler), withCallingHandlers(withVisible(value_fun(ev$value, 
  .             ev$visible)), warning = wHandler, error = eHandler, 
  .             message = mHandler), withVisible(value_fun(ev$value, 
  .             ev$visible)), value_fun(ev$value, ev$visible), prepare_mimebundle_kernel(obj, 
  .             .self$handle_display_error), prepare_mimebundle(obj, 
  .             "text/plain", error_handler = handle_display_error), 
  .         filter_map(mimetypes, function(mime) {
  .             tryCatch(withCallingHandlers({
  .                 if (!mime %in% names(repr::mime2repr)) 
  .                   stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
  .                 rpr &lt;- repr::mime2repr[[mime]](obj)
  .                 if (is.null(rpr)) 
  .                   return(NULL)
  .                 prepare_content(is.raw(rpr), rpr)
  .             }, error = error_handler), error = outer_handler)
  .         }), Filter(Negate(is.null), sapply(x, f, simplify = simplify)), 
  .         unlist(lapply(x, f)), lapply(x, f), sapply(x, f, simplify = simplify), 
  .         lapply(X = X, FUN = FUN, ...), FUN(X[[i]], ...), tryCatch(withCallingHandlers({
  .             if (!mime %in% names(repr::mime2repr)) 
  .                 stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
  .             rpr &lt;- repr::mime2repr[[mime]](obj)
  .             if (is.null(rpr)) 
  .                 return(NULL)
  .             prepare_content(is.raw(rpr), rpr)
  .         }, error = error_handler), error = outer_handler), tryCatchList(expr, 
  .             classes, parentenv, handlers), tryCatchOne(expr, 
  .             names, parentenv, handlers[[1L]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), withCallingHandlers({
  .             if (!mime %in% names(repr::mime2repr)) 
  .                 stop("No repr_* for mimetype ", mime, " in repr::mime2repr")
  .             rpr &lt;- repr::mime2repr[[mime]](obj)
  .             if (is.null(rpr)) 
  .                 return(NULL)
  .             prepare_content(is.raw(rpr), rpr)
  .         }, error = error_handler), repr::mime2repr[[mime]](obj), 
  .         repr_text.default(obj), paste(capture.output(print(obj)), 
  .             collapse = "\n"), capture.output(print(obj)), withVisible(...elt(i)), 
  .         print(obj), print.ggplot(obj), ggplot_build(x), ggplot_build.ggplot(x), 
  .         by_layer(function(l, d) l$compute_aesthetics(d, plot), 
  .             layers, data, "computing aesthetics"), try_fetch(for (i in seq_along(data)) {
  .             out[[i]] &lt;- f(l = layers[[i]], d = data[[i]])
  .         }, error = function(cnd) {
  .             cli::cli_abort(c("Problem while {step}.", i = "Error occurred in the {ordinal(i)} layer."), 
  .                 call = layers[[i]]$constructor, parent = cnd)
  .         }), tryCatch(withCallingHandlers(expr, condition = function(cnd) {
  .             {
  .                 .__handler_frame__. &lt;- TRUE
  .                 .__setup_frame__. &lt;- frame
  .                 if (inherits(cnd, "message")) {
  .                   except &lt;- c("warning", "error")
  .                 }
  .                 else if (inherits(cnd, "warning")) {
  .                   except &lt;- "error"
  .                 }
  .                 else {
  .                   except &lt;- ""
  .                 }
  .             }
  .             while (!is_null(cnd)) {
  .                 if (inherits(cnd, "error")) {
  .                   out &lt;- handlers[[1L]](cnd)
  .                   if (!inherits(out, "rlang_zap")) 
  .                     throw(out)
  .                 }
  .                 inherit &lt;- .subset2(.subset2(cnd, "rlang"), "inherit")
  .                 if (is_false(inherit)) {
  .                   return()
  .                 }
  .                 cnd &lt;- .subset2(cnd, "parent")
  .             }
  .         }), stackOverflowError = handlers[[1L]]), tryCatchList(expr, 
  .             classes, parentenv, handlers), tryCatchOne(expr, 
  .             names, parentenv, handlers[[1L]]), doTryCatch(return(expr), 
  .             name, parentenv, handler), withCallingHandlers(expr, 
  .             condition = function(cnd) {
  .                 {
  .                   .__handler_frame__. &lt;- TRUE
  .                   .__setup_frame__. &lt;- frame
  .                   if (inherits(cnd, "message")) {
  .                     except &lt;- c("warning", "error")
  .                   }
  .                   else if (inherits(cnd, "warning")) {
  .                     except &lt;- "error"
  .                   }
  .                   else {
  .                     except &lt;- ""
  .                   }
  .                 }
  .                 while (!is_null(cnd)) {
  .                   if (inherits(cnd, "error")) {
  .                     out &lt;- handlers[[1L]](cnd)
  .                     if (!inherits(out, "rlang_zap")) 
  .                       throw(out)
  .                   }
  .                   inherit &lt;- .subset2(.subset2(cnd, "rlang"), 
  .                     "inherit")
  .                   if (is_false(inherit)) {
  .                     return()
  .                   }
  .                   cnd &lt;- .subset2(cnd, "parent")
  .                 }
  .             }), f(l = layers[[i]], d = data[[i]]), l$compute_aesthetics(d, 
  .             plot), compute_aesthetics(..., self = self), cli::cli_abort(c("Aesthetics are not valid data columns.", 
  .             x = "The following aesthetics are invalid:", issues, 
  .             i = "Did you mistype the name of a data column or forget to add {.fn after_stat}?")), 
  .         rlang::abort(message, ..., call = call, use_cli_format = TRUE, 
  .             .frame = .frame)), parent = c(0L, 1L, 2L, 3L, 4L, 
  .     5L, 6L, 7L, 6L, 9L, 10L, 4L, 12L, 13L, 14L, 15L, 16L, 17L, 
  .     18L, 13L, 13L, 13L, 22L, 23L, 24L, 25L, 26L, 26L, 25L, 29L, 
  .     30L, 31L, 32L, 33L, 34L, 31L, 31L, 31L, 38L, 38L, 40L, 38L, 
  .     38L, 43L, 43L, 45L, 46L, 47L, 48L, 49L, 50L, 47L, 46L, 53L, 
  .     54L, 55L, 56L), visible = c(TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 
  .     FALSE, FALSE), namespace = c("IRkernel", NA, "IRkernel", 
  .     NA, "base", "base", "base", "base", "base", "base", "base", 
  .     "evaluate", "evaluate", "evaluate", "base", "base", "base", 
  .     "base", "base", "base", "base", "IRkernel", "IRkernel", "IRdisplay", 
  .     "IRdisplay", "base", "base", "base", "base", "base", "IRdisplay", 
  .     "base", "base", "base", "base", "base", NA, "repr", "base", 
  .     "utils", "base", "base", "ggplot2", "ggplot2", "ggplot2", 
  .     "ggplot2", "rlang", "base", "base", "base", "base", "base", 
  .     "ggplot2", NA, "ggplot2", "cli", "rlang"), scope = c("::", 
  .     NA, "local", NA, "::", "local", "local", "local", "local", 
  .     "local", "local", "::", ":::", "local", "::", "::", "local", 
  .     "local", "local", "::", "::", "local", ":::", "::", ":::", 
  .     "::", "::", "::", "::", "::", "local", "::", "local", "local", 
  .     "local", "::", NA, ":::", "::", "::", "::", "::", ":::", 
  .     "::", ":::", ":::", "::", "::", "local", "local", "local", 
  .     "::", "local", NA, "local", "::", "::"), error_frame = c(FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, 
  .     FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, 
  .     FALSE, FALSE)), row.names = c(NA, -57L), version = 2L, class = c("rlang_trace", 
  .     "rlib_trace", "tbl", "data.frame")), parent = NULL, body = c(x = "The following aesthetics are invalid:", 
  .     x = "`x = date`", i = "Did you mistype the name of a data column or forget to add `after_stat()`?"
  .     ), rlang = list(inherit = TRUE), call = compute_aesthetics(..., 
  .         self = self), use_cli_format = TRUE), class = c("rlang_error", 
  . "error", "condition")))
30. handlers[[1L]](cnd)
31. cli::cli_abort(c("Problem while {step}.", i = "Error occurred in the {ordinal(i)} layer."), 
  .     call = layers[[i]]$constructor, parent = cnd)
32. rlang::abort(message, ..., call = call, use_cli_format = TRUE, 
  .     .frame = .frame)
33. signal_abort(cnd, .file)
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">install.packages(c("ggfortify", "tfarima"))</span>
<span style="color: #D0372D;">library</span>(ggfortify)
</pre>
</div>

<pre class="example">
Installing packages into ‘/home/marcos/R/x86_64-pc-linux-gnu-library/4.2’
(as ‘lib’ is unspecified)

</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">autoplot(ts( data ),
         facets = <span style="color: #6434A3;">FALSE</span>)
</pre>
</div>


<div id="org7c2aeac" class="figure">
<p><img src="./.ob-jupyter/61c2344a53103fa616ce41035315f7c9e3d42841.png" alt="61c2344a53103fa616ce41035315f7c9e3d42841.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Plot a graph with time_data1</span>
plot(data,                           
     data$GNP,
     type = <span style="color: #008000;">"l"</span>,
     col = 2,
     ylim = c(- 15, 40),
     xlab = <span style="color: #008000;">"Year"</span>,
     ylab = <span style="color: #008000;">"Values"</span>)
</pre>
</div>


<div id="org352db31" class="figure">
<p><img src="./.ob-jupyter/cd76a7ce844e5a0fb48003b6dd52fadb5553afb1.png" alt="cd76a7ce844e5a0fb48003b6dd52fadb5553afb1.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-R">plot(data,                           
     type = <span style="color: #008000;">"l"</span>,
     col = 2,
     ylim = c(- 15, 40),
     xlab = <span style="color: #008000;">"Year"</span>,
     ylab = <span style="color: #008000;">"Values"</span>)
</pre>
</div>


<div id="org8cb6a4f" class="figure">
<p><img src="./.ob-jupyter/cd76a7ce844e5a0fb48003b6dd52fadb5553afb1.png" alt="cd76a7ce844e5a0fb48003b6dd52fadb5553afb1.png" />
</p>
</div>
<div id="outline-container-org5f5b6c9" class="outline-2">
<h2 id="org5f5b6c9"><span class="section-number-2">1.</span> Internat. airline passengers: monthly totals in thousands. Jan 49 – Dec 60</h2>
<div class="outline-text-2" id="text-1">
<p>
Cargamos famosa serie de <i>'líneas aéreas'</i> en la variable <code>Z</code>
</p>
<div class="org-src-container">
<pre class="src src-jupyter-R">Z <span style="color: #D0372D;">&lt;-</span> AirPassengers
</pre>
</div>

<p>
Representación de la serie temporal y su gráfico <i>rango-media</i>
</p>
<div class="org-src-container">
<pre class="src src-jupyter-R">ide(Z, graphs = c(<span style="color: #008000;">"plot"</span>, <span style="color: #008000;">"rm"</span>))
</pre>
</div>


<div id="orgaf45924" class="figure">
<p><img src="./img/foo.png" alt="foo.png" />
</p>
</div>

<p>
Más gráficos (en este caso voy a ocultar el código en la presentación
<code>html</code>).
</p>
<div class="org-src-container">
<pre class="src src-jupyter-R">ide(Z, transf = list(list(bc = <span style="color: #6434A3;">TRUE</span>, S = <span style="color: #6434A3;">TRUE</span>), list(bc = <span style="color: #6434A3;">TRUE</span>, d = 1, D = 1)))
</pre>
</div>



<div id="orgb6413e4" class="figure">
<p><img src="./img/fuu.png" alt="fuu.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R" id="org4b1730d"><span style="color: #D0372D;">options</span>(repr.plot.width = 12, repr.plot.height = 8, repr.plot.res = 200)
ide(Z, transf = list(list(bc = T), list(bc = T, S = 1), list(bc = T, D = 1), list(bc = T, D = 1, d = 1)))
</pre>
</div>


<div id="orgf885efb" class="figure">
<p><img src="./img/idesVarios.png" alt="idesVarios.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #D0372D;">options</span>(repr.plot.width = 12, repr.plot.height = 4, repr.plot.res = 200)
ide(Z, transf = list(list(bc = <span style="color: #6434A3;">TRUE</span>, S = <span style="color: #6434A3;">TRUE</span>), list(bc = <span style="color: #6434A3;">TRUE</span>, d = 1, D = 1)))
</pre>
</div>


<div id="orgea79e35" class="figure">
<p><img src="./.ob-jupyter/8071a1e0a8f563db61554d1cdaa92919fa01f58d.png" alt="8071a1e0a8f563db61554d1cdaa92919fa01f58d.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">um1 <span style="color: #D0372D;">&lt;-</span> um(AirPassengers, bc = <span style="color: #6434A3;">TRUE</span>, i = list(1, c(1, 12)), ma = list(1, c(1, 12)))
um1
</pre>
</div>

<pre class="example">
        Estimate Std. Error
theta1 0.4018464 0.07656434
theta2 0.5570393 0.07401700

log likelihood:  244.6965
Residual standard error:  0.03513935
aic: -3.70529
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">um2 <span style="color: #D0372D;">&lt;-</span> um(i = list(1, c(1, 12)), ma = list(1, c(1, 12)), bc = <span style="color: #6434A3;">TRUE</span>)
um2
</pre>
</div>

<pre class="example">
theta1 theta2   sig2 
   0.2    0.2    1.0 
</pre>



<div class="org-src-container">
<pre class="src src-jupyter-R">um2 <span style="color: #D0372D;">&lt;-</span> um(i = list(1, c(1, 12)), ma = list(1, c(1, 12)), bc = <span style="color: #6434A3;">TRUE</span>)
fit(um2, AirPassengers)
</pre>
</div>

<pre class="example">
        Estimate Std. Error
theta1 0.4018464 0.07656434
theta2 0.5570393 0.07401700

log likelihood:  244.6965
Residual standard error:  0.03513935
aic: -3.70529
</pre>



<div class="org-src-container">
<pre class="src src-jupyter-R">arima(log(AirPassengers), order = c(0,1,1), seasonal = list(order = c(0,1,1), frequency = 12))
</pre>
</div>

<pre class="example" id="orgf72cd80">

Call:
arima(x = log(AirPassengers), order = c(0, 1, 1), seasonal = list(order = c(0, 
    1, 1), frequency = 12))

Coefficients:
          ma1     sma1
      -0.4018  -0.5569
s.e.   0.0896   0.0731

sigma^2 estimated as 0.001348:  log likelihood = 244.7,  aic = -483.4
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">summary(um1)
</pre>
</div>

<pre class="example" id="org8cfbe31">

Model:
 um1  &lt;-  um(z = AirPassengers, i = list(1, c(1, 12)), ma = list(1, c(1, 12)), bc = TRUE) 

Time series:
AirPassengers 

Maximum likelihood method:
 exact 

Coefficients:
        Estimate  Gradient Std. Error z Value Pr(&gt;|z|)    
theta1 4.018e-01 6.544e-06  7.656e-02   5.248 1.53e-07 ***
theta2 5.570e-01 2.775e-05  7.402e-02   7.526 5.24e-14 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Total nobs                  144 Effective nobs              131 
log likelihood            244.7 Error variance         0.001348 
Mean of residuals    -0.0004231 SD of the residuals     0.03514 
z-test for residuals    -0.1445 p-value                  0.8851 
Ljung-Box Q(1) st.        10.08 p-value                0.001495 
Ljung-Box Q(32) st.        47.4 p-value                 0.03906 
Barlett H(3) stat.        1.138 p-value                   0.566 
AIC                      -3.705 BIC                      -3.661 
</pre>

<div class="org-src-container">
<pre class="src src-jupyter-R">diagchk(um1)
</pre>
</div>


<div id="org25e2f10" class="figure">
<p><img src="./.ob-jupyter/6ea247164c82550b76a5f2c348042a4765f20c90.png" alt="6ea247164c82550b76a5f2c348042a4765f20c90.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">modify(um2, ar = list(2, c(2, 12)))
</pre>
</div>

<pre class="example">
phi1   phi2   phi3   phi4 theta1 theta2   sig2 
0.01   0.10   0.01   0.10   0.20   0.20   1.00 
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">printLagpolList(modify(um2, ar = list(2, c(2, 12)))$ar)
</pre>
</div>

<pre class="example">
[1] 1 - 0.01B - 0.1B^2   [2] 1 - 0.01B^12 - 0.1B^24 
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">printLagpolList(um2$ma)
</pre>
</div>

<pre class="example">
[1] 1 - 0.2B   [2] 1 - 0.2B^12 
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">printLagpolList(um2$i)
</pre>
</div>

<pre class="example">
[1] 1 - B   [2] 1 - B^12 
</pre>



<div class="org-src-container">
<pre class="src src-jupyter-R">um3 <span style="color: #D0372D;">&lt;-</span> modify(um1, ar = list(2, c(2, 12)))
um3
</pre>
</div>

<pre class="example" id="org5611cbe">
          Estimate Std. Error
phi1    0.55477214 0.08502302
phi2    0.24975326 0.08322806
phi3   -0.09466045 0.23810134
phi4   -0.03393216 0.14198888
theta1  0.96372038 0.04100168
theta2  0.48331617 0.23071063

log likelihood:  246.2311
Residual standard error:  0.03447009
aic: -3.66765
</pre>

<div class="org-src-container">
<pre class="src src-jupyter-R">printLagpolList(um3$ma)
</pre>
</div>

<pre class="example">
[1] 1 - 0.96B   [2] 1 - 0.48B^12 
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">printLagpolList(um3$i)
</pre>
</div>

<pre class="example">
[1] 1 - B   [2] 1 - B^12 
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">printLagpolList(um3$ar)
</pre>
</div>

<pre class="example">
[1] 1 - 0.55B - 0.25B^2   [2] 1 + 0.095B^12 + 0.034B^24 
</pre>



<div class="org-src-container">
<pre class="src src-jupyter-R">modify(um1, ar = list(2, c(2, 12)))
</pre>
</div>

<pre class="example" id="orgdf66f81">
          Estimate Std. Error
phi1    0.55477214 0.08502302
phi2    0.24975326 0.08322806
phi3   -0.09466045 0.23810134
phi4   -0.03393216 0.14198888
theta1  0.96372038 0.04100168
theta2  0.48331617 0.23071063

log likelihood:  246.2311
Residual standard error:  0.03447009
aic: -3.66765
</pre>

<div class="org-src-container">
<pre class="src src-jupyter-R">um1
</pre>
</div>

<pre class="example">
        Estimate Std. Error
theta1 0.4018464 0.07656434
theta2 0.5570393 0.07401700

log likelihood:  244.6965
Residual standard error:  0.03513935
aic: -3.70529
</pre>



<div class="org-src-container">
<pre class="src src-jupyter-R">um4 <span style="color: #D0372D;">&lt;-</span> modify(um2, ma = list(-1, -2, 2, c(2, 12)))
printLagpolList(um4$ma)
</pre>
</div>

<pre class="example">
[1] 1 - 0.02B - 0.2B^2   [2] 1 - 0.02B^12 - 0.2B^24 
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">theta(um2)

theta(um4)
</pre>
</div>

<pre class="example">
1 - 0.2B - 0.2B^12 + 0.04B^13 
1 - 0.02B - 0.2B^2 - 0.02B^12 + 4e-04B^13 + 0.004B^14 - 0.2B^24 + 0.004B^25 +  
0.04B^26 
</pre>
</div>
<div id="outline-container-orgc67e324" class="outline-4">
<h4 id="orgc67e324"><span class="section-number-4">1.0.1.</span> Forecast</h4>
<div class="outline-text-4" id="text-1-0-1">
<div class="org-src-container">
<pre class="src src-jupyter-R">p <span style="color: #D0372D;">&lt;-</span> predict(um1, n.ahead = 12)
plot(p, n.back = 48)
</pre>
</div>


<div id="org9fd556e" class="figure">
<p><img src="./.ob-jupyter/295900ad40241e6381168a41555477c07e859693.png" alt="295900ad40241e6381168a41555477c07e859693.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org8dd9495" class="outline-4">
<h4 id="org8dd9495"><span class="section-number-4">1.0.2.</span> uc</h4>
<div class="outline-text-4" id="text-1-0-2">
<div class="org-src-container">
<pre class="src src-jupyter-R">uc1 <span style="color: #D0372D;">&lt;-</span> ucomp(um1)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plot(uc1)</span>
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">library(RJDemetra)</span>
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">ts1 &lt;- tramoseats(AirPassengers, spec = "RSA5")</span>
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">plot(ts1$final$series[,4], ylab = expression('S'[t]), col = "gray")</span>
plot(exp(uc1$seas), lty = 2)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">lines(exp(uc1$seas), lty = 2)</span>
</pre>
</div>


<div id="orgf992862" class="figure">
<p><img src="./.ob-jupyter/9832803fa1ce32459adcc26d39cb84c61f4f0ecf.png" alt="9832803fa1ce32459adcc26d39cb84c61f4f0ecf.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org7b2a9d3" class="outline-4">
<h4 id="org7b2a9d3"><span class="section-number-4">1.0.3.</span> con dummies</h4>
<div class="outline-text-4" id="text-1-0-3">
<div class="org-src-container">
<pre class="src src-jupyter-R">t <span style="color: #D0372D;">&lt;-</span> 0:(length(AirPassengers) - 1)
D <span style="color: #D0372D;">&lt;-</span> as.factor(cycle(AirPassengers))
reg <span style="color: #D0372D;">&lt;-</span> lm(log(AirPassengers) ~ t + D)
ima1 <span style="color: #D0372D;">&lt;-</span> um(AirPassengers, , bc = <span style="color: #6434A3;">TRUE</span>, i = list(1, c(1, 12)), ma = <span style="color: #008000;">"(1-B)(1-B12)"</span>, fit = <span style="color: #6434A3;">FALSE</span>)
ima2 <span style="color: #D0372D;">&lt;-</span> arima(log(AirPassengers), order = c(0,1,1), seasonal = list(order = c(0,1,1), frequency = 12), fixed = c(-1, -1), transform.pars = <span style="color: #6434A3;">FALSE</span>, method = <span style="color: #008000;">"ML"</span>)
res1 <span style="color: #D0372D;">&lt;-</span> ts(residuals(reg), start = start(AirPassengers), frequency = 12)
res2 <span style="color: #D0372D;">&lt;-</span> residuals(ima1)
res3 <span style="color: #D0372D;">&lt;-</span> residuals(ima2)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-R">ide(res1)
</pre>
</div>


<div id="org2e780d6" class="figure">
<p><img src="./.ob-jupyter/5d59369842d7375a891af7376186d2e4086ea683.png" alt="5d59369842d7375a891af7376186d2e4086ea683.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">ide(res2)
</pre>
</div>


<div id="orgad5ee13" class="figure">
<p><img src="./.ob-jupyter/645fa849b67a69c46a31fac64bfe62f3124e644f.png" alt="645fa849b67a69c46a31fac64bfe62f3124e644f.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">ide(res3)
</pre>
</div>


<div id="org08ba362" class="figure">
<p><img src="./.ob-jupyter/c82967fb69f8b1f4316d1000f563d7ddb5583fc5.png" alt="c82967fb69f8b1f4316d1000f563d7ddb5583fc5.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-R">reg
</pre>
</div>

<pre class="example" id="org9807be3">

Call:
lm(formula = log(AirPassengers) ~ t + D)

Coefficients:
(Intercept)            t           D2           D3           D4           D5  
   4.736849     0.010069    -0.022055     0.108172     0.076903     0.074531  
         D6           D7           D8           D9          D10          D11  
   0.196677     0.300619     0.291324     0.146690     0.008532    -0.135186  
        D12  
  -0.021321  
</pre>

<div class="org-src-container">
<pre class="src src-jupyter-R">D
</pre>
</div>

<ol class="org-ol">
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
<li>8</li>
<li>9</li>
<li>10</li>
<li>11</li>
<li>12</li>
</ol>

<p>
<b>Levels</b>:
</p>

<ol class="org-ol">
<li>'1'</li>
<li>'2'</li>
<li>'3'</li>
<li>'4'</li>
<li>'5'</li>
<li>'6'</li>
<li>'7'</li>
<li>'8'</li>
<li>'9'</li>
<li>'10'</li>
<li>'11'</li>
<li>'12'</li>
</ol>

<div class="org-src-container">
<pre class="src src-jupyter-R">t <span style="color: #D0372D;">&lt;-</span> 0:(length(AirPassengers) - 1)
t2 <span style="color: #D0372D;">&lt;-</span> t*t
D <span style="color: #D0372D;">&lt;-</span> as.factor(cycle(AirPassengers))
reg2 <span style="color: #D0372D;">&lt;-</span> lm(log(AirPassengers) ~ t + t2 + D)
res4 <span style="color: #D0372D;">&lt;-</span> ts(residuals(reg2), start = start(AirPassengers), frequency = 12)
reg2
</pre>
</div>

<pre class="example" id="org0fb67cd">

Call:
lm(formula = log(AirPassengers) ~ t + t2 + D)

Coefficients:
(Intercept)            t           t2           D2           D3           D4  
  4.665e+00    1.314e-02   -2.148e-05   -2.227e-02    1.078e-01    7.639e-02  
         D5           D6           D7           D8           D9          D10  
  7.393e-02    1.960e-01    3.000e-01    2.907e-01    1.462e-01    8.145e-03  
        D11          D12  
 -1.354e-01   -2.132e-02  
</pre>

<div class="org-src-container">
<pre class="src src-jupyter-R">summary(reg2)
</pre>
</div>

<pre class="example" id="orgcbd44b8">

Call:
lm(formula = log(AirPassengers) ~ t + t2 + D)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.12748 -0.03709  0.00418  0.03197  0.11529 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.665e+00  1.764e-02 264.458  &lt; 2e-16 ***
t            1.314e-02  3.841e-04  34.209  &lt; 2e-16 ***
t2          -2.148e-05  2.599e-06  -8.265 1.41e-13 ***
D2          -2.227e-02  1.968e-02  -1.132 0.259839    
D3           1.078e-01  1.968e-02   5.477 2.15e-07 ***
D4           7.639e-02  1.968e-02   3.882 0.000164 ***
D5           7.393e-02  1.968e-02   3.756 0.000259 ***
D6           1.960e-01  1.968e-02   9.959  &lt; 2e-16 ***
D7           3.000e-01  1.969e-02  15.238  &lt; 2e-16 ***
D8           2.907e-01  1.969e-02  14.765  &lt; 2e-16 ***
D9           1.462e-01  1.969e-02   7.423 1.33e-11 ***
D10          8.145e-03  1.970e-02   0.414 0.679912    
D11         -1.354e-01  1.970e-02  -6.873 2.36e-10 ***
D12         -2.132e-02  1.971e-02  -1.082 0.281286    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.0482 on 130 degrees of freedom
Multiple R-squared:  0.9892,	Adjusted R-squared:  0.9881 
F-statistic: 912.7 on 13 and 130 DF,  p-value: &lt; 2.2e-16
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">ide(res4)
</pre>
</div>


<div id="orga965083" class="figure">
<p><img src="./.ob-jupyter/8df05aec1ebf5d2e1d58833299d0632352ce9a7d.png" alt="8df05aec1ebf5d2e1d58833299d0632352ce9a7d.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R">res5 = residuals(um(AirPassengers, , bc = <span style="color: #6434A3;">TRUE</span>, i = list(1, c(1, 12)), ma = <span style="color: #008000;">"(1-B)(1-B12)"</span>, fit = <span style="color: #6434A3;">FALSE</span>))
ide(res5)
</pre>
</div>


<div id="org7b6be54" class="figure">
<p><img src="./.ob-jupyter/b0132524d865d9fbc4439afcc9d14d2abe15a406.png" alt="b0132524d865d9fbc4439afcc9d14d2abe15a406.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-R">res6 = residuals(um(AirPassengers, , bc = <span style="color: #6434A3;">TRUE</span>, i = <span style="color: #008000;">"(1-B)(1-B12)"</span>, ma = <span style="color: #008000;">"(1-B)(1-B12)"</span>, fit = <span style="color: #6434A3;">FALSE</span>))
ide(res6)
</pre>
</div>


<div id="orgec7374d" class="figure">
<p><img src="./.ob-jupyter/b25a3bc50a6f62490a446af656ead3e094e5491c.png" alt="b25a3bc50a6f62490a446af656ead3e094e5491c.png" />
</p>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #D0372D;">library</span>(lmtest)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">install.packages('lmtest')</span>
</pre>
</div>

<pre class="example" id="org720ea18">
Loading required package: zoo


Attaching package: ‘zoo’
The following objects are masked from ‘package:base’:

    as.Date, as.Date.numeric
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">bgtest(reg2)
</pre>
</div>

<pre class="example">

	Breusch-Godfrey test for serial correlation of order up to 1

data:  reg2
LM test = 64.862, df = 1, p-value = 8.034e-16

</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">dwtest(res6 ~ t + t2 + D)
</pre>
</div>

<pre class="example">

	Durbin-Watson test

data:  res6 ~ t + t2 + D
DW = 0.64792, p-value = 1.11e-15
alternative hypothesis: true autocorrelation is greater than 0

</pre>





<div class="org-src-container">
<pre class="src src-jupyter-R">step(reg2, direction = <span style="color: #008000;">"backward"</span>, test = <span style="color: #008000;">"F"</span>)
</pre>
</div>

<pre class="example">
Start:  AIC=-860.06
log(AirPassengers) ~ t + t2 + D

       Df Sum of Sq     RSS     AIC  F value    Pr(&gt;F)    
&lt;none&gt;              0.30202 -860.06                       
- t2    1   0.15869 0.46072 -801.25   68.307 1.409e-13 ***
- D    11   2.27793 2.57996 -573.17   89.136 &lt; 2.2e-16 ***
- t     1   2.71886 3.02088 -530.45 1170.285 &lt; 2.2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>

<pre class="example" id="orga02010f">

Call:
lm(formula = log(AirPassengers) ~ t + t2 + D)

Coefficients:
(Intercept)            t           t2           D2           D3           D4  
  4.665e+00    1.314e-02   -2.148e-05   -2.227e-02    1.078e-01    7.639e-02  
         D5           D6           D7           D8           D9          D10  
  7.393e-02    1.960e-01    3.000e-01    2.907e-01    1.462e-01    8.145e-03  
        D11          D12  
 -1.354e-01   -2.132e-02  
</pre>
</div>
<ol class="org-ol">
<li><a id="orgacb3b55"></a>dummies<br /></li>
</ol>
</div>
<div id="outline-container-orgce4ea00" class="outline-3">
<h3 id="orgce4ea00"><span class="section-number-3">1.1.</span> ECM</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">install.packages("orcutt")</span>
<span style="color: #D0372D;">library</span>(orcutt)
</pre>
</div>

<pre class="example">
Installing package into ‘/home/marcos/R/x86_64-pc-linux-gnu-library/4.2’
(as ‘lib’ is unspecified)

</pre>



<div class="org-src-container">
<pre class="src src-jupyter-R">summary(cochrane.orcutt(reg9))
</pre>
</div>

<pre class="example">
Error in model.matrix(reg): objeto 'reg9' no encontrado
Traceback:

1. summary(cochrane.orcutt(reg9))
2. cochrane.orcutt(reg9)
3. model.matrix(reg)
</pre>


<p>
<a href="https://online.stat.psu.edu/stat510/lesson/8/8.1">https://online.stat.psu.edu/stat510/lesson/8/8.1</a>
</p>

<p>
<a href="https://online.stat.psu.edu/stat510/lesson/14/14.1">https://online.stat.psu.edu/stat510/lesson/14/14.1</a>
</p>

<div class="org-src-container">
<pre class="src src-jupyter-R">DDD <span style="color: #D0372D;">&lt;-</span> sdummies(AirPassengers, ref = 12)
is.matrix(DDD)
reg18 <span style="color: #D0372D;">&lt;-</span> lm(log(AirPassengers) ~ t +t2 + ., data = as.data.frame(DDD))
summary(reg18)
</pre>
</div>

<pre class="example">
bebb5aed-36fd-4207-a52f-1cc972ac0990
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">DDD</span>
summary(cochrane.orcutt(reg18))
</pre>
</div>

<pre class="example">
249b0d4f-4b26-4eff-a2c3-727ab9f9c13a
</pre>


<div class="org-src-container">
<pre class="src src-jupyter-R">reg19 <span style="color: #D0372D;">&lt;-</span> step(reg18, direction = <span style="color: #008000;">"backward"</span>, test = <span style="color: #008000;">"F"</span>)
summary(reg19)

</pre>
</div>

<pre class="example">
d099518a-8529-477b-8ad9-df0a70c2f2cc
</pre>
</div>
<ul class="org-ul">
<li><a id="orgf1ea357"></a>Lectura datos: Internat. airline passengers. Monthly totals in thousands. Jan 49 – Dec 60<br />
<div class="outline-text-5" id="text-orgf1ea357">
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Leemos los datos de un fichero csv y generamos un dataframe de pandas cuyo &#237;ndice es el tiempo</span>
<span style="color: #BA36A5;">OrigData</span> = pd.read_csv(<span style="color: #008000;">'./database/Datasets-master/airline-passengers.csv'</span>)
<span style="color: #BA36A5;">OrigData</span>[<span style="color: #008000;">'Month'</span>] = pd.to_datetime(OrigData[<span style="color: #008000;">'Month'</span>])
<span style="color: #BA36A5;">OrigData</span> = OrigData.set_index([<span style="color: #008000;">'Month'</span>])
<span style="color: #006FE0;">print</span>(OrigData.head())
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Creamos un dataframe con el mismo &#237;ndice temporal de los datos originales pero con los datos en logaritmos</span>
<span style="color: #BA36A5;">TransformedData</span> = pd.DataFrame(index=OrigData.index)
<span style="color: #BA36A5;">TransformedData</span>[<span style="color: #008000;">'dataLog'</span>] = np.log(OrigData[<span style="color: #008000;">'Passengers'</span>])
<span style="color: #006FE0;">print</span>(TransformedData.head())
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-org827f70d" class="outline-2">
<h2 id="org827f70d"><span class="section-number-2">2.</span> Descomposición estructural de una serie temporal</h2>
<div class="outline-text-2" id="text-2">
<p>
En la lección anterior vimos que una estrategia para analizar series
temporales es transformar los datos para
</p>

<ol class="org-ol">
<li>primero lograr que sean "<b><i>estacionarios</i></b>" y</li>
<li>después, mediante más transformaciones, lograr una secuencia de
"<b>datos <i>i.i.d</i></b>" (este segundo paso aún no lo hemos abordado)</li>
</ol>
<p>
(<i>recuerde que las expresiones "datos estacionarios" o "datos i.i.d." son un abuso del lenguaje</i>).
</p>

<p>
Pero existe otro enfoque que pretende descomponer la serie temporal en
los siguientes componentes <i>"no observables"</i> (o en un subconjunto de
ellos):
</p>

<p>
\[\boldsymbol{y} = \boldsymbol{t} + \boldsymbol{c} + \boldsymbol{s} + \boldsymbol{e}\]
</p>

<p>
donde:
</p>

<dl class="org-dl">
<dt>La tendencia "\(\boldsymbol{t}\)"</dt><dd>recoge la lenta evolución de la
media a <i>largo plazo</i>.</dd>

<dt>El componente estacional "\(\boldsymbol{s}\)"</dt><dd>recoge las
oscilaciones periódicas que se repiten regularmente en ciclos
estacionales (de año en año, o de semana en semana, etc.).</dd>

<dt>El componente cíclico "\(\boldsymbol{c}\)"</dt><dd>Cuando aparece
explícitamente en el modelo, \(\boldsymbol{c}\) recoge las
oscilaciones a medio plazo. Es decir, aquellas de un plazo más largo
que las oscilaciones estacionales, pero más corto que la tendencia
de largo plazo. Si está ausente, dichas oscilaciones suelen aparecer
en el componente de la tendencia, que entonces también podemos
denominar <i>tendencia-ciclo</i>.</dd>

<dt>El componente irregular "\(\boldsymbol{e}\)"</dt><dd>recoge las
oscilaciones no captadas por el resto de componentes, ya que debe
cumplir la siguiente identidad: \(\boldsymbol{e} = \boldsymbol{y} -
  \boldsymbol{t} - \boldsymbol{c} - \boldsymbol{s}\).</dd>
</dl>

<p>
Ajuste aceptable si (como poco) el componente irregular
\(\boldsymbol{e}\) parece "<i>estacionario</i>".
</p>
</div>
<div id="outline-container-org4a978c0" class="outline-3">
<h3 id="org4a978c0"><span class="section-number-3">2.1.</span> Tendencia determinista <i>lineal</i></h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-jupyter-python" id="org5e009fb"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Ajustamos por MCO una tendencia linea. Para ello, primero creamos un DataFrame con el regresando y los regresores del modelo</span>
<span style="color: #BA36A5;">datosModelo1</span> = TransformedData[[<span style="color: #008000;">'dataLog'</span>]].copy()
<span style="color: #BA36A5;">nsample</span> = <span style="color: #006FE0;">len</span>(datosModelo1)
<span style="color: #BA36A5;">datosModelo1</span>[<span style="color: #008000;">'cte'</span>] = [1]*nsample
<span style="color: #BA36A5;">datosModelo1</span>[<span style="color: #008000;">'time'</span>] = np.linspace(1, nsample, nsample)
<span style="color: #BA36A5;">model1</span> = sm.OLS(datosModelo1[<span style="color: #008000;">'dataLog'</span>], datosModelo1[[<span style="color: #008000;">'cte'</span>, <span style="color: #008000;">'time'</span>]])
<span style="color: #BA36A5;">results1</span> = model1.fit()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">A&#241;adimos al DataFrame =datosModelo1= la tendencia ajustada, los residuos y la diferencia estacional de los residuos.</span>
<span style="color: #BA36A5;">datosModelo1</span>[<span style="color: #008000;">'yhat'</span>] = datosModelo1[<span style="color: #008000;">'cte'</span>]*results1.params[<span style="color: #008000;">'cte'</span>]+datosModelo1[<span style="color: #008000;">'time'</span>]*results1.params[<span style="color: #008000;">'time'</span>]
<span style="color: #BA36A5;">datosModelo1</span>[<span style="color: #008000;">'ehat'</span>] = results1.resid
<span style="color: #BA36A5;">datosModelo1</span>[<span style="color: #008000;">'ehatDiff12'</span>] = datosModelo1[<span style="color: #008000;">'ehat'</span>].diff(12)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Dibujamos los datos junto a la tendencia estimada</span>
plt.plot(datosModelo1[<span style="color: #008000;">'dataLog'</span>])
plt.plot(results1.fittedvalues)
plt.grid()  
plt.ylabel(r<span style="color: #008000;">"Log-Passengers, ($\ln\boldsymbol{x}$) "</span>)
</pre>
</div>


<p>
El modelo de tendencia más simple es la recta de regresión donde el
regresor no constante es el propio índice \(t\) de cada dato:
</p>

<p>
\[\ln{y_t}=\underbrace{\beta_1+\beta_2\cdot t}_{\text{tendencia}} + e_t; \quad t=1:114\]
</p>




<div id="org146b7a6" class="figure">
<p><img src="./img/lecc02/airlinepass+linearTrend.png" alt="airlinepass+linearTrend.png" />
</p>
</div>


<p>
\[\widehat{\ln{y_t}}=4.8137+0.01\cdot\big(t\big), \qquad t=1:114\]
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #006FE0;">print</span>(results1.summary()) 
</pre>
</div>



<div id="org8d47f96" class="figure">
<p><img src="./img/lecc02/resultsModel1.png" alt="resultsModel1.png" width="100px" />
</p>
</div>



<p>
<b><span class="underline">Componente irregular</span></b>
</p>
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gr&#225;fico de los residuos del ajuste.</span>
plt.grid()  
plt.plot(results1.resid)
</pre>
</div>
<p>
<img src="./img/lecc02/airlinepass+irreg.png" alt="airlinepass+irreg.png" />
En este caso, el modelo 
</p>

<p>
\[\boldsymbol{y} = \boldsymbol{t} + \boldsymbol{e}\]
</p>

<p>
donde \(\boldsymbol{t}\) es una tendencia lineal no
es un ajuste satisfactorio, pues el <i>componente irregular</i>
\[\boldsymbol{e}=\boldsymbol{y}-\boldsymbol{t}\]
no tiene la apariencia de realización de un proceso estacionario.
</p>


<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gr&#225;fico de la diferencia estacional de los residuos del ajuste.</span>
plt.grid()  
plt.plot(datosModelo1[<span style="color: #008000;">'ehatDiff12'</span>])
</pre>
</div>

<p>
Adicionalmente podemos ver que diferencia de orden 12 del componente
irregular parece mostrar un componente cíclico con un periodo de unos
4 años.
</p>


<div id="org352f14b" class="figure">
<p><img src="./img/lecc02/airlinepass+irregDiff12.png" alt="airlinepass+irregDiff12.png" />
</p>
</div>

<p>
En el siguiente ejercicio probaremos con una tendencia cuadrática&#x2026;
</p>
</div>
</div>
<div id="outline-container-orgea81008" class="outline-3">
<h3 id="orgea81008"><span class="section-number-3">2.2.</span> Tendencia determinista <i>cuadrática</i></h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-jupyter-python" id="org69c6191"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">creamos un DataFrame con el regresando y los regresores del modelo.</span>
<span style="color: #BA36A5;">datosModelo2</span> = TransformedData[[<span style="color: #008000;">'dataLog'</span>]].copy()
<span style="color: #BA36A5;">nsample</span> = <span style="color: #006FE0;">len</span>(datosModelo1)
<span style="color: #BA36A5;">datosModelo2</span>[<span style="color: #008000;">'cte'</span>] = [1]*nsample
<span style="color: #BA36A5;">datosModelo2</span>[<span style="color: #008000;">'time'</span>] = np.linspace(1, nsample, nsample)
<span style="color: #BA36A5;">datosModelo2</span>[<span style="color: #008000;">'sq_time'</span>] = [t**2 <span style="color: #0000FF;">for</span> t <span style="color: #0000FF;">in</span> datosModelo2[<span style="color: #008000;">'time'</span>]]
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Ajustamos por MCO una tendencia cuadr&#225;tica a los datos.</span>
<span style="color: #BA36A5;">model2</span> = sm.OLS(datosModelo1[<span style="color: #008000;">'dataLog'</span>], datosModelo2[[<span style="color: #008000;">'cte'</span>, <span style="color: #008000;">'time'</span>, <span style="color: #008000;">'sq_time'</span>]])
<span style="color: #BA36A5;">results2</span> = model2.fit()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">A&#241;adimos al DataFrame 'datosModelo2' la tendencia ajustada, los residuos y la diferencia estacional de los residuos.</span>
<span style="color: #BA36A5;">datosModelo2</span>[<span style="color: #008000;">'yhat'</span>] = results2.fittedvalues
<span style="color: #BA36A5;">datosModelo2</span>[<span style="color: #008000;">'ehat'</span>] = results2.resid
<span style="color: #BA36A5;">datosModelo2</span>[<span style="color: #008000;">'ehatDiff12'</span>] = datosModelo2[<span style="color: #008000;">'ehat'</span>].diff(12)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Dibujamos los datos junto a la tendencia estimada.</span>
plt.plot(datosModelo1[<span style="color: #008000;">'dataLog'</span>])
plt.plot(results2.fittedvalues)
plt.grid()  
plt.ylabel(r<span style="color: #008000;">"Log-Passengers, ($\ln\boldsymbol{x}$) "</span>)
</pre>
</div>

<p>
\[\ln{y_t}=\underbrace{\beta_1+\beta_2\cdot t + \beta_3\cdot t^2}_{\text{tendencia}} + e_t; \quad t=1:114\]
</p>


<div id="org43a68b2" class="figure">
<p><img src="./img/lecc02/airlinepass+quadraticTrend.png" alt="airlinepass+quadraticTrend.png" />
</p>
</div>

<p>
\[\widehat{\ln{y_t}}=4.7364+(0.0132)\cdot t +(-2.191e-05)\cdot t^2, \qquad t=1:114\]
</p>



<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #006FE0;">print</span>(results2.summary()) 
</pre>
</div>


<div id="org7edec2f" class="figure">
<p><img src="./img/lecc02/resultsModel2.png" alt="resultsModel2.png" width="100px" />
</p>
</div>


<p>
<b><span class="underline">Componente irregular</span></b>
</p>
<div class="org-src-container">
<pre class="src src-jupyter-python">plt.grid()  
plt.plot(results2.resid)
</pre>
</div>


<div id="org6817930" class="figure">
<p><img src="./img/lecc02/airlinepass+irreg2.png" alt="airlinepass+irreg2.png" />
</p>
</div>

<p>
De manera análoga al caso anterior, el modelo
</p>

<p>
\[\boldsymbol{y} = \boldsymbol{t} + \boldsymbol{e}\]
</p>

<p>
donde \(\boldsymbol{t}\) ahora es una <i>tendencia
cuadrática</i> tampoco es un ajuste satisfactorio, pues el componente
irregular \(\boldsymbol{e}\) sigue sin parecerse a la realización de un
proceso estacionario.
</p>


<div class="org-src-container">
<pre class="src src-jupyter-python">plt.grid()  
plt.plot(datosModelo2[<span style="color: #008000;">'ehatDiff12'</span>])
</pre>
</div>

<p>
También en este modelo la diferencia de orden 12 del componente
irregular muestra un componente cíclico con un periodo de unos 4 años.
</p>


<div id="org38a275b" class="figure">
<p><img src="./img/lecc02/airlinepass+irregDiff12.png" alt="airlinepass+irregDiff12.png" />
</p>
</div>

<p>
Para obtener una <i>tendencia-ciclo</i> que capte este ciclo, son
necesarios procedimientos más sofisticados (por ejemplo TRAMO-SEATS, o
X13-ARIMA, o STAMP, o LDHR, o E4, etc.) que estiman tendencias y
componentes estacionales estocásticos.
</p>

<p>
En el siguiente ejercicio estimaremos un <b>componente estacional
determinista</b> (junto a una tendencia cuadrática determinista).
</p>
</div>
</div>
<div id="outline-container-orgd073e38" class="outline-3">
<h3 id="orgd073e38"><span class="section-number-3">2.3.</span> Tendencia cuadrática más estacionalidad determinista mediante <i>dummies</i></h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Creamos un dataframe con los datos y los regresores 'cte', 't' y 't^2'</span>
<span style="color: #BA36A5;">df</span> = TransformedData[[<span style="color: #008000;">'dataLog'</span>]].copy()
<span style="color: #BA36A5;">nsample</span> = <span style="color: #006FE0;">len</span>(df)
<span style="color: #BA36A5;">df</span>[<span style="color: #008000;">'cte'</span>]     = [1]*nsample
<span style="color: #BA36A5;">df</span>[<span style="color: #008000;">'time'</span>]    = np.linspace(1, nsample, nsample)
<span style="color: #BA36A5;">df</span>[<span style="color: #008000;">'sq_time'</span>] = [t**2 <span style="color: #0000FF;">for</span> t <span style="color: #0000FF;">in</span> df[<span style="color: #008000;">'time'</span>]]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Creamos las /dummies/ estacionales</span>
<span style="color: #0000FF;">from</span> statsmodels.tsa.deterministic <span style="color: #0000FF;">import</span> Seasonality
<span style="color: #BA36A5;">seas_gen</span> = Seasonality(12, initial_period=1)
<span style="color: #BA36A5;">seasonalDummies</span> = seas_gen.in_sample(df.index)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Creamos un dataframe con el regresando y todos los regresores del modelo</span>
<span style="color: #BA36A5;">datosModelo3</span> = pd.concat([df, seasonalDummies],axis=1)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">realizamos la regresi&#243;n de la primera columna ('dataLog') sobre el resto de columnas del dataframe.</span>
<span style="color: #BA36A5;">model3</span> = sm.OLS(datosModelo3[<span style="color: #008000;">'dataLog'</span>], datosModelo3.iloc[:,1:-1])
<span style="color: #BA36A5;">results3</span> = model3.fit()
</pre>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">La combinaci&#243;n lineal de los regresores 'cte', 'time' y 'sq_time' usando los correspondientes</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">par&#225;metros estimados nos da el componente de tendencia (determinista) estimado. </span>
<span style="color: #BA36A5;">TrendComp</span> = datosModelo3[[<span style="color: #008000;">'cte'</span>,<span style="color: #008000;">'time'</span>,<span style="color: #008000;">'sq_time'</span>]].dot(results3.params[[<span style="color: #008000;">'cte'</span>,<span style="color: #008000;">'time'</span>,<span style="color: #008000;">'sq_time'</span>]])
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">rcParams</span>[<span style="color: #008000;">'figure.figsize'</span>] = 15,4
plt.plot(datosModelo1[<span style="color: #008000;">'dataLog'</span>])
plt.plot(TrendComp)
plt.grid()  
plt.ylabel(r<span style="color: #008000;">"Log-Passengers, ($\ln\boldsymbol{x}$) "</span>)
</pre>
</div>



<div id="org5f9c1ab" class="figure">
<p><img src="./img/lecc02/airlinepass+TrendC.png" alt="airlinepass+TrendC.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">SeasonalComp</span> = (seasonalDummies.iloc[:,:-1]).dot(results3.params[3:])
plt.grid()  
plt.plot(SeasonalComp)
</pre>
</div>


<div id="org8169e0a" class="figure">
<p><img src="./img/lecc02/airlinepass+SeasonalC.png" alt="airlinepass+SeasonalC.png" />
</p>
</div>
</div>
<div id="outline-container-orgcb22aa2" class="outline-4">
<h4 id="orgcb22aa2"><span class="section-number-4">2.3.1.</span> Ajuste y componente irregular \(\boldsymbol{e}=\boldsymbol{y}-\boldsymbol{t}-\boldsymbol{s}\)</h4>
<div class="outline-text-4" id="text-2-3-1">
<div class="org-src-container">
<pre class="src src-jupyter-python">plt.grid()  
plt.plot(datosModelo3[<span style="color: #008000;">'dataLog'</span>])
plt.plot(TrendComp + SeasonalComp)
</pre>
</div>


<div id="org6c2f9dd" class="figure">
<p><img src="./img/lecc02/airlinepass+yhat.png" alt="airlinepass+yhat.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python">plt.grid()  
plt.plot(results3.resid)
</pre>
</div>


<div id="orgfc51bd9" class="figure">
<p><img src="./img/lecc02/airlinepass+IrregC.png" alt="airlinepass+IrregC.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgff06def" class="outline-4">
<h4 id="orgff06def"><span class="section-number-4">2.3.2.</span> Valoración de modelos con componentes deterministas</h4>
<div class="outline-text-4" id="text-2-3-2">
<ul class="org-ul">
<li>Estos modelos resultan útiles para realizar un análisis descriptivo.</li>

<li>Pero suelen funcionar bastante mal como herramienta de predicción:

<ul class="org-ul">
<li>no tienen en cuenta la dependencia inter-temporal de los datos (se
han estimado mediante una regresión como si los datos hubieran
sido de sección cruzada)</li>

<li>Por ejemplo, a la hora de prever el dato de enero de 1961, en este
modelo pesa tanto el dato de enero de 1949 como el dato de enero
de 1960.</li>
</ul></li>
</ul>

<p>
En general, para que los modelos funcionen bien en predicción deben
<i>dar un mayor peso a los datos recientes</i> frente a los datos alejados
en el tiempo.

</p>

<p>
Pero sigamos explorando este modelo&#x2026;

</p>

<p>
<b>Hay parámetros no significativos&#x2026;</b> (p-valores para dummies enero,
febrero y octubre).
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python">repr_png(results3.summary().as_latex(), <span style="color: #008000;">"./img/lecc02/resultsModel3.png"</span>)
</pre>
</div>

<p width="100px">
<img src="./img/lecc02/resultsModel3.png" alt="resultsModel3.png" width="100px" />1
</p>


<p>
&lt;div&gt;
&lt;img src="./img/lecc02/resultsModel3.png" width="450" class="center"/&gt;
&lt;/div&gt;
</p>

<p>

</p>

<p>
<b>podemos eliminarlos secuencialmente</b> (quitando cada vez la variable de mayor p-valor)
</p>
<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> operator
<span style="color: #0000FF;">def</span> <span style="color: #006699;">remove_most_insignificant</span>(df, results):
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">use operator to find the key which belongs to the maximum value in the dictionary:</span>
    <span style="color: #BA36A5;">max_p_value</span> = <span style="color: #006FE0;">max</span>(results.pvalues.iteritems(), key=operator.itemgetter(1))[0]
    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is the feature you want to drop:</span>
    df.drop(columns = max_p_value, inplace = <span style="color: #D0372D;">True</span>)
    <span style="color: #0000FF;">return</span> df
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">y</span> = datosModelo3[<span style="color: #008000;">'dataLog'</span>]
<span style="color: #BA36A5;">X</span> = datosModelo3.iloc[:,1:-1]
<span style="color: #BA36A5;">significacion</span> = 0.05
<span style="color: #BA36A5;">insignificant_feature</span> = <span style="color: #D0372D;">True</span>
<span style="color: #0000FF;">while</span> insignificant_feature:
        <span style="color: #BA36A5;">model4</span> = sm.OLS(y, X)
        <span style="color: #BA36A5;">results4</span> = model4.fit()
        <span style="color: #BA36A5;">significant</span> = [p_value &lt; significacion <span style="color: #0000FF;">for</span> p_value <span style="color: #0000FF;">in</span> results4.pvalues]
        <span style="color: #0000FF;">if</span> <span style="color: #006FE0;">all</span>(significant):
            <span style="color: #BA36A5;">insignificant_feature</span> = <span style="color: #D0372D;">False</span>
        <span style="color: #0000FF;">else</span>:
            <span style="color: #0000FF;">if</span> X.shape[1] == 1:  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">if there's only one insignificant variable left</span>
                <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'No significant features found'</span>)
                <span style="color: #BA36A5;">results4</span> = <span style="color: #D0372D;">None</span>
                <span style="color: #BA36A5;">insignificant_feature</span> = <span style="color: #D0372D;">False</span>
            <span style="color: #0000FF;">else</span>:            
                <span style="color: #BA36A5;">X</span> = remove_most_insignificant(X, results4)

<span style="color: #006FE0;">print</span>(results4.summary())
</pre>
</div>



<div id="org4991906" class="figure">
<p><img src="./img/lecc02/resultsModel4.png" alt="resultsModel4.png" width="100px" />
</p>
</div>


<p>
&lt;div&gt;
&lt;img src="./img/lecc02/resultsModel4.png" width="400" class="center"/&gt;
&lt;/div&gt;
</p>

<p>

</p>

<p>
Pero esta inferencia es incorrecta. Con auto-correlación la varianza
del estimador MCO es diferente (<b>la estimación por defecto de las
desviaciones típicas es incorrecta</b>)
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org7a8d178" class="outline-2">
<h2 id="org7a8d178"><span class="section-number-2">3.</span> Autocorrelación</h2>
<div class="outline-text-2" id="text-3">
<p>
Considere el modelo
\(\boldsymbol{Y}=\boldsymbol{\mathsf{X}\beta}+\boldsymbol{U}.\;\) Bajo
los supuestos habituales
</p>

<p>
\[E(\boldsymbol{U}\mid\boldsymbol{\mathsf{X}})=\boldsymbol{0},\quad
Var(\boldsymbol{U}\mid\boldsymbol{\mathsf{X}})=\sigma^2\boldsymbol{\mathsf{I}}\quad
\text{y} \quad E(\boldsymbol{\mathsf{X'X}}) \text{ es invertible}\]
</p>

<p>
el estimador
\(\;\widehat{\boldsymbol{\beta}}=(\boldsymbol{\mathsf{X'X}})^{-1}\boldsymbol{\mathsf{X'}Y}\;\)
es insesgado y eficiente, con varianza
</p>

<p>
\[\;Var(\widehat{\boldsymbol{\beta}}\mid\boldsymbol{\mathsf{X}})=\sigma^2(\boldsymbol{\mathsf{X'X}})^{-1}\]
</p>

<p>

</p>

<p>
Pero si las perturbaciones \(\boldsymbol{U}\) del modelo son
heterocedásticas y/o autocorreladas
\[Var(\boldsymbol{U}\mid\boldsymbol{\mathsf{X}})=\boldsymbol{\Sigma}\ne\sigma^2\boldsymbol{\mathsf{I}}\]
entonces el estimador \(\widehat{\boldsymbol{\beta}}\), aunque
insesgado, ya no es eficiente; y su varianza es
</p>

<p>
\[Var(\widehat{\boldsymbol{\beta}}\mid\boldsymbol{\mathsf{X}})=Var(\widehat{\boldsymbol{\beta}}-\boldsymbol{\mathsf{I}}\boldsymbol{\beta}\mid\boldsymbol{\mathsf{X}})=
(\boldsymbol{\mathsf{X'X}})^{-1}\boldsymbol{\mathsf{X'}}
\boldsymbol{\Sigma}
\boldsymbol{\mathsf{X}}(\boldsymbol{\mathsf{X'X}})^{-1}.\]

</p>

<p>
El test de Durbin-Watson o el test de Breusch y Godfrey sirven para
contrastar la \(H_0\) de <i>no autocorrelación</i>&#x2026;.

</p>

<p>
<b>El test de Durbin-Watson</b> contrasta la autocorrelación de orden
uno. Para muestras grandes, el test es aproximadamente igual a
\(2(1-{\hat {\rho }})\), donde \({\hat{\rho}}\) es la autocorrelación de
orden uno de los residuos. Por tanto, valores del test próximos a 2
indican no autocorrelación, valores próximos a 0 indican fuerte
autocorrelación positiva y valores próximos a 4 indican fuerte
autocorrelación negativa.
</p>
</div>
<div id="outline-container-org3882970" class="outline-3">
<h3 id="org3882970"><span class="section-number-3">3.1.</span> Test de Breusch y Godfrey</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Considere el <i>modelo de regresión lineal</i> 
</p>

<p>
\[Y_t = \beta_1+ \beta_2 X_{t,1} + \cdots +  \beta_k X_{t,k+1} + U_t\]
</p>

<p>

donde las perturbaciones \(\boldsymbol{U}\) quizá siguen un esquema
auto-regresivo \(AR(p)\):
</p>

<p>
\[U_t = \rho_1 U_{t-1} + \rho_2 U_{t-2}  + \cdots + \rho_p U_{t-p} + \varepsilon_t\]
</p>
<ul class="org-ul">
<li><b>Paso 1</b>. Se obtienen los residuos del ajuste por MCO con una
muestra de tamaño \(T\) del <i>modelo de regresión lineal</i>.</li>
<li><b>Paso 2</b>. Se realiza un ajuste MCO de los residuos sobre los
regresores del modelo original y sobre los \(p\) primeros retardos de
los residuos.
\[\hat{E}_t = \alpha_0 + \alpha_1 X_{t,1} + \cdots \alpha_k
  X_{t,k} + \rho_1 \hat{E}_{t-1} + \rho_2 \hat{E}_{t-2} + \cdots +
  \rho_p \hat{E}_{t-p} + \varepsilon_t\]</li>
</ul>

<p>
asintóticamente y bajo la \(H_0\) de <i>no autocorrelación</i>: \({\lbrace
\rho_i = 0\text{ para todo }i\rbrace}\)
</p>

<p>
\[n R^2\,\sim\,\chi^2_p,\]
</p>

<p>
donde \(R^2\) es el coeficiente de determinación de la regresión
auxiliar y \(n=T-p\).
</p>


<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #0000FF;">import</span> statsmodels.stats.diagnostic <span style="color: #0000FF;">as</span> dg
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">perform Breusch-Godfrey test of order p = 3</span>
<span style="color: #BA36A5;">arbg</span> = dg.acorr_breusch_godfrey(results4, nlags=3, store=<span style="color: #D0372D;">True</span>)
arbg[:1]
repr_png(arbg[-1].resols.summary().as_latex(), <span style="color: #008000;">"./img/lecc02/resultsBreusch-Godfrey.png"</span>) 
</pre>
</div>



<div id="orge45642d" class="figure">
<p><img src="./img/lecc02/resultsBreusch-Godfrey.png" alt="resultsBreusch-Godfrey.png" width="100px" />
</p>
</div>



<ul class="org-ul">
<li>Valor del estadístico: \(\quad 62.7119\qquad\) (p-valor: \(\; 1.55e-13\))</li>
<li>\(x_{12}\) corresponde al primer retardo en la regresión auxiliar y es muy significativo</li>
</ul>
<p>
&lt;div&gt;
&lt;img src="./img/lecc02/resultsBreusch-Godfrey.png" width="450" class="center"/&gt;
&lt;/div&gt;
</p>
</div>
</div>
<div id="outline-container-org05873b3" class="outline-3">
<h3 id="org05873b3"><span class="section-number-3">3.2.</span> Errores estándar robustos</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Un procedimiento adecuado en presencia de autocorrelación y muestras
grandes consiste en usar errores estándar "<i>robustos</i>" al realizar
inferencia con la estimación de los parámetros.
</p>

<ol class="org-ol">
<li>las estimaciones serán insesgadas, consistentes pero ineficientes,</li>

<li>los residuos son los mismos y, por tanto, estarán autocorrelados, aunque</li>

<li>la inferencia a partir de errores estándar robustos será válida</li>
</ol>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">y</span> = datosModelo3[<span style="color: #008000;">'dataLog'</span>]
<span style="color: #BA36A5;">X</span> = datosModelo3.iloc[:,1:-1]
<span style="color: #BA36A5;">model5</span> = sm.OLS(y, X)
<span style="color: #BA36A5;">results5</span> = model5.fit()
<span style="color: #006FE0;">print</span>(results5.get_robustcov_results(cov_type=<span style="color: #008000;">'HAC'</span>, maxlags=3, use_correction=<span style="color: #D0372D;">True</span>).summary())
</pre>
</div>


<div class="org-src-container">
<pre class="src src-jupyter-python">repr_png(results5.get_robustcov_results(cov_type=<span style="color: #008000;">'HAC'</span>, maxlags=3, use_correction=<span style="color: #D0372D;">True</span>).summary().as_latex(), <span style="color: #008000;">"./img/lecc02/resultsModel5.png"</span>)
</pre>
</div>



<div id="org2bfa421" class="figure">
<p><img src="./img/lecc02/resultsModel5.png" alt="resultsModel5.png" width="100px" />
</p>
</div>


<p>
&lt;div&gt;
&lt;img src="./img/lecc02/resultsModel5.png" width="400" class="center"/&gt;
&lt;/div&gt;
</p>

<p>
Ahora, y empleando errores estándar robustos, podemos reducir el
modelo de manera más cuidadosa usando desviaciones típicas robustas. El modelo reducido es&#x2026;
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">y</span> = datosModelo3[<span style="color: #008000;">'dataLog'</span>]
<span style="color: #BA36A5;">X</span> = datosModelo3.iloc[:,1:-1]

<span style="color: #BA36A5;">significacion</span> = 0.05

<span style="color: #BA36A5;">insignificant_feature</span> = <span style="color: #D0372D;">True</span>
<span style="color: #0000FF;">while</span> insignificant_feature:
        <span style="color: #BA36A5;">results6</span>      = sm.OLS(y, X).fit()
        <span style="color: #BA36A5;">robustResults</span> = results6.get_robustcov_results(cov_type=<span style="color: #008000;">'HAC'</span>, maxlags=3, use_correction=<span style="color: #D0372D;">True</span>)
        <span style="color: #BA36A5;">robustPvalues</span> = pd.Series(index=results6.pvalues.index, data=robustResults.pvalues)

        <span style="color: #BA36A5;">significant</span> = [p_value &lt; significacion <span style="color: #0000FF;">for</span> p_value <span style="color: #0000FF;">in</span> robustPvalues]

        
        <span style="color: #0000FF;">if</span> <span style="color: #006FE0;">all</span>(significant):
            <span style="color: #BA36A5;">insignificant_feature</span> = <span style="color: #D0372D;">False</span>
        <span style="color: #0000FF;">else</span>:
            <span style="color: #0000FF;">if</span> X.shape[1] == 1:  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">if there's only one insignificant variable left</span>
                <span style="color: #006FE0;">print</span>(<span style="color: #008000;">'No significant features found'</span>)
                <span style="color: #BA36A5;">results6</span> = <span style="color: #D0372D;">None</span>
                <span style="color: #BA36A5;">insignificant_feature</span> = <span style="color: #D0372D;">False</span>
            <span style="color: #0000FF;">else</span>:            
                <span style="color: #BA36A5;">X</span> = remove_most_insignificant(X, results6)
<span style="color: #006FE0;">print</span>(robustResults.summary())
repr_png(robustResults.summary().as_latex(), <span style="color: #008000;">"./img/lecc02/resultsModel6.png"</span>) 
</pre>
</div>



<div id="orge5cd2a0" class="figure">
<p><img src="./img/lecc02/resultsModel6.png" alt="resultsModel6.png" width="100px" />
</p>
</div>

<p>
&lt;div&gt;
&lt;img src="./img/lecc02/resultsModel6.png" width="400" class="center"/&gt;
&lt;/div&gt;
</p>

<ul class="org-ul">
<li>Nótese que ahora se aprecia que enero y octubre son significativos al 5%</li>
<li>Pero la estimación MCO no es eficiente en presencia de
heterocedasticidad y/o auto-correlación</li>
</ul>
</div>
</div>
<div id="outline-container-orge707cc8" class="outline-3">
<h3 id="orge707cc8"><span class="section-number-3">3.3.</span> Modelo del errorg</h3>
<div class="outline-text-3" id="text-3-3">
<p>
En el modelo
\(\boldsymbol{Y}=\boldsymbol{\mathsf{X}\beta}+\boldsymbol{U},\;\) si las
perturbaciones presentan heterocedasticidad y/o auto-correlación, y
por tanto
\[Var(\boldsymbol{U}\mid\boldsymbol{\mathsf{X}})=\boldsymbol{\Sigma}\ne\sigma^2\boldsymbol{\mathsf{I}},\]
el Teorema de Gauss-Markov ya no es válido, ya que es posible explotar
la estructura de la matriz \(\boldsymbol{\Sigma}\) para minimizar la
varianza del estimador.
</p>

<p>
En particular, el estimador lineal de mínima varianza es el estimador
MCG (mínimos cuadrados generalizados)
</p>

<p>
\[\;\widehat{\boldsymbol{\beta}}=(\boldsymbol{\mathsf{X'}}\boldsymbol{\mathsf{\Sigma}}^{-1}\boldsymbol{\mathsf{X}})^{-1}\boldsymbol{\mathsf{X'}}\boldsymbol{\mathsf{\Sigma}}^{-1}\boldsymbol{Y}\;\]
</p>

<p>
El problema es que, en general, la matriz \(\boldsymbol{\Sigma}\) es
desconocida.
</p>

<p>
Una solución es aplicar un procedimiento iterativo en el que se estima
la matriz \(\boldsymbol{\Sigma}\) empleando los errores del ajuste de
una primera regresión. Con dicha matriz
\(\widehat{\boldsymbol{\Sigma}}\) se re-estima el modelo por MCG&#x2026; con
los nuevos errores se re-estima \(\boldsymbol{\Sigma}\)&#x2026; y vuelta a
empezar&#x2026;
</p>

<p>
El algoritmo se detiene cuando las estimaciones convergen a valores
estables.
</p>

<p>
Cuando realizamos el Test de Breusch-Godfrey vimos que en la regresión
auxiliar el primer retardo de los errores era significativo. Por
tanto, vamos a indicar que las perturbaciones siguen un proceso AR(1).
El decir, vamos a estimar el modelo
</p>

<p>
\[\ln{y_t}=\underbrace{\beta_1+\beta_2\cdot t+\beta_3\cdot t^2}_{\text{tendencia}} + \underbrace{\alpha_1 S_{t1} + \alpha_3 S_{t3} + \cdots + \alpha_11 S_{t11}}_{\text{comp. estacional}} + \epsilon_t\]
</p>

<p>
donde las perturbaciones \(\boldsymbol{\epsilon}=\{\epsilon_t\}\) siguen
el modelo
</p>

<p>
\[\epsilon_t = \rho_1 \epsilon_{t-1} + e_t\]
</p>

<p>
(<i>en este caso la estimación converge en 7 iteraciones</i>)
</p>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #BA36A5;">model</span> = sm.GLSAR(y, X, rho=1) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">rho=1 indica autocorrelaci&#243;n de orden uno</span>
<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(7):
    <span style="color: #BA36A5;">results</span> = model.fit()
    <span style="color: #006FE0;">print</span>(<span style="color: #008000;">"AR coefficients: {0}"</span>.<span style="color: #006FE0;">format</span>(model.rho))
    <span style="color: #BA36A5;">rho</span>, <span style="color: #BA36A5;">sigma</span> = sm.regression.yule_walker(results.resid,
                                           order=model.order)
    <span style="color: #BA36A5;">model</span> = sm.GLSAR(y, X, rho)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #006FE0;">print</span>(results.summary())
</pre>
</div>



<div id="org90a1e1b" class="figure">
<p><img src="./img/lecc02/resultsModel7.png" alt="resultsModel7.png" width="100px" />
</p>
</div>


<p>
&lt;div&gt;
&lt;img src="./img/lecc02/resultsModel7.png" width="600" class="center"/&gt;
&lt;/div&gt;
</p>



<div class="org-src-container">
<pre class="src src-jupyter-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">este c&#243;digo realiza las mismas iteraciones que bloque de c&#243;digo de m&#225;s arriba</span>
<span style="color: #BA36A5;">model2</span> = sm.GLSAR(y, X, rho=1)
<span style="color: #BA36A5;">res</span> = model2.iterative_fit(maxiter=7)
model2.rho
<span style="color: #006FE0;">print</span>(model2.fit().summary())
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Marcos Bujosa</p>
<p class="date">Created: 2024-07-27 sáb 17:54</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
