#+TITLE: Econometría Aplicada. Lección 6
#+author: Marcos Bujosa
#+LANGUAGE: es-es

# +OPTIONS: toc:nil

# +EXCLUDE_TAGS: pngoutput noexport

#+startup: shrink

#+LATEX_HEADER_EXTRA: \usepackage[spanish]{babel}
#+LATEX_HEADER_EXTRA: \usepackage{lmodern}
#+LATEX_HEADER_EXTRA: \usepackage{tabularx}
#+LATEX_HEADER_EXTRA: \usepackage{booktabs}

#+LaTeX_HEADER: \newcommand{\lag}{\mathsf{B}}
#+LaTeX_HEADER: \newcommand{\Sec}[1]{\boldsymbol{#1}}
#+LaTeX_HEADER: \newcommand{\Pol}[1]{\boldsymbol{#1}}

#+LATEX: \maketitle

# M-x jupyter-refresh-kernelspecs

# C-c C-v C-b ejecuta el cuaderno electrónico

# sustituir :results none por :results output replace

#+OX-IPYNB-LANGUAGE: jupyter-R

#+attr_ipynb: (slideshow . ((slide_type . notes)))
#+BEGIN_SRC emacs-lisp :exports none :results silent
(use-package ox-ipynb
  :load-path (lambda () (expand-file-name "ox-ipynb" scimax-dir)))

(setq org-babel-default-header-args:jupyter-R
      '((:results . "value")
	(:session . "jupyter-R")
	(:kernel . "ir")
	(:pandoc . "t")
	(:exports . "both")
	(:cache .   "no")
	(:noweb . "no")
	(:hlines . "no")
	(:tangle . "no")
	(:eval . "never-export")))

(require 'jupyter-R)
;(require 'jupyter)

(org-babel-do-load-languages 'org-babel-load-languages org-babel-load-languages)

(add-to-list 'org-src-lang-modes '("jupyter-R" . R))
#+END_SRC


#+begin_abstract
En esta lección veremos tres funciones que describen las
características correspondientes a los momentos de segundo orden de
los procesos lineales: la función de autocorrelación (ACF), la función
de autocorrelación parcial (PACF) y la densidad espectral (estas tres
funciones son transformaciones de la función de autocovarianzas del
proceso). Veremos la estructura de estas funciones en procesos
lineales genéricos y luego particularizaremos a procesos de ruido
blanco, procesos MA y procesos AR.
#+end_abstract

***** COMMENT para Jupyter-Notebook                               :noexports:
\(
\newcommand{\lag}{\mathsf{B}}
\newcommand{\Sec}[1]{\boldsymbol{#1}}
\newcommand{\Pol}[1]{\boldsymbol{#1}}
\)


***  Carga de algunas librerías de R
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :UNNUMBERED: t 
   :END:

# install.packages(c("readr", "latticeExtra", "tfarima"))
# library(readr)
# library(ggplot2)
# install.packages("pastecs")
# install.packages("orgutils")


#+attr_ipynb: (slideshow . ((slide_type . notes)))
Primero cargamos la librería =tfarima= (Repositorio Cran:
https://cran.r-project.org/web/packages/tfarima/index.html;
repositorio GitHub: https://github.com/gallegoj/tfarima)
#+attr_ipynb: (slideshow . ((slide_type . notes)))
#+BEGIN_SRC jupyter-R :results silent :exports code
library(tfarima)      # librería de José Luis Gallego para Time Series
library(readr)        # para leer ficheros CSV
library(ggplot2)      # para el scatterplot (alternaticamente library(tidyverse))
library(ggfortify)    # para pintar series temporales
library(jtools)       # para representación resultados estimación
library(zoo)          # para generar objetos ts (time series)
#+END_SRC
#+attr_ipynb: (slideshow . ((slide_type . notes)))
y además fijamos los parámetros por defecto para las figuras en =png=
del notebook
#+attr_ipynb: (slideshow . ((slide_type . notes)))
#+BEGIN_SRC jupyter-R :results silent :exports code
# fijamos el tamaño de las figuras que se generan en el notebook
options(repr.plot.width = 12, repr.plot.height = 4, repr.plot.res = 200)
#+END_SRC


* Función de autocovarianzas y función de autocorrelación (ACF)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Ya hemos visto que si un proceso estocásticos es estacionario, la
covarianza entre $X_t$ y $X_{t+k}$ no depende de $t$; tan solo depende
de la distancia temporal $k$ entre ambas variables y que

- La secuencia $\boldsymbol{\gamma}=(\gamma_k\mid k\in\mathbb{Z})$ se denomina /función de
  autocovarianzas/

- La secuencia $\boldsymbol{\rho}=(\rho_k\mid k\in\mathbb{Z})$ donde    
  $$\rho_k=\frac{Cov(X_t,X_{t-k})}{\sqrt{Var(X_t)Var(X_{t-k})}}=\frac{\gamma_k}{\gamma_0} $$
  #+LATEX: \newline  \noindent
  se denomina /función de autocorrelación/ (ACF).

#+attr_ipynb: (slideshow . ((slide_type . fragment)))
Veamos una nueva transformación de $\boldsymbol{\gamma}$ que subraya
otras características de interdependencia temporal en un proceso
estocástico.

#+LATEX: \newline  \noindent


* Función de autocorrelación parcial  (PACF)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

#+BEGIN_EXPORT latex
Dado un conjunto de variables
$\boldsymbol{Z}=(Z_1,Z_2,\ldots Z_k)$, la \emph{correlación condicional} 
$\rho_{X,Y|\boldsymbol{Z}}$ entre las variables $X$ e $Y$ es
$$\rho_{X,Y|\boldsymbol{Z}}=Corr\Big(X-E(X\mid\boldsymbol{Z}),\ Y-E(Y\mid\boldsymbol{Z})\Big)$$ 
El problema es que no siempre es fácil conocer las esperanzas condicionadas 
$E(X\mid\boldsymbol{Z})$ y $E(Y\mid\boldsymbol{Z})$.

Pero es sencillo restar de $X$ y de $Y$ los ajustes $\widehat{X}$ y $\widehat{Y}$ 
correspondientes a sus respectivas regresiones lineales sobre $\boldsymbol{Z}$. 
La correlación entre ambos residuos se denomina \emph{correlación parcial} 
entre $X$ e $Y$; y mide la correlación entre ambas variables una vez  
``descontado'' el efecto lineal de las variables $\boldsymbol{Z}$.
$$Corr\Big((X-\widehat{X}),\ (Y-\widehat{Y})\Big)$$
#+END_EXPORT

La /correlación parcial/ entre dos variables $X_t$ y $X_{t-k}$ de un
proceso estacionario $\boldsymbol{X}$ mide su correlación una vez
descontado el efecto de las variables $X_{t-1},\ldots X_{t-(k-1)}$ que
median entre ambas.
$$X_t,\ \overbrace{X_{t-1},\ldots X_{t-(k-1)},}\ X_{t-k}$$

Si denotamos con $\widehat{X_t}$ y $\widetilde{X_{t-k}}$ los ajustes de
las respectivas regresiones de $X_t$ y $X_{t-k}$ sobre $X_{t-1},\ldots
X_{t-(k-1)};\;$ la /correlación parcial/ $\pi_k$ entre $X_t$ y $X_{t+k}$ es la
correlación entre los residuos de sendas regresiones:
$$\pi_k=Corr\Big((X_t-\widehat{X_t}),\ (X_{t-k}-\widetilde{X_{t-k}})\Big)$$

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
En un proceso débilmente estacionario las correlaciones parciales solo
dependen de la distancia $k$, lo que permite definir la siguiente
secuencia.
#+LATEX: \medskip

*Función de autocorrelación parcial* (PACF) de un proceso estacionario
$\boldsymbol{X}$ es la siguiente secuencia
$\boldsymbol{\pi}=(\pi_k\mid k\in\mathbb{Z}),\;$ que es simétrica pues
$\pi_{-k}=\pi_k$: $$\begin{cases} \pi_0 & = \rho_0 ={\color{blue}{1}}\\\\ \pi_1 &=Corr(X_t,\
X_{t-1})=\rho_1=\frac{\gamma_1}{\gamma_0}\\\\ \pi_k
&=Corr\Big((X_t-\widehat{X_t}),\ (X_{t-k}-\widetilde{X_{t-k}})\Big)
\end{cases},$$ donde $\widehat{X_t}$ y $\widetilde{X_{t-k}}$ son los
ajustes de las respectivas regresiones de $X_t$ y $X_{t-k}$ sobre
$X_{t-1},\ldots X_{t-(k-1)}.\;$ i.e., las proyecciones ortogonales
sobre $\bar{sp}(1,X_{t-1}:X_{t-(k-1)})$.
#+LATEX: \medskip

#+attr_ipynb: (slideshow . ((slide_type . fragment)))
La magnitud de la correlación parcial $\;\pi_k\;$ *refleja la mejora
en la predicción de $\widehat{X_t}$ si* en lugar de usar una
combinación lineal con solo los $k-1$ primeros retardos,
$\widehat{X_t}=\widehat{\alpha_0}+\sum_{j=1}^{k-1}\widehat{\alpha_j}
X_{t-j}$, *empleamos $k$ retardos* (i.e., un retardo más).
#+LATEX: \medskip

(Dicha propiedad nos ayudará a elegir el orden de procesos autoregresivos).
#+LATEX: \medskip

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
Hay una correspondencia uno-a-uno entre la función de autocovarianzas
$\boldsymbol{\gamma}$ y la PACF $\boldsymbol{\pi}$. 

Es decir, es posible reconstruir una de las secuencias a partir de la
otra (por ejemplo resolviendo la ecuaciones de Yule-Walker
recursivamente con el algoritmo Levinson-Durbin; véase
/Pourahmadi, M. (2001, Capítulo 7)/ o /Brockwell & Davis (1991,
Capitulo 5)/)

*************** TODO COMMENT Incluir algoritmo en los apuntes      :@EctrApl:

# \(\pi_1=\phi_{11}=\rho_1\)

# \(\pi_{k+1}=\phi_{k+1,k+1}=\frac{\rho_{k+1}-\sum_{j=1}^k\phi_{kj}\rho_{k+1-j}}{1-\sum_{j=1}^k\phi_{kj}\rho_j}\); donde $\phi_{k+1,j}=\phi_{kj}-\phi_{k+1,k+1}\phi_{k,k+1-j}$, $j=1:k$

Consecuentemente, la PACF $\boldsymbol{\pi}$ puede verse como una
reparametrización de la función de autocovarianzas
$\boldsymbol{\gamma}$.

Veamos otra transformación de $\boldsymbol{\gamma}$ que también
arrojará luz sobre las propiedades de un proceso estocástico.


* Densidad espectral
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Si $\boldsymbol{X}$ es un proceso estocástico con función de
autocovarianzas $\boldsymbol{\gamma}\in\ell^1$, es decir, con función
de autocovarianzas absolutamente sumable,
$$\sum_{h\in\mathbb{Z}}|\gamma_h|<\infty,$$ entonces definimos la
/densidad espectral/ de $\boldsymbol{X}$ como $$f(\omega)
\quad=\quad\frac{1}{2\pi}\sum_{h\in\mathbb{Z}}\gamma_h e^{-i h\omega}
\quad=\quad\frac{1}{2\pi}\sum_{h\geq0}\gamma_h \cos(h\omega),\qquad
\omega\in[-\pi,\pi].$$
#+LATEX: \medskip

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
La /densidad espectral/ $f(\omega)$ satisface las siguientes
propiedades:
a) $f(\omega)=f(-\omega)$
b) $f(\omega)\geq0$
c) $\int_{-\pi}^\pi f(\omega)d\omega<\infty$

#+attr_ipynb: (slideshow . ((slide_type . fragment)))
Es más, partiendo de la densidad espectral se pueden calcular las
covarianzas $$\gamma_h=\int_{-\pi}^\pi f(\omega)e^{-i
h\omega}d\omega;\quad h\in\mathbb{Z}$$

#+attr_ipynb: (slideshow . ((slide_type . fragment)))
Consecuentemente, para $h=0$
$$\sigma^2=\gamma_0=\int_{-\pi}^\pi f(\omega)d\omega.$$

Por tanto podemos interpretar la densidad espectral como una
descomposición de la varianza oscilaciones de distintas frecuencias.

#+attr_ipynb: (slideshow . ((slide_type . slide)))
La ACF, la PACF y la /densidad espectral/ son funciones que dependen
únicamente de los dos primeros momentos de la distribución.

Su estimación y posterior análisis son la herramienta fundamental para
elegir un modelo ARMA para una serie temporal /``estacionaria''/.

Para entenderlo debemos ver cómo son estas funciones en algunos
modelos lineales concretos.


* ACF, PACF y densidad espectral de algunos modelos lineales
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . skip)))
   :END:


** Procesos lineales causales
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Sea el proceso 
$\boldsymbol{X}=\boldsymbol{\psi}*\boldsymbol{U}$, donde
$\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$ y
$\;\boldsymbol{\psi}\in\ell^2\;$ es una serie formal:
$$X_t=\sum_{j\geq0}\psi_j U_{t-j}.$$ Por la lección anterior
sabemos que $\;E(X_t)=0\;$ y que
- $\boldsymbol{\gamma} \;=\; \sigma^2 \boldsymbol{\psi}(z)*\boldsymbol{\psi}(z^{-1})$
#+attr_ipynb: (slideshow . ((slide_type . notes)))
  Es decir, 
  $$\gamma_k = \sigma^2\sum_{j=0}^\infty \psi_{j+|k|}\cdot\psi_j.$$ 
  Por otra parte, $\;\gamma_k\to0\;$ cuando $\;k\to\infty$
#+BEGIN_EXPORT latex
\medskip

\emph{Demostración}:  aplicando la desigualdad de Cauchy-Schwarz
\begin{displaymath}
|\gamma_k| \; \leq  \; \sigma^2 
\left(\sum_{j=0}^\infty |\psi_{j+k}|^2\right)^{\frac{1}{2}}
\left(\sum_{j=0}^\infty |\psi_{j}|^2\right)^{\frac{1}{2}}
% \\ &
\; = \;
\sigma^2 
\left(\sum_{j=k}^\infty |\psi_{j}|^2\right)^{\frac{1}{2}}
\left(\sum_{j=0}^\infty |\psi_{j}|^2\right)^{\frac{1}{2}} 
\end{displaymath}
y puesto que $\boldsymbol{\psi}$ es de cuadrado sumable, la cola 
$\sum_{j=k}^\infty |\psi_{j}|^2$ 
converje a cero cuando $k\to\infty$.
\medskip
#+END_EXPORT

#+attr_ipynb: (slideshow . ((slide_type . fragment)))
A partir de $\boldsymbol{\gamma}$ obtenemos las otras tres funciones:

*ACF*: $\;\boldsymbol{\rho} \;=\; \frac{1}{\gamma_0}\boldsymbol{\gamma}$

*Dens. espectral*:  \(\;f(\omega)=\frac{1}{2\pi}\sum_{h\geq0}\gamma_h\cos(h\omega)\)@@latex:;\quad\omega\in[-\pi,\pi]@@

*PACF*: $\;\boldsymbol{\pi}\in\ell^2,\quad$ i.e., $\;\pi_k\to0\;$ cuando $\;k\to\infty$ 

#+BEGIN_EXPORT latex
\noindent
(Cuando $\boldsymbol{\pi}\in\ell^2$ se dice que el proceso es \emph{no-determinista}.)
#+END_EXPORT


** Proceso de Ruido Blanco
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Sea $\boldsymbol{X}=1*\boldsymbol{U}$,
donde $\;\boldsymbol{U}\sim WN(0,\sigma^2)\;;$ es decir $X_t=U_t$ para
$t\in\mathbb{Z}$. Entonces

- $\boldsymbol{\gamma} \;=\; \sigma^2 (1z^0*1z^{0}) \;=\; \sigma^2z^0 \;=\; (\ldots,0,0,{\color{blue}{\sigma^2}},0,0,\ldots)$

# - $\boldsymbol{\gamma} \;=\; \sum_{k\in\mathbb{Z}}\gamma_k z^k \;=\; \sigma^2 z^0 \;=\; \sigma^2\boldsymbol{1} \;=\; (\ldots,0,0,\sigma^2,0,0,\ldots)$

- $\boldsymbol{\rho} \;=\; \frac{1}{\gamma_0}\boldsymbol{\gamma} \;=\;
  \frac{1}{\sigma^2}\boldsymbol{\gamma} \;=\; 1 z^0 \;=\;
  (\ldots,0,0,{\color{blue}{1}},0,0,\ldots)$

# - $\boldsymbol{\rho} \;=\; \sum_{k\in\mathbb{Z}}\frac{\gamma_k}{\gamma_0} z^k \;=\; 1 z^0 \;=\; \boldsymbol{1} \;=\; (\ldots,0,0,1,0,0,\ldots)$

- $f(\omega) \;=\; \frac{1}{2\pi}\sum_{h\geq0}\gamma_h \cos(h\omega) \;=\; \frac{\sigma^2}{2\pi} \cos(0\omega) \;=\; \frac{\sigma^2}{2\pi};\quad \omega\in[-\pi,\pi]$

- $\boldsymbol{\pi} \;=\; 1 z^0 \;=\; (\ldots,0,0,{\color{blue}{1}},0,0,\ldots)$

# \sum_{k\in\mathbb{Z}}\pi_k z^k \;=\; 1 z^0 \;=\; 

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACFwhitenoise.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
wn <- um(ar = "(1 - 0B)")
display(list(wn), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACFwhitenoise.png]]

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file SimulWhitenoise.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(wn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"), main="Ruido blanco")
#+END_SRC


#+attr_ipynb: (slideshow . ((slide_type . fragment)))
#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/SimulWhitenoise.png]]


** Proceso de media móvil MA($q$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Sea $\boldsymbol{X}=\boldsymbol{\theta}*\boldsymbol{U}$, con
$\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$ y donde $\boldsymbol{\theta}$
es un polinomio de orden $q>0$, con $\theta_0=1$ y
con todas sus raíces fuera del círculo unidad
$(\boldsymbol{\theta}^{-\triangleright}\in\ell^1)$, es decir $$X_t=
\sum_{j=1}^q\theta_j U_{t-j}+U_t.$$

#+BEGIN_EXPORT latex
\begin{quotation}
\em
Este requisito no es necesario para que el proceso sea estacionario, pero por conveniencia se usan modelos MA que puedan tener una representación AR($\infty$) \emph{causal} (es decir, usando observaciones del pasado ``para construir'' el presente):
$$\boldsymbol{X}=\boldsymbol{\theta}*\boldsymbol{U}
\quad\rightarrow\quad
\frac{1}{\boldsymbol{\theta}}*\boldsymbol{X}=\boldsymbol{U}
\quad\Rightarrow\quad
U_t = \sum_{j=0}^\infty\psi_j X_{t-j}
$$
donde $\boldsymbol{\psi}=\boldsymbol{\theta}^{-\triangleright}=\boldsymbol{\theta}^{-1}\in\ell^1$. Entonces se dice que el modelo MA es ``\emph{invertible}''. Cualquier modelo MA sin raíces en el círculo unidad se puede reparametrizar para obtener un modelo invertible con la misma función de autocovarianzas ``$\boldsymbol{\gamma}$'' (\emph{Véase Sección 2.6 de Fuller (1996)}) y, consecuentemente, las mismas ACF, PACF y densidad espectral que el modelo original. Para tener una asociación uno a uno entre ACFs y procesos estocásticos, siempre asumiremos que las raíces de los polinomios MA, $\boldsymbol{\theta}$, son mayores que uno en valor absoluto.
\end{quotation}
#+END_EXPORT
Entonces $E(X_t)=0$ y

$\boldsymbol{\gamma} \;=\; \sigma^2 \boldsymbol{\theta}(z)*\boldsymbol{\theta}(z^{-1}) \;=\; \sigma^2 \sum\limits_{j,k=0}^q \theta_{j+k}\theta_{j} z^{j}\;$ (grado $q$ y cogrado $-q$)

$\boldsymbol{\rho} \;=\; \frac{1}{\gamma_0}\boldsymbol{\gamma}$

$f(\omega) \;=\; \frac{\sigma^2}{2\pi}\boldsymbol{\theta}(e^{-i\omega})\cdot\boldsymbol{\theta}(e^{i\omega}) \;=\; \frac{1}{2\pi}\sum\limits_{h=0}^q \gamma_h \cos(h\omega);\quad \omega\in[-\pi,\pi]\quad$ ($q$ cosenos $+1$)

$\boldsymbol{\pi}\;$ tiene grado $\infty$ y cogrado $-\infty\;$ y su magnitud decae paulatinamente cuando $\;k\to\infty$


** Proceso de media móvil MA($1$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Sea $\boldsymbol{X}=(1-\theta z)*\boldsymbol{U}$ con $|\theta|<1$ y
con $\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$, es decir $$X_t=U_t-\theta
U_{t-1}.$$

- $\boldsymbol{\gamma} \;=\; \sigma^2 (1-\theta z)*(1-\theta z^{-1})
  \;=\; \sigma^2 (\ldots,\ 0\ ,\ -\theta,\ {\color{blue}{(1+\theta^2)}},\ -\theta,\
  0,\ \ldots)$

- $\boldsymbol{\rho} \;=\; \frac{1}{\gamma_0}\boldsymbol{\gamma} \;=\;
  \frac{1}{\sigma^2(1+\theta^2)}\boldsymbol{\gamma}$

- $f(\omega) \;=\;
  \frac{\sigma^2}{2\pi}\boldsymbol{\theta}(e^{-i\omega})\cdot\boldsymbol{\theta}(e^{i\omega})
  \;=\;
  \frac{\sigma^2}{2\pi}\Big((1+\theta^2)\;-\;2\theta\cos(\omega)\Big);\quad
  \omega\in[-\pi,\pi]$

- $\boldsymbol{\pi} \;=\; \sum\limits_{k\in\mathbb{Z}}{  \frac{-\theta^k(1-\theta^2)}{1-\theta^{2(k+1)}} z^k}$

*** MA(1) con raíz positiva
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# PARÁMETRO NEGATIVO (violeta)

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA1p.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma1p <- um(ma = "(1 - 0.9B)")
display(list(ma1p), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1-0.9z\quad\Rightarrow\quad X_t=
(1-0.9 \mathsf{B})U_t\qquad {\color{blue}{(\theta>0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA1p.png]]

#+name: raices-ma1p
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result  :results value table pp :results none
roots(ma1p)
#+END_SRC

#+RESULTS: raices-ma1p
:RESULTS:
1. 
   |     Real | Imaginary |  Modulus | Frequency | Period | Mult. |
   |----------+-----------+----------+-----------+--------+-------|
   | 1.111111 |         0 | 1.111111 |         0 |    Inf |     1 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA1p.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma1p, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA1p.png]]

*** MA(1) con raíz negativa
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# PARÁMETRO POSITIVO (rojo)

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA1n.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma1n <- um(ma = "(1 + 0.9B)")
display(list(ma1n), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1+0.9z\quad\Rightarrow\quad X_t=
(1+0.9 \mathsf{B})U_t\qquad {\color{blue}{(\theta<0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA1n.png]]

#+name: raices-ma1n
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma1n)
#+END_SRC

#+RESULTS: raices-ma1n
:RESULTS:
1. 
   |      Real | Imaginary |  Modulus | Frequency | Period | Mult. |
   |-----------+-----------+----------+-----------+--------+-------|
   | -1.111111 |         0 | 1.111111 |       0.5 |      2 |     1 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA1n.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma1n, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA1n.png]]



** Proceso de media móvil MA($2$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Sea $\boldsymbol{X}=(1-\theta_1 z-\theta_2 z^2)*\boldsymbol{U}$, con
$\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$ y con
$$\theta_1+\theta_2<1;\qquad \theta_2-\theta_1<1;\qquad |\theta_2|<1;\quad \text{(i.e., invertible)}$$
es decir $X_t=U_t-\theta_1 U_{t-1}-\theta_2 U_{t-2}$.

- $\boldsymbol{\gamma} \;=\; \sigma^2 (1-\theta_1 z-\theta_2 z^2)*(1-\theta_1 z^{-1}-\theta_2 z^{-2})$
  # $\sigma^2(\ldots,\; 0,\; -\theta_2,\; -\theta_1(1-\theta_2),\; {\color{blue}{1+\theta_1^2+\theta_2^2}},\; -\theta_1(1-\theta_2),\; -\theta_2,\; 0,\;\ldots)$ 
  
  $\gamma_0={\color{blue}{\sigma^2(1+\theta_1^2+\theta_2^2)}};\qquad$
  $\gamma_1=\sigma^2\big(-\theta_1(1-\theta_2)\big);\qquad$
  $\gamma_2=\sigma^2(-\theta_2)$

  $\gamma_3=\gamma_4=\cdots=0\qquad$ (y es simétrica) 

- $\boldsymbol{\rho} \;=\; \frac{1}{\gamma_0}\boldsymbol{\gamma} \;=\; \frac{1}{\sigma^2(1+\theta_1^2+\theta_2^2)}\boldsymbol{\gamma}$

- $f(\omega) \;=\;  \frac{\sigma^2}{2\pi}\Big((1+\theta_1^2+\theta_2^2)\;-\;2\theta_1(1+\theta_2)\cos(\omega)\;-\;2\theta_2\cos(2\omega)\Big)$
# ;\; -\pi\leq\omega\leq\pi
# \frac{\sigma^2}{2\pi}\boldsymbol{\theta}(e^{-i\omega})*\boldsymbol{\theta}(e^{i\omega}) \;=\;

- $\boldsymbol{\pi}$ tiene una expresión complicada, pero su magnitud
  decae paulatinamente.

*** MA(2) con $\theta_1>0$ y $\theta_2>0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2thpp.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2thpp <- um(ma = "(1 -0.6B - 0.3B^2)")
display(list(ma2thpp), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1-0.6z -0.3z^2\quad\Rightarrow\quad X_t=
(1-0.6\mathsf{B}-0.3\mathsf{B}^2)U_t
\qquad {\color{blue}{(\theta_1>0 \;\text{y}\; \theta_2>0)}}$$
#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2thpp.png]]

#+name: raices-ma2thpp
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2thpp)
#+END_SRC

#+RESULTS: raices-ma2thpp
:RESULTS:
1. 
   |      Real |     Imaginary |  Modulus | Frequency | Period | Mult. |
   |-----------+---------------+----------+-----------+--------+-------|
   |  1.081666 | -8.077936e-28 | 1.081666 |       0.0 |    Inf |     1 |
   | -3.081666 |  8.077936e-28 | 3.081666 |       0.5 |      2 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2thpp.png :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2thpp, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2thpp.png]]

*** MA(2) con $\theta_1<0$ y $\theta_2<0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2thnn.png :exports codethpp :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2thnn <- um(ma = "(1 +0.9B + 0.9B^2)")
display(list(ma2thnn), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1+0.9z+0.9z^2\quad\Rightarrow\quad X_t=
(1+0.9\mathsf{B}+0.9\mathsf{B}^2)U_t
\qquad {\color{blue}{(\theta_1<0 \;\text{y}\; \theta_2<0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2thnn.png]]

#+name: raices-ma2thnn
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2thnn)
#+END_SRC

#+RESULTS: raices-ma2thnn
:RESULTS:
1. 
   | Real |  Imaginary |  Modulus | Frequency |   Period | Mult. |
   |------+------------+----------+-----------+----------+-------|
   | -0.5 |  0.9279607 | 1.054093 | 0.3286569 | 3.042687 |     1 |
   | -0.5 | -0.9279607 | 1.054093 | 0.3286569 | 3.042687 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2thnn.png  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2thnn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2thnn.png]]

*** MA(2) con $\theta_1>0$ y $\theta_2<0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2thpn.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2thpn <- um(ma = "(1 -1.1B + 0.9B^2)")
display(list(ma2thpn), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1-1.1z +0.9z^2\quad\Rightarrow\quad X_t=
(1-1.1\mathsf{B}+0.9\mathsf{B}^2)U_t
\qquad {\color{blue}{(\theta_1>0 \;\text{y}\; \theta_2<0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2thpn.png]]

#+name: raices-ma2thpn
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2thpn)
#+END_SRC

#+RESULTS: raices-ma2thpn
:RESULTS:
1. 
   |      Real | Imaginary |  Modulus | Frequency |   Period | Mult. |
   |-----------+-----------+----------+-----------+----------+-------|
   | 0.6111111 |  0.858868 | 1.054093 | 0.1515749 | 6.597397 |     1 |
   | 0.6111111 | -0.858868 | 1.054093 | 0.1515749 | 6.597397 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2thpn.png  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2thpn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2thpn.png]]

*** MA(2) con $\theta_1<0$ y $\theta_2>0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2thnp.png :exports codethpp :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2thnp <- um(ma = "(1 +0.6B - 0.3B^2)")
display(list(ma2thnp), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1+0.6z-0.3z^2\quad\Rightarrow\quad X_t=
(1+0.6\mathsf{B}-0.3\mathsf{B}^2)U_t
\qquad {\color{blue}{(\theta_1<0 \;\text{y}\; \theta_2>0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2thnp.png]]

#+name: raices-ma2thnp
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2thnp)
#+END_SRC

#+RESULTS: raices-ma2thnp
:RESULTS:
1. 
   |      Real |     Imaginary |  Modulus | Frequency | Period | Mult. |
   |-----------+---------------+----------+-----------+--------+-------|
   |  3.081666 |  3.831501e-21 | 3.081666 |       0.0 |    Inf |     1 |
   | -1.081666 | -3.831501e-21 | 1.081666 |       0.5 |      2 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2thnp.png  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2thnp, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2thnp.png]]


*** MA(2) con dos raíces reales, una positiva y la otra negativa
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# MA2 verde

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2pn.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2pn <- um(ma = "(1 - 0.64B^2)")
display(list(ma2pn), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1-0.64z^2\quad\Rightarrow\quad X_t=
(1-0.64\mathsf{B}^2)U_t
\qquad {\color{blue}{(\text{raices reales: +, -})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2pn.png]]

#+name: raices-ma2pn
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2pn)
#+END_SRC

#+RESULTS: raices-ma2pn
:RESULTS:
1. 
   |  Real | Imaginary | Modulus | Frequency | Period | Mult. |
   |-------+-----------+---------+-----------+--------+-------|
   |  1.25 |         0 |    1.25 |       0.0 |    Inf |     1 |
   | -1.25 |         0 |    1.25 |       0.5 |      2 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2pn.png  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2pn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2pn.png]]

*** MA(2) con un par de raíces complejas
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# MA2 rojo y violeta

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2np.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2np <- um(ma = "(1 + 0.64B^2)")
display(list(ma2np), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1+0.64z^2\quad\Rightarrow\quad X_t=
(1+0.64\mathsf{B}^2)U_t
\qquad {\color{blue}{(\text{par de raices complejas})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2np.png]]


#+name: raices-ma2np
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2np)
#+END_SRC

#+RESULTS: raices-ma2np
:RESULTS:
1. 
   | Real | Imaginary | Modulus | Frequency | Period | Mult. |
   |------+-----------+---------+-----------+--------+-------|
   |    0 |      1.25 |    1.25 |      0.25 |      4 |     1 |
   |    0 |     -1.25 |    1.25 |      0.25 |      4 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2np.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2np, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2np.png]]

*** MA(2) con dos raíces reales y negativas
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# MA2 rojo

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2rojo.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2rojo <- um(ma = "(1 + 1.6B + .64B^2 )")
display(list(ma2rojo), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1+1.6z+0.64z^2\quad\Rightarrow\quad X_t=
(1+1.6\mathsf{B}+0.64\mathsf{B}^2)U_t
\qquad {\color{blue}{(\text{r. reales: -, -})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2rojo.png]]


#+name: raices-ma2rojo
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2rojo)
#+END_SRC

#+RESULTS: raices-ma2rojo
:RESULTS:
1. 
   |  Real |     Imaginary | Modulus | Frequency | Period | Mult. |
   |-------+---------------+---------+-----------+--------+-------|
   | -1.25 | -1.110223e-16 |    1.25 |       0.5 |      2 |     2 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2rojo.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2rojo, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2rojo.png]]

*** MA(2) con dos raíces reales y positivas
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# MA2 violeta

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-MA2violeta.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ma2violeta <- um(ma = "(1 - 1.6B + .64B^2 )")
display(list(ma2violeta), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\theta}(z)=1-1.6z+0.64z^2\quad\Rightarrow\quad X_t=
(1-1.6\mathsf{B}+0.64\mathsf{B}^2)U_t
\qquad {\color{blue}{(\text{r. reales: +, +})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-MA2violeta.png]]


#+name: raices-ma2violeta
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ma2violeta)
#+END_SRC

#+RESULTS: raices-ma2violeta
:RESULTS:
1. 
   | Real |     Imaginary | Modulus | Frequency | Period | Mult. |
   |------+---------------+---------+-----------+--------+-------|
   | 1.25 | -2.775558e-16 |    1.25 |         0 |    Inf |     2 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-MA2violeta.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2violeta, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-MA2violeta.png]]


** Proceso autorregresivo AR($p$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Sea $\boldsymbol{\phi}*\boldsymbol{X}=\boldsymbol{U}$, con
$\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$ y donde $\boldsymbol{\phi}$ es
un polinomio de grado $p>0$ con $\phi_0=1$. Entonces
$$(\boldsymbol{\phi}*\boldsymbol{X})_t=\boldsymbol{\phi}(\mathsf{B})X_t=
(1+\phi_1\mathsf{B}+\phi_2\mathsf{B}^2+\cdots+\phi_p\mathsf{B}^p)X_t=
U_t$$ Y por tanto $$X_t= U_t-\sum_{j=1}^p\phi_j X_{t-j}.$$


#+attr_ipynb: (slideshow . ((slide_type . subslide)))
Si todas las raíces del polinomio $\boldsymbol{\phi}$ (de grado $p$)
están fuera del círculo unidad, es decir, si /el polinomio AR es
``invertible''/
$\;(\boldsymbol{\phi}^{-\triangleright}=\boldsymbol{\phi}^{-1}\in\ell^1)\;$
entonces $\boldsymbol{X}$ tiene una representación como proceso lineal
causal MA($\infty$): $$\boldsymbol{\phi}*\boldsymbol{X}=\boldsymbol{U}
\quad\Rightarrow\quad
\boldsymbol{X}=\frac{1}{\boldsymbol{\phi}}*\boldsymbol{U}
\quad\Rightarrow\quad X_t = U_t + \sum_{j=1}^\infty\psi_j U_{t-j};$$
donde $\;\boldsymbol{\phi}^{-1}=\boldsymbol{\psi}=({\color{blue}1},\
\psi_1,\ \psi_2,\ \psi_3,\ldots)\;$ tiene grado $\infty$.
#+latex: \bigskip

#+attr_ipynb: (slideshow . ((slide_type . fragment)))
#+latex: \noindent
Por tanto $E(X_t)=0$ para todo $t\in\mathbb{Z}$ y

$\boldsymbol{\gamma} \;=\; \sigma^2 \frac{1}{\boldsymbol{\phi}(z)}*\frac{1}{\boldsymbol{\phi}(z^{-1})} \;=\; \sigma^2 \sum\limits_{j,k=0}^\infty \psi_{j+k}\psi_j z^{j}\quad$ (grado $\infty$ y cogrado $-\infty$)

$\boldsymbol{\rho} \;=\; \frac{1}{\gamma_0}\boldsymbol{\gamma}$

$f(\omega) =
  \frac{\sigma^2}{2\pi}\frac{1}{\boldsymbol{\phi}(e^{-i\omega})\cdot\boldsymbol{\phi}(e^{i\omega})}
  \;=\; \frac{1}{2\pi}\sum\limits_{h=0}^\infty \gamma_h
  \cos(h\omega);\quad$ donde $\omega\in[-\pi,\pi]$.

(suma infinita de cosenos)
#+latex: \medskip

#+attr_ipynb: (slideshow . ((slide_type . fragment)))
Pero la PACF, $\;\boldsymbol{\pi},\;$ es una secuencia
con grado $p$ y cogrado $-p$ (demo en los apuntes).
#+latex: \medskip

*** Demostración de que la PACF tiene cogrado $-p$ y grado $p$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . skip)))
   :END:
#+attr_ipynb: (slideshow . ((slide_type . notes)))
- Sea $\boldsymbol{X}$ un proceso causal AR($p$): $\quad
  X_t\;=\;\sum\limits_{j=1}^p\phi_j X_{t-j}+U_t$ @@latex:donde
  $\boldsymbol{U}\sim WN(0,\sigma^2)$.@@
- La proyección de $X_{k+1}$ sobre el espacio $\bar{sp}(X_{2}:X_k)$
  generado por $X_2,\ldots X_k$ (con $k>p$) es:
  $$\widehat{X_{k+1}}=P_{\bar{sp}(X_{2}:X_k)}(X_{k+1})=\sum_{j=1}^p\phi_j X_{k+1-j}$$
- De su representación MA($\infty$): $\;Y\in\bar{sp}(X_{2}:X_k)
  \;\Rightarrow\; Y\in\bar{sp}(U_j\mid{j\leq k})$, pues
  $$X_t\;=\;\sum\limits_{j=0}^{\infty} \psi_j U_{t-j}
  \quad\Rightarrow\quad
  \bar{sp}(X_{2}:X_k)\subset\bar{sp}(U_j\mid{j\leq k}) \; \perp \; U_{k+1}$$
- Si $Y\in\bar{sp}(X_{2}:X_k)$ entonces $Cov\Big((X_{k+1}-\widehat{X_{k+1}}), Y\Big)=Cov(U_{k+1}, Y)=0$
- Denotemos con $\widetilde{X_{1}}$ a la proyección
  $P_{\bar{sp}(X_{2}:X_k)}(X_{1})$ de $X_1$ sobre
  $\bar{sp}(X_{2}:X_k)$
- Ahora es fácil ver que $\pi_k=0$ para $k>p$, pues
  \begin{eqnarray*}
   \pi_k 
   = & Corr\Big((X_{k+1}-\widehat{X_{k+1}}),(X_{1}-\widetilde{X_{1}})\Big)\\
   = & Corr\Big(U_{k+1},(X_{1}-\widetilde{X_{1}})\Big) \; = \; 0
  \end{eqnarray*}
  ya que $U_{k+1}\perp(X_{1}-\widetilde{X_{1}}) \in \bar{sp}(U_j\mid{j\leq k})$.


** Proceso autorregresivo AR($1$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:
Sea $\;(1-\phi z)*\boldsymbol{X}=\boldsymbol{U},\quad$ con
$\;|\phi|<1\;$ y con $\;\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$, es
decir $$X_t=\phi X_{t-1} + U_t.$$

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_EXPORT latex
\noindent
Como $$\;(1-a z)*(1+a z+a^2 z^2+a^3 z^3+\cdots)=1,\;$$ 
ahora hay que calcular infinitos términos en 
$$\boldsymbol{\gamma} \;=\; \sigma^2 (1-\phi z)^{-1}*(1-\phi z^{-1})^{-1}.$$
% #+latex:\medskip

% # +attr_ipynb: (slideshow . ((slide_type . subslide)))
Hay varias formas de hacer los cálculos. Una es vía los productos convolución;
puesto que 
$$(1-a^2 z)^{-1}=(1+a^2 z+a^4 z^2+a^6 z^3+\cdots)=\sum_{h\in\mathbb{Z}} a^{2|h|} z^h$$ 
(para verlo basta sustituir $a^2$ por $b$), tenemos que $(1-a z)^{-1}*(1-a z^{-1})^{-1}$ es:
$$
\begin{array}{rcccccccl}
(\ldots,& 0,& 0,& 0,& {\color{blue}{1}},& a,& a^2,& a^3,& \ldots)\\
*(\ldots,& a^3,& a^2,& a,& {\color{blue}{1}},& 0,& 0,& 0,& \ldots)\\\hline
=(\ldots,& \frac{a^3}{1+a^2},& \frac{a^2}{1+a^2},& \frac{a}{1+a^2},&{\color{blue}{\frac{1}{1+a^2}}},& \frac{a}{1+a^2},& \frac{a^2}{1+a^2},& \frac{a^3}{1+a^2},& \ldots)
\end{array}$$
(donde además hemos sustituido $z$ por $1$, pues cada término es una suma).
% #+latex: \smallskip
\smallskip

Es decir $(1-a z)^{-1}*(1-a z^{-1})^{-1}=\sum\limits_{k\in\mathbb{Z}}\frac{a^{|k|}}{1-a^2}z^k$; y por tanto
$$\boldsymbol{\gamma} \;=\; \sigma^2 (1-\phi z)^{-1}*(1-\phi
  z^{-1})^{-1} \;=\; \frac{\sigma^2}{1-\phi^2} \sum_{k=-\infty}^\infty
  \phi^{|k|} z^k$$
% #+latex: \bigskip

% # +attr_ipynb: (slideshow . ((slide_type . subslide)))
Pero también podemos usar las Ecuaciones de Yule-Walker (Lecc. 5). En
este caso (donde el único parámetro es $\phi_1=\phi$), en cuanto a la
ACF tenemos que: $$\rho_k=\phi\rho_{k-1}\qquad k>0$$ y como $\rho_0=1$
$$\rho_k=\phi^k\qquad k\geq0$$ Y en cuanto a la varianza, dado que
$\rho_1=\phi$
$$\gamma_0=\frac{\sigma^2}{1-\rho_1\phi}=\frac{\sigma^2}{1-\phi^2}.$$
Por tanto, la función de autocovarianzas es $$\boldsymbol{\gamma}
\;=\; \gamma_0\cdot\boldsymbol{\rho} \;=\; \frac{\sigma^2}{1-\phi^2}
\sum_{k=-\infty}^\infty \phi^{|k|} z^k$$
% #+latex: \bigskip
\bigskip

% ** Proceso autorregresivo AR($1$)
%    :PROPERTIES:
%    :metadata: (slideshow . ((slide_type . subslide)))
%    :UNNUMBERED: t 
%    :END:
Así pues,
si $\;(1-\phi z)*\boldsymbol{X}=\boldsymbol{U},\quad$ con
$\;|\phi|<1\;$ y con $\;\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$, es
decir, si $$X_t=\phi X_{t-1} + U_t$$
#+END_EXPORT
#+attr_ipynb: (slideshow . ((slide_type . fragment)))
como $\;\boldsymbol{X}=(1-\phi z)^{-1}*\boldsymbol{U},\quad$ tenemos que

$\boldsymbol{\gamma} \;=\; \sigma^2 (1-\phi z)^{-1}*(1-\phi
  z^{-1})^{-1} \;=\; \frac{\sigma^2}{1-\phi^2}
  \sum\limits_{k=-\infty}^\infty \phi^{|k|} z^k\qquad$ grado $\infty$ y cogrado $-\infty$

$\boldsymbol{\rho} \;=\; \frac{1}{\gamma_0}\boldsymbol{\gamma} \;=\;
  \frac{1+\phi^2}{\sigma^2}\boldsymbol{\gamma} \;=\;
  \sum\limits_{j=-\infty}^\infty \phi^{|j|} z^j \quad\Rightarrow\quad
  \rho_k=\phi^k$ para $k\geq0$.

$f(\omega) \;=\; \frac{1}{2\pi}\sum\limits_{h=0}^\infty \gamma_h
  \cos(h\omega)=\frac{\sigma^2}{2\pi}\frac{1}{1+\phi^2-2\phi\cos(\omega)}\;$ (compárese con MA($1$)).
#  = \frac{\sigma^2}{2\pi}\frac{1}{\boldsymbol{\phi}(e^{-i\omega})\cdot\boldsymbol{\phi}(e^{i\omega})}


$\boldsymbol{\pi} \;=\; (\ldots,\; 0,\; 0,\; \phi,\; {\color{blue}1},\; \phi,\; 0,\; 0,\;\ldots)\qquad$ grado $1$ y cogrado $-1$
# :\quad$ $\pi_0=1,\quad$ $\pi_1=\rho_1=\phi,\quad$ $0=\pi_2=\pi_3=\cdots$

*** AR(1) con raíz positiva
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# PARÁMETRO NEGATIVO (rojo)

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR1p.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar1p <- um(ar = "(1 - 0.9B)")
display(list(ar1p), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1-0.9z\quad\Rightarrow\quad X_t=0.9X_{t-1}+U_t\qquad {\color{blue}{(\phi>0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR1p.png]]

#+name: raices-ar1p
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar1p)
#+END_SRC

#+RESULTS: raices-ar1p
:RESULTS:
1. 
   |     Real | Imaginary |  Modulus | Frequency | Period | Mult. |
   |----------+-----------+----------+-----------+--------+-------|
   | 1.111111 |         0 | 1.111111 |         0 |    Inf |     1 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR1p.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar1p, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR1p.png]]

*** AR(1) con raíz negativa
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# PARÁMETRO POSITIVO (violeta)

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR1n.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar1n <- um(ar = "(1 + 0.9B)")
display(list(ar1n), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1+0.9z\quad\Rightarrow\quad X_t=-0.9X_{t-1}+U_t\qquad {\color{blue}{(\phi<0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR1n.png]]

#+name: raices-ar1n
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar1n)
#+END_SRC

#+RESULTS: raices-ar1n
:RESULTS:
1. 
   |      Real | Imaginary |  Modulus | Frequency | Period | Mult. |
   |-----------+-----------+----------+-----------+--------+-------|
   | -1.111111 |         0 | 1.111111 |       0.5 |      2 |     1 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR1n.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar1n, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR1n.png]]



** Proceso autorregresivo AR($2$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Sea $\quad(1-\phi_1 z-\phi_2 z^2)*\boldsymbol{X}=\boldsymbol{U},\quad$
con $\;\boldsymbol{U}\sim WN(0,\sigma^2)\;$ y con
$$\phi_1+\phi_2<1;\qquad \phi_2-\phi_1<1;\qquad |\phi_2|<1;\quad
\text{(i.e., estacionario)}$$ es decir $$X_t=\phi_1 X_{t-1} + \phi_2
X_{t-2} + U_t.$$ Entonces
#+latex: \medskip

$\boldsymbol{\gamma}=\sigma^2\left(
  \frac{1}{\boldsymbol{\phi}(z)}*\frac{1}{\boldsymbol{\phi}(z^-1)}\right)\qquad$
  # (Verifica Ec. Yule-Walker:  $\;\gamma_k=\phi_1\gamma_{k-1}+\phi_2\gamma_{k-2};\;$ decae paulatinamente)
#  [[eqref:eqYuleW3][(3)]
#+BEGIN_EXPORT latex
\smallskip

$\quad$ (\emph{de Ec. Yule-Walker: $\gamma_0 =
   \frac{\sigma^2}{1-\phi_1\rho_1-\phi_2\rho_2}$ y resolvemos
   $\gamma_k=\phi_1\gamma_{k-1}+\phi_2\gamma_{k-2}$ recursivamente})
%   $\boldsymbol{\phi}(\mathsf{B})\gamma_k=0$ recursivamente})
%   #  = \frac{1-\phi_2}{1+\phi_2}\frac{\sigma^2}{(1-\phi_2)^2-\phi_1^2}
% #+latex: \medskip
#+END_EXPORT

$\boldsymbol{\rho} \;=\;
\frac{1}{\gamma_0}\boldsymbol{\gamma}\qquad$
(Verifica Ec. Yule-Walker:
$\;\rho_k=\phi_1\rho_{k-1}+\phi_2\rho_{k-2};\;\qquad$ decae@@latex: paulatinamente@@)
#+latex: \smallskip

#+latex:  $\quad$ \emph{(con $\rho_0=1$ iniciamos el cálculo de $\boldsymbol{\phi}(\mathsf{B})\rho_k=0$ recursivamente)} \medskip

$f(\omega) \;=\;  \frac{\sigma^2}{2\pi}\frac{1}{1+\phi_1^2+\phi_2^2-2\phi_1(1+\phi_2)\cos(\omega)-2\phi_2\cos(2\omega)}$
# \frac{\sigma^2}{2\pi}\boldsymbol{\phi}(e^{-i\omega})*\boldsymbol{\phi}(e^{i\omega}) \;=\;
# ;\quad -\pi\leq\omega\leq\pi
#+latex: \medskip

$\boldsymbol{\pi} \;=\; (\ldots,\; 0,\; \phi_2,\; \frac{\phi_1}{1-\phi_2},\; {\color{blue}1},\; \frac{\phi_1}{1-\phi_2},\; \phi_2,\; 0,\;\ldots)$ 
# :\quad$ $\pi_0=1,\quad$ $\pi_1=\rho_1=\phi,\quad$ $0=\pi_2=\pi_3=\cdots$

*** AR(2) con $\phi_1>0$ y $\phi_2>0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2phpp.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2phpp <- um(ar = "(1 -0.6B - 0.3B^2)")
display(list(ar2phpp), lag.max = 20, byrow = TRUE) #, log.spec = TRUE
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1-0.6z -0.3z^2\quad\Rightarrow\quad
(1-0.6\mathsf{B}-0.3\mathsf{B}^2)X_t= U_t \qquad
{\color{blue}{(\phi_1>0 \;\text{y}\; \phi_2>0)}}$$
#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2phpp.png]]

#+name: raices-ar2phpp
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar2phpp)
#+END_SRC

#+RESULTS: raices-ar2phpp
:RESULTS:
1. 
   |      Real |     Imaginary |  Modulus | Frequency | Period | Mult. |
   |-----------+---------------+----------+-----------+--------+-------|
   |  1.081666 | -8.077936e-28 | 1.081666 |       0.0 |    Inf |     1 |
   | -3.081666 |  8.077936e-28 | 3.081666 |       0.5 |      2 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2phpp.png :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2phpp, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR2phpp.png]]

*** AR(2) con $\phi_1<0$ y $\phi_2<0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2phnn.png :exports codethpp :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2phnn <- um(ar = "(1 +0.9B + 0.9B^2)")
display(list(ar2phnn), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1+0.9z+0.9z^2\quad\Rightarrow\quad
(1+0.9\mathsf{B}+0.9\mathsf{B}^2)X_t= U_t \qquad
{\color{blue}{(\phi_1<0 \;\text{y}\; \phi_2<0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2phnn.png]]

#+name: raices-ar2phnn
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar2phnn)
#+END_SRC

#+RESULTS: raices-ar2phnn
:RESULTS:
1. 
   | Real | Imaginary  | Modulus  | Frequency | Period   | Mult. |
   |------+------------+----------+-----------+----------+-------|
   | -0.5 | 0.9279607  | 1.054093 | 0.3286569 | 3.042687 | 1     |
   | -0.5 | -0.9279607 | 1.054093 | 0.3286569 | 3.042687 | 1     |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2phnn.png  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2phnn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR2phnn.png]]

*** AR(2) con $\phi_1>0$ y $\phi_2<0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2phpn.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2phpn <- um(ar = "(1 -1.1B + 0.9B^2)")
display(list(ar2phpn), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1-1.1z +0.9z^2\quad\Rightarrow\quad
(1-1.1\mathsf{B}+0.9\mathsf{B}^2)X_t= U_t \qquad
{\color{blue}{(\phi_1>0 \;\text{y}\; \phi_2<0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2phpn.png]]

#+name: raices-ar2phpn
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar2phpn)
#+END_SRC

#+RESULTS: raices-ar2phpn
:RESULTS:
1. 
   | Real      | Imaginary | Modulus  | Frequency | Period   | Mult. |
   |-----------+-----------+----------+-----------+----------+-------|
   | 0.6111111 | 0.858868  | 1.054093 | 0.1515749 | 6.597397 | 1     |
   | 0.6111111 | -0.858868 | 1.054093 | 0.1515749 | 6.597397 | 1     |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2phpn.png  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2phpn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR2phpn.png]]

*** AR(2) con $\phi_1<0$ y $\phi_2>0$
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2phnp.png :exports codethpp :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2phnp <- um(ar = "(1 +0.6B - 0.3B^2)")
display(list(ar2phnp), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1+0.6z-0.3z^2\quad\Rightarrow\quad
(1+0.6\mathsf{B}-0.3\mathsf{B}^2)X_t= U_t \qquad
{\color{blue}{(\phi_1<0 \;\text{y}\; \phi_2>0)}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2phnp.png]]

#+name: raices-ar2phnp
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar2phnp)
#+END_SRC

#+RESULTS: raices-ar2phnp
:RESULTS:
1. 
   | Real      | Imaginary     | Modulus  | Frequency | Period | Mult. |
   |-----------+---------------+----------+-----------+--------+-------|
   | 3.081666  | 3.831501e-21  | 3.081666 | 0.0       | Inf    | 1     |
   | -1.081666 | -3.831501e-21 | 1.081666 | 0.5       | 2      | 1     |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2phnp.png  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2phnp, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR2phnp.png]]


*** AR(2) con dos raíces reales, una positiva y la otra negativa
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# AR2 rojo y violeta

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2pn.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2pn <- um(ar = "(1 + 0.1B - 0.8B^2)")
display(list(ar2pn), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1+0.1z-0.8z^2\quad\Rightarrow\quad
(1+.1\mathsf{B}-.8\mathsf{B}^2)X_t = U_t \qquad
{\color{blue}{(\text{raices reales: +, -})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2pn.png]]

#+name: raices-ar2pn
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar2pn)
#+END_SRC

#+RESULTS: raices-ar2pn
:RESULTS:
1. 
   | Real     | Imaginary     | Modulus | Frequency | Period | Mult. |
   |----------+---------------+---------+-----------+--------+-------|
   | 1.18228  | 7.754818e-26  | 1.18228 | 0.0       | Inf    | 1     |
   | -1.05728 | -7.754818e-26 | 1.05728 | 0.5       | 2      | 1     |
   #+caption: A matrix: 2 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2pn.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2pn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR2pn.png]]

*** AR(2) con un par de raíces complejas
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# AR2 verde

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2np.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2np <- um(ar = "(1 - 0.1B + 0.8B^2)")
display(list(ar2np), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1-0.1z+0.8z^2\quad\Rightarrow\quad
 (1-.1\mathsf{B}+.8\mathsf{B}^2)X_t = U_t \qquad
 {\color{blue}{(\text{par de r. complejas})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2np.png]]


#+name: raices-ar2np
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar2np)
#+END_SRC

#+RESULTS: raices-ar2np
:RESULTS:
1. 
   |   Real | Imaginary |  Modulus | Frequency |   Period | Mult. |
   |--------+-----------+----------+-----------+----------+-------|
   | 0.0625 |  1.116286 | 1.118034 | 0.2410983 | 4.147685 |     1 |
   | 0.0625 | -1.116286 | 1.118034 | 0.2410983 | 4.147685 |     1 |
   #+caption: A matrix: 2 × 6 of type dbl
:END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2np.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2np, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
c[[./img/lecc06/Sim-AR2np.png]]

*** AR(2) con dos raíces reales y negativas
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# AR2 azul

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2azul.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2azul <- um(ar = "(1 + 1.6B + .64B^2 )")
display(list(ar2azul), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1+1.6z+0.64z^2\quad\Rightarrow\quad 
(1+1.6\mathsf{B}+.64\mathsf{B}^2)X_t = U_t \quad
{\color{blue}{(\text{raices reales: -, -})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2azul.png]]


#+name: raices-ar2azul
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp :results none
roots(ar2azul)
#+END_SRC

#+RESULTS: raices-ar2azul
:RESULTS:
1. 
   |  Real |     Imaginary | Modulus | Frequency | Period | Mult. |
   |-------+---------------+---------+-----------+--------+-------|
   | -1.25 | -1.110223e-16 |    1.25 |       0.5 |      2 |     2 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2azul.png :exports code :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2azul, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR2azul.png]]

*** AR(2) con dos raíces reales y positivas
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . notes)))
   :END:

# AR2 rojo

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file ACF-AR2rojo.png :exports code  :results none
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
ar2rojo <- um(ar = "(1 - 1.6B + .64B^2 )")
display(list(ar2rojo), lag.max = 20, byrow = TRUE)
#+END_SRC

#+attr_ipynb: (slideshow . ((slide_type . subslide)))
$$\boldsymbol{\phi}(z)=1-1.6z+.64z^2\quad\Rightarrow\quad 
(1-1.6\mathsf{B}+.64\mathsf{B}^2)X_t = U_t \quad
{\color{blue}{(\text{raices reales: +, +})}}$$

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/ACF-AR2rojo.png]]


#+name: raices-ar2rojo
#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :exports result :results value table pp  :results none
roots(ar2rojo)
#+END_SRC

#+RESULTS: raices-ar2rojo
:RESULTS:
1. 
   | Real |     Imaginary | Modulus | Frequency | Period | Mult. |
   |------+---------------+---------+-----------+--------+-------|
   | 1.25 | -2.775558e-16 |    1.25 |         0 |    Inf |     2 |
   #+caption: A matrix: 1 × 6 of type dbl
:END:


#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R :results file :output-dir ./img/lecc06/ :file Sim-AR2rojo.png :exports code  :results none
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ar2rojo, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+attr_org: :width 800
#+attr_html: :width 900px
#+attr_latex: :width 425px
[[./img/lecc06/Sim-AR2rojo.png]]


* (Resumen) características de procesos MA($q$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

#+latex: \noindent
_Siempre estacionario._

#+latex: \noindent
Para ser invertible raíces $\boldsymbol{\theta}$ fuera del círculo
unidad
$(\boldsymbol{\theta}^{-\triangleright}=\boldsymbol{\theta}^{-1}\in\ell^1)$
#+latex: \bigskip

*Tipos de representación del proceso*

#+latex: \noindent
- Como suma ponderada finita :: (número finito de parámetros)
  $$\boldsymbol{X}=\boldsymbol{\theta}*\boldsymbol{U}
  \quad\Rightarrow\quad X_t=\boldsymbol{\theta}(\mathsf{B})U_t$$
- Como suma ponderada infinita :: (_solo existe si es invertible_):
  $$\frac{1}{\boldsymbol{\theta}}*\boldsymbol{X}=\boldsymbol{U}
  \quad\Rightarrow\quad
  \frac{1}{\boldsymbol{\theta}}(\mathsf{B})X_t=U_t$$
#+latex: \bigskip

#+latex: {\bf Comportamiento de las funciones asociadas a los segundo momentos}
#+latex: \medskip

#+latex: \noindent
*ACF ($\boldsymbol{\rho}$):* Grado ($q$) y cogrado ($-q$)
#+latex: \smallskip

#+latex: \noindent
*PACF ($\boldsymbol{\pi}$):* Grado ($\infty$) y cogrado ($-\infty$):
@@latex:Combinación de @@ exponenciales y/o sinusoidales amortiguadas.
#+latex: \smallskip

#+latex: \noindent
*Densidad espectral* proporcional al inverso de la densidad espectral
  de $\;\boldsymbol{\theta}*\boldsymbol{X}=\boldsymbol{U}$


* (Resumen) características de procesos AR($p$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . subslide)))
   :END:

#+latex: \noindent
_Siempre invertible._

#+latex: \noindent
Para ser estacionario raíces de $\boldsymbol{\phi}$ fuera del círculo
unidad
$(\boldsymbol{\phi}^{-\triangleright}=\boldsymbol{\phi}^{-1}\in\ell^1)$
#+latex: \bigskip

*Tipos de representación del proceso*

#+latex: \noindent
- Como suma ponderada finita :: (número finito de parámetros)
  $$\boldsymbol{\phi}*\boldsymbol{X}=\boldsymbol{U}
  \quad\Rightarrow\quad \boldsymbol{\phi}(\mathsf{B})X_t=U_t$$
- Como suma ponderada infinita :: (_solo si es estacionario_)
  $$\boldsymbol{X}=\frac{1}{\boldsymbol{\phi}}*\boldsymbol{U}
  \quad\Rightarrow\quad
  X_t=\frac{1}{\boldsymbol{\phi}}(\mathsf{B})U_t$$
#+latex: \bigskip

#+latex: {\bf Comportamiento de las funciones asociadas a los segundo momentos}
#+latex: \medskip

#+latex: \noindent
*ACF ($\boldsymbol{\rho}$):* Grado ($\infty$) y cogrado ($-\infty$): 
@@latex:Combinación de @@ exponenciales y/o sinusoidales amortiguadas.
#+latex: \smallskip

#+latex: \noindent
*PACF ($\boldsymbol{\pi}$):* Grado ($p$) y cogrado ($-p$)
#+latex: \smallskip

#+latex: \noindent
*Densidad espectral* proporcional al inverso de la densidad espectral
de $\boldsymbol{X}=\boldsymbol{\phi}*\boldsymbol{U}$


* Nota final
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . slide)))
   :END:

Se puede demostrar que
- si un proceso tiene una ACF $\boldsymbol{\rho}$ con cogrado $-q$ y grado $q$, es un proceso MA($q$)
- si un proceso tiene una PACF $\boldsymbol{\pi}$ con cogrado $-p$ y grado $p$, es un proceso AR($p$)

Véase /Pourahmadi M. (2001)./
#+latex: \medskip

Consecuentemente, que la ACF o la PACF se corten ``bruscamente'' nos
indica que el modelo es AR o MA (además de su grado).

Desgraciadamente para los modelos ARMA (qué veremos más adelante)
tanto la ACF como la PACF tienen infinitos términos no nulos, por lo
que su identificación no es tan sencilla.



*** COMMENT Ecuaciones de Yule-Walker (que relacionan las autocovarianzas con los parámetros de $\boldsymbol{\phi}$)
   :PROPERTIES:
   :metadata: (slideshow . ((slide_type . skip)))
   :ID:       f2ccd47b-3053-4c09-a332-1a005f50bbe6
   :END:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
Consideremos un proceso AR($p$): $\quad X_t=\sum\limits_{j=1}^p\phi_j
X_{t-j}+U_t;\qquad U_t\sim WN(0,\sigma^2)$ 

#+attr_ipynb: (slideshow . ((slide_type . skip)))
Multiplicando ambos lados por $X_{t-k}$ para $0\leq k\leq p$ y tomando
esperanzas tenemos $$Cov(X_t,X_{t-k})=\sum_{j=1}^p\phi_j
Cov(X_{t-j},X_{t-k})+ Cov(U_t,X_{t-k});\qquad 0\leq k\leq p.$$

#+attr_ipynb: (slideshow . ((slide_type . skip)))
Para $\;k=0\;$ tenemos:
\begin{equation}
  \label{eqYuleW1}
  \sigma^2=\gamma_0-\sum_{j=1}^p\phi_j\gamma_j
\end{equation}
#+latex: puesto que $Cov(U_t,X_{t})=Cov(U_t,\sum_{j=1}^p\phi_j X_{t-j})+Cov(U_t,U_t)=0+\sigma^2$. \medskip

#+attr_ipynb: (slideshow . ((slide_type . skip)))
Para $\;1\leq k\leq p\;$ tenemos:

#+attr_ipynb: (slideshow . ((slide_type . skip)))
\begin{equation}
  \label{eqYuleW2}
  \gamma_k=\sum_{j=1}^p\phi_j\gamma_{k-j}
\end{equation}

#+BEGIN_EXPORT latex
\noindent
O en forma matricial
\[
\begin{bmatrix}
\gamma_{0}&\gamma_{1}&\cdots&\gamma_{p-1}\\ 
\gamma_{1}&\gamma_{0}&\cdots&\gamma_{p-2}\\ 
\vdots&\vdots&\ddots&\vdots\\
\gamma_{p-1}&\gamma_{p-2}&\cdots&\gamma_{0}
\end{bmatrix}
\begin{bmatrix}
\phi_1\\
\phi_2\\
\vdots\\
\phi_p
\end{bmatrix}=
\begin{bmatrix}
\gamma_1\\
\gamma_2\\
\vdots\\
\gamma_p
\end{bmatrix}.
\]
#+END_EXPORT

#+attr_ipynb: (slideshow . ((slide_type . skip)))
Dividiendo [[eqref:eqYuleW1][(1)]] y [[eqref:eqYuleW2][(2)]] por $\gamma_0$ (y operando en ([[ref:eqYuleW1][1]]) tenemos
\begin{equation}
  \label{eqYuleW3}
  \gamma_0=\frac{\sigma^2}{1-\phi_1\rho_1-\cdots-\phi_p\rho_p};
  \qquad
  \rho_k=\phi_1\rho_{k-1}+\cdots+\phi_p\rho_{k-p}
\end{equation}
# \rho_k=\sum_{j=1}^p\phi_j\rho_{k-j}

#+attr_ipynb: (slideshow . ((slide_type . skip)))
#+BEGIN_SRC jupyter-R 
options(repr.plot.width = 12, repr.plot.height = 2, repr.plot.res = 200)
#ma2pn <- um(ma = "(1  -1B + 0.5B^2)")
ma2pn <- um( ma = "(1  +0.6B - .3B^2)")
#ma2pn <- um(ma = "(1  -0B + .64B^2)")
#ma2pn <- um(ma = "(1  - .8B^2)")
display(list(ma2pn), lag.max = 20, byrow = TRUE)
roots(ma2pn)
options(repr.plot.width = 12, repr.plot.height = 5, repr.plot.res = 200)
ide(sim(ma2pn, n = 400), lag.max = 20, graphs = c("plot", "acf", "pacf", "pgram"))
#+END_SRC

#+RESULTS:
:RESULTS:
1. 
   | Real      | Imaginary     | Modulus  | Frequency | Period | Mult. |
   |-----------+---------------+----------+-----------+--------+-------|
   | 3.081666  | 3.831501e-21  | 3.081666 | 0.0       | Inf    | 1     |
   | -1.081666 | -3.831501e-21 | 1.081666 | 0.5       | 2      | 1     |
   #+caption: A matrix: 2 × 6 of type dbl
#+attr_org: :width 1200 :height 200
[[./.ob-jupyter/b62706322fa4715350cff2cff020e72e83f45582.png]]
#+attr_org: :width 1200 :height 500
[[./.ob-jupyter/d0631344b132a62173cc5cf447c5e81ecd1747bc.png]]
:END:

