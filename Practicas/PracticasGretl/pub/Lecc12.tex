% Created 2023-11-27 lun 11:56
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage[spanish, ]{babel}
\usepackage[margin=0.5in]{geometry}
\usepackage[svgnames,x11names]{xcolor}
\hypersetup{linktoc = all, colorlinks = true, urlcolor = DodgerBlue4, citecolor = PaleGreen1, linkcolor = SpringGreen4}
\PassOptionsToPackage{hyphens}{url}
\usepackage{nacal}
\usepackage{framed}
\usepackage{listings}
\input{hansl.tex}
\lstnewenvironment{hansl-gretl}
{\lstset{language={hansl},basicstyle={\ttfamily\footnotesize},numbers,rame=single,breaklines=true}}
{}
\newcommand{\hansl}[1]{\lstset{language={hansl},basicstyle={\ttfamily\small}}\lstinline{#1}}
\lstset{backgroundcolor=\color{lightgray!20}, }
\author{Marcos Bujosa}
\date{\today}
\title{Lección 12}
\begin{document}

\maketitle
\tableofcontents

\clearpage

\section{Precio de casas unifamiliares (tasación de inmobiliarias y características de las viviendas)}
\label{sec:orgba3e995}
\begin{center}
\begin{tabular}{ll}
Guión: & \href{https://github.com/mbujosab/Ectr/tree/master/Practicas/Gretl/scripts/Houses3.inp}{Houses3.inp}\\
\end{tabular}
\end{center}

\begin{enumerate}
\item Objetivo
\label{sec:org8745994}
\begin{itemize}
\item Identificar un problema de multicolinealidad de grado.
\item Estudiar alternativas para evitar dicho problema.
\end{itemize}

\item Para empezar
\label{sec:orgf0199f2}
Para realizar la práctica, primero cargue los datos de la base de
datos de Gretl:

\textbf{\emph{\texttt{Archivo -{}-> Abrir datos -{}-> Archivo de muestra}}} y en la pestaña
\textbf{\emph{\texttt{Wooldrige}}} seleccione \texttt{hprice1}.

{\vspace{0pt} \color{gray!70!black}
\emph{o bien teclee en linea de comandos}:
\begin{verbatim}
open hprice1
\end{verbatim}
}

\item Los datos
\label{sec:org4ee2144}

Ésta es una aplicación con datos reales de casas unifamiliares en EEUU:
\begin{itemize}
\item \textsf{price}  = precio de venta (en miles de \$).
\item \textsf{assess} = tasación de la inmobiliaria (en miles de \$).
\item \textsf{bdrms}  = número de dormitorios.
\item \textsf{lotsize} = tamaño de la parcela en pies al cuadrado.
\item \textsf{sqrft}  = tamaño de la vivienda en pies al cuadrado.
\item \textsf{colonial} = 1 si es de estilo colonial. 0 en el resto de casos.
\end{itemize}

\item El modelo inicial
\label{sec:orgddd968d}
Inicialmente intentaremos emplear todas las variables disponibles para
explicar los precios:
\begin{displaymath}
  \scriptstyle
  \Vect{\VA{price}}\ = \ \beta_1\VAindUno 
  \ +\ \beta_2\Vect{\VA{assess}}
  \ +\ \beta_3\Vect{\VA{bdrms}}
  \ +\ \beta_4\Vect{\VA{lotsize}}
  \ +\ \beta_5\Vect{\VA{sqrft}}
  \ +\ \beta_6\Vect{\VA{colonial}}
  \ +\ \Vect{\per}
\end{displaymath}
\end{enumerate}

\subsection{Actividad 1}
\label{sec:orgf7d87e7}
Piense si alguna de las variables disponibles debería salir del
modelo, por no ser relevante en la determinación del precio de la
vivienda.
\subsection{Actividad 2}
\label{sec:org40468cd}
Piense cuáles son los signos esperados de los parámetros del modelo.

\subsection{Actividad 3}
\label{sec:orgab38ba5}
Ajuste por MCO el modelo:
\begin{displaymath}
  \scriptstyle
  \Vect{price}\ = \
       \Estmc{\beta_1}\Vect{1}
  \ +\ \Estmc{\beta_2}\Vect{assess}
  \ +\ \Estmc{\beta_3}\Vect{bdrms}
  \ +\ \Estmc{\beta_4}\Vect{lotsize}
  \ +\ \Estmc{\beta_5}\Vect{sqrft}
  \ +\ \Estmc{\beta_6}\Vect{colonial}
  \ +\ \res
\end{displaymath}

{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
Modelo1     <- ols price 0 assess bdrms lotsize sqrft colonial
\end{verbatim}
}

\begin{itemize}
\item ¿Qué variables son significativas en este modelo?  ¿Coincide esto con su previsión?
\item A la luz de esta primera regresión. ¿Las inmobiliarias infravaloran o sobrevaloran los inmuebles?
\end{itemize}

\subsection{Actividad 4}
\label{sec:orgbf0a016}
¡Sorprendentemente parece que las características del inmueble no son
significativas para explicar el precio!

¿Es conjuntamente significativo este modelo para ``explicar'' los
precios? Observe el estadístico F.

\subsection{Actividad 5}
\label{sec:org5d09456}
Si hay una estrecha relación lineal entre regresores, es difícil
discriminar el papel particular de cada uno. Esta incertidumbre se
refleja en la varianza de los estimadores.

Consecuentemente algunas variables, en teoría importantes, pueden
resultar estadísticamente no significativas.

Las inmobiliarias emplean las características del inmueble para
arrojar una tasación. Así, es muy probable una estrecha relación entre
las características y la tasación.

\begin{itemize}
\item Observe los diagramas de dispersión de las variables de cada
\end{itemize}
casa con su tasación

\textbf{\emph{\texttt{Ver -{}-> Gráficos múltiples}}} y elija \texttt{assess} como variable del
eje \texttt{y}, y el resto como variables del eje \texttt{X}.
{\vspace{0pt} \color{gray!70!black}
\emph{o bien teclee en linea de comandos}:
\begin{verbatim}
Diagramas   <- scatters bdrms lotsize sqrft colonial ; assess --output="display"
\end{verbatim}
}

\subsection{Actividad 6}
\label{sec:org335d2b6}
Analice la correlación entre \texttt{assess} y el resto de regresores.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
corr assess bdrms lotsize sqrft colonial
\end{verbatim}
}

\subsection{Actividad 7}
\label{sec:orga7f87f7}

\begin{itemize}
\item La colinealidad se debe a que la muestra no contiene información
suficiente para estimar con una precisión satisfactoria todos los
parámetros.

\item Las soluciones directas a este problema consisten en

\begin{itemize}
\item añadir información (en este caso no podemos)
\item simplificar el modelo
\item También es posible eliminar información redundante mediante
regresiones auxiliares
\end{itemize}
\end{itemize}

Mejor que analizar relaciones lineales entre pares (correlaciones) es
estudiar si las características de la casa explican en un modelo
lineal la valoración de las inmobiliarias. 
\begin{itemize}
\item Ajuste por MCO el siguiente modelo
\begin{displaymath}
  \Vect{assess}\ = \
       \Estmc{\beta_1}\Vect{1} 
  \ +\ \Estmc{\beta_2}\Vect{bdrms}
  \ +\ \Estmc{\beta_3}\Vect{lotsize}
  \ +\ \Estmc{\beta_4}\Vect{sqrft}
  \ +\ \Estmc{\beta_5}\Vect{colonial}
  \ +\ \res
\end{displaymath}
\end{itemize}

{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloAux   <- ols assess 0 bdrms lotsize sqrft colonial
\end{verbatim}
}

\begin{itemize}
\item Observe el coeficiente de determinación para comprobar hasta que
punto las características de las vivienda en su conjunto
``explican'' la tasación de la inmobiliaria.

\item ¿Qué variables son más significativas para explicar la tasación?
\end{itemize}

\subsection{Actividad 8 - Eliminando información redundante}
\label{sec:org39c6f7b}

\begin{enumerate}
\item Las inmobiliarias suelen tener conocimiento del estado de
conservación de la vivienda, su antigüedad, su situación,
orientación, calidades, estética, etc. Todas estas características
habrán sido tenidas en cuenta en las tasaciones, pero están
mezcladas con las otras características explícitamente incluidas en
el modelo. Ello explica que un 30\% de la variabilidad de \texttt{assess}
no es explicada por el resto de regresores, pero si el 70\%
restante.

\item Los errores de ajuste por MCO son ortogonales a los
regresores. Así, los errores de la última regresión corresponden a
todos esos factores que han intervenido en la tasación, pero que
son ortogonales a los regresores del modelo.

\item En el modelo principal, omitiendo \texttt{assess} pero incluyendo como
regresor los errores de esta última regresión, incorporamos
información sobre la tasación que es ortogonal al resto de
regresores
\end{enumerate}

Guarde los residuos de la ultima regresión: En la ventana de la
regresión auxiliar, pinche en \textbf{\emph{\texttt{Guardar -{}-> Residuos}}} y y ponga
como nombre \texttt{OtrosFactores}.

{\vspace{0pt} \color{gray!70!black}
\emph{o bien teclee en linea de comandos}:
\begin{verbatim}
OtrosFactTasac = $uhat
\end{verbatim}
}

\begin{itemize}
\item Ajuste por MCO el modelo:
\begin{displaymath}
  \scriptstyle
  \Vect{price}\ = \
       \Estmc{\beta_1}\Vect{1} 
  \ +\ \Estmc{\beta_2}\Vect{bdrms}
  \ +\ \Estmc{\beta_3}\Vect{lotsize}
  \ +\ \Estmc{\beta_4}\Vect{sqrft}
  \ +\ \Estmc{\beta_5}\Vect{colonial}
  \ +\ \Estmc{\beta_6}\Vect{OtrosFactores} \ +\ \res
\end{displaymath}
\end{itemize}

{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
Modelo2     <- ols price 0 bdrms lotsize sqrft colonial OtrosFactTasac
\end{verbatim}
}


\begin{itemize}
\item ¿Hay indicios de multicolinealidad?

\item Compare el ajuste de este modelo con el del modelo inicial.

\item Omita las variables no significativas al 1\% para obtener un modelo final.
\end{itemize}

{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloFinal <- omit --auto=0.01
\end{verbatim}
}

\vspace{10pt}
\noindent
\textbf{Código completo de la práctica}
\vspace{10pt}
\lstinputlisting{scripts/Houses3.inp}
\clearpage


\section{Construcción de vivienda nueva}
\label{sec:org7f5aa1a}
\begin{center}
\begin{tabular}{ll}
Guión: & \href{https://github.com/mbujosab/Ectr/tree/master/Practicas/Gretl/scripts/RamanathanEX5-1.inp}{RamanathanEX5-1.inp}\\
\end{tabular}
\end{center}

Usando \texttt{data4-3.gdt} del libro de Ramanathan, con el nº de viviendas
iniciadas (en miles) en los EEUU (\texttt{housing}), población (\texttt{pop}), PIB
en miles de millones de dólares con base en el año 1982 (\texttt{gnp}) y tipo
de interés del crédito hipotecario (\texttt{intrate}):
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
open data4-3.gdt
\end{verbatim}
}

\begin{itemize}
\item Estime el siguiente modelo \texttt{ModeloA} y añádalo a la tabla de modelos
\begin{displaymath}
  housing_{n} = \alpha_1 + \alpha_2\cdot intrate_n +  \alpha_3 \cdot pop_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloA <- ols housing 0 intrate pop
modeltab add
\end{verbatim}
}
\end{itemize}


\begin{itemize}
\item Estime el siguiente modelo \texttt{ModeloB} y añádalo a la tabla de modelos
\begin{displaymath}
  housing_{n} = \beta_1 + \beta_2\cdot intrate_n +  \beta_3 \cdot gnp_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloB <- ols housing 0 intrate gnp
modeltab add
\end{verbatim}
}

\item Estime el siguiente modelo \texttt{ModeloC} y añádalo a la tabla de modelos
\begin{displaymath}
  housing_{n} = \gamma_1 + \gamma_2\cdot intrate_n +  \gamma_3 \cdot pop_n +  \gamma_4 \cdot gnp_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloC <- ols housing 0 intrate pop gnp
modeltab add
\end{verbatim}
}

\item Compare los resultados.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
modeltab show
\end{verbatim}
}

\item Realice un contraste de colinealidad entre regresores (\texttt{vif}).
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
vif
\end{verbatim}
}

\item Contraste la significatividad conjunta de \texttt{gnp} y =pop en \texttt{ModeloC}.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
omit pop gnp
modeltab add
scalar estadF  = $test
scalar pvalorF = pvalue(F, 2, ModeloC.$df, estadF)
\end{verbatim}
}

\item Compare los 4 modelos y mire las correlaciones entre los tres regresores.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
modeltab show
corr intrate pop gnp
\end{verbatim}
}
\end{itemize}

\vspace{10pt}
\noindent
\textbf{Código completo de la práctica}
\vspace{10pt}
\lstinputlisting{scripts/RamanathanEX5-1.inp}
\clearpage


\section{Construcción de vivienda nueva (transformación a datos per-cápita)}
\label{sec:org73c5a83}
\begin{center}
\begin{tabular}{ll}
Guión: & \href{https://github.com/mbujosab/Ectr/tree/master/Practicas/Gretl/scripts/RamanathanEX5-1v2.inp}{RamanathanEX5-1v2.inp}\\
\end{tabular}
\end{center}

Abra el conjunto de datos \texttt{data4-3.gdt} del libro de Ramanathan, con
el nº de viviendas iniciadas (en miles) en los EEUU (\texttt{housing}),
población (\texttt{pop}), PIB en miles de millones de dólares con base en el
año 1982 (\texttt{gnp}) y tipo de interés del crédito hipotecario
(\texttt{intrate}):
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
open data4-3.gdt
\end{verbatim}
}

\begin{itemize}
\item Estime de nuevo el siguiente modelo (que por la práctica anterior sabemos que tiene multicolinealidad)
\begin{displaymath}
  housing_{n} = \gamma_1 + \gamma_2\cdot intrate_n +  \gamma_3 \cdot pop_n +  \gamma_4 \cdot gnp_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloMCol <- ols housing 0 intrate pop gnp
\end{verbatim}
}

\item Defina la construcción de viviendas per-cápita
( \texttt{housingPC = housing/pop} ) y la correspondiente producción
per-cápita ( \texttt{gnpPC} ); y estime el siguiente modelo
\begin{displaymath}
  housingPC_{n} = \beta_1 + \beta_2\cdot intrate_n +  \beta_3 \cdot gnpPC_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
series housingPC = housing/pop
series gnpPC     = gnp/pop
ModeloPC <- ols housingPC 0 intrate gnpPC 
\end{verbatim}
}

\item Compare los resultados. Como estos dos modelos tienen distinto
regresando, no es posible incorporar ambos a una misma tabla de
modelos. Para compararlos abra las correspondientes ventanas de
estimación.

\item Mire las correlaciones entre los nuevos regresores y compárelas con las del antiguo modelo.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
corr gnp   intrate
corr gnpPC intrate
\end{verbatim}
}

\item Realice un contraste de colinealidad \texttt{vif} entre regresores en ambos modelos.

(\emph{la función \texttt{vif} se debe ejecutar justo después de estimar cada modelo}).
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ols housing   0 intrate gnp   pop
vif

ols housingPC 0 intrate gnpPC 
vif
\end{verbatim}
}
\end{itemize}

\clearpage
\vspace{10pt}
\noindent
\textbf{Código completo de la práctica}
\vspace{10pt}
\lstinputlisting{scripts/RamanathanEX5-1v2.inp}
\clearpage


\section{Gastos de mantenimiento de los automóviles}
\label{sec:org97c5874}
\begin{center}
\begin{tabular}{ll}
Guión: & \href{https://github.com/mbujosab/Ectr/tree/master/Practicas/Gretl/scripts/RamanathanEX5-2.inp}{RamanathanEX5-2.inp}\\
\end{tabular}
\end{center}

(\emph{La siguiente práctica reproduce el ejemplo 5.2 del libro de Ramanathan.})

Abra el conjunto de datos \texttt{data3-7.gdt}, del libro de Ramanathan,
sobre costes de mantenimiento de coches Toyota (\texttt{cost}), así como la
edad de cada coche en semanas (\texttt{age}) y en número de millas recorridas
(\texttt{miles}).
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
open data3-7.gdt
\end{verbatim}
}

\begin{itemize}
\item Mire las correlaciones entre los dos regresores.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
corr age miles
\end{verbatim}
}

\item Estime el siguiente modelo \texttt{ModeloA} y añádalo a la tabla de
modelos
\begin{displaymath}
  cost_{n} = \alpha_1 + \alpha_2\cdot age_n +  otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloA <- ols cost 0 age
modeltab add
\end{verbatim}
}

\item Estime el siguiente modelo \texttt{ModeloB} y añádalo a la tabla de modelos
\begin{displaymath}
  cost_{n} = \beta_1 +  \beta_2 \cdot miles_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloB <- ols cost 0 miles
modeltab add
\end{verbatim}
}

\item Estime el siguiente modelo \texttt{ModeloC} y añádalo a la tabla de modelos
\begin{displaymath}
  cost_{n} = \gamma_1 + \gamma_2\cdot age_n + \gamma_4 \cdot miles_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloC <- ols cost 0 age miles
modeltab add
\end{verbatim}
}

\item Compare los resultados.

Fíjese que aunque \texttt{age} y \texttt{miles} son siempre significativas, el
efecto de los regresores cambia mucho en el último modelo respecto a
los resultados de los dos primeros modelos y, de hecho, el signo
para \texttt{miles} en el último modelo contradice al sentido común.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
modeltab show
\end{verbatim}
}

\item Realice un contraste de colinealidad entre regresores. Dibuje un
diagrama de dispersión entre \texttt{miles} y \texttt{age}, y mire la correlación
entre ambas variables.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
vif
scatters miles; age --output="display"
rho = corr(miles, age)
\end{verbatim}
}

\item Contraste la significatividad conjunta de \texttt{miles} y \texttt{age} en
\texttt{ModeloC}.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
scalar estadF  = $Fstat
scalar pvalorF = pvalue(F, 2, ModeloC.$df, estadF)
\end{verbatim}
}

\item La serie de errores absolutos de predicción (APE) se calcula como
\begin{displaymath}
  ape_n=100
  \begin{vmatrix}
    \frac{\resi{n}}{y_n}
  \end{vmatrix}
\end{displaymath}
Calcule la serie de errores absolutos de predicción de cada modelo.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
# Error porcentual absoluto (ape)
series apeA = 100*abs(ModeloA.$uhat)/cost
series apeB = 100*abs(ModeloB.$uhat)/cost
series apeC = 100*abs(ModeloC.$uhat)/cost
\end{verbatim}
}

\item Calcule los errores absolutos de predicción medios (MAPE) de cada
modelo. ¿Qué modelo predice mejor?

Los errores absolutos medios de predicción (MAPE) son:
\begin{itemize}
\item \(mapeA =  227,75136\)
\item \(mapeB =  278,19832\)
\item \(mapeC =  48,240362\)
\end{itemize}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
# Error porcentual absoluto medio 
scalar mapeA = mean(apeA)
scalar mapeB = mean(apeB)
scalar mapeC = mean(apeC)
print mapeA mapeB mapeC
\end{verbatim}
}
\end{itemize}

\clearpage
\vspace{10pt}
\noindent
\textbf{Código completo de la práctica}
\vspace{10pt}
\lstinputlisting{scripts/RamanathanEX5-2.inp}
\clearpage


\section{Gastos de mantenimiento de los automóviles (ortogonalización de regresores mediante regresiones auxiliares)}
\label{sec:org193f6d4}
\begin{center}
\begin{tabular}{ll}
Guión: & \href{https://github.com/mbujosab/Ectr/tree/master/Practicas/Gretl/scripts/RamanathanEX5-2v2.inp}{RamanathanEX5-2v2.inp}\\
\end{tabular}
\end{center}

Abra el conjunto de datos \texttt{data3-7.gdt}, del libro de Ramanathan,
sobre costes de mantenimiento de coches Toyota (\texttt{cost}), así como la
edad de cada coche en semanas (\texttt{age}) y en número de millas recorridas
(\texttt{miles}).
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
open data3-7.gdt
\end{verbatim}
}

\begin{itemize}
\item Estime el siguiente modelo \texttt{ModeloA}
\begin{displaymath}
  cost_{n} = \alpha_1 + \alpha_2\cdot age_n +  otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloA      <- ols cost 0 age
modeltab add
\end{verbatim}
}

\item Realice una regresión auxiliar de \texttt{miles} sobre una constante y
\texttt{age}. Guarde los residuos con el nombre \texttt{uhatMiles}.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
AuxRegA      <- ols miles const age
series uhatMiles = $uhat
\end{verbatim}
}

Piense qué interpretación tienen los residuos de esta regresión
auxiliar.

{\color{gray!70!black} \small
\texttt{uhatMiles} es la parte de las millas recorridas que no se
puede aproximar por la edad del coche (algo así como un indicador de
la intensidad de uso del coche).
}

\item Verifique que no hay correlación entre los residuos de esta
regresión auxiliar (\texttt{uhatMiles}) y \texttt{age}. ¿Por qué?
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
corr uhatMiles age
\end{verbatim}
}

\item Estime el siguiente modelo \texttt{ModeloA\_Raux}
\begin{displaymath}
  cost_{n} = \alpha_1 + \alpha_2\cdot age_n +  \alpha_3\cdot uhatMiles_n + otros\ factores_n
\end{displaymath}
y compare los resultados con el \texttt{ModeloA}. Realice un test de
colinealidad para el modelo \texttt{ModeloA\_Raux}. ¿Hay indicios de
colinealidad?
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloA_Raux <- ols cost 0 age uhatMiles
modeltab add
vif
\end{verbatim}
}

\item Estime el siguiente modelo \texttt{ModeloB}
\begin{displaymath}
  cost_{n} = \beta_1 +  \beta_2 \cdot miles_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloB      <- ols cost 0 miles
modeltab add
\end{verbatim}
}

\item Realice una regresión auxiliar de \texttt{age} sobre una constante y
\texttt{miles}. Guarde los residuos con el nombre \texttt{uhatAge}.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
AuxRegB      <- ols age 0 miles
series uhatAge   = $uhat
\end{verbatim}
}

\item Estime el siguiente modelo \texttt{ModeloB\_Raux}
\begin{displaymath}
  cost_{n} = \beta_1 +  \beta_2 \cdot miles_n + \beta_3 \cdot uhatAge_n + otros\ factores_n 
\end{displaymath}
y compare los resultados con el \texttt{ModeloB}. Realice un test de
colinealidad para el modelo \texttt{ModeloB\_Raux}. ¿Hay indicios de
colinealidad?
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloB_Raux <- ols cost 0 miles uhatAge
modeltab add
vif
\end{verbatim}
}

\item Piense qué interpretación tiene el regresor \texttt{uhatAge} en esta
regresión.

{\color{gray!90!black} \small
El regresor \texttt{uhatAge} reflejará la parte del coste de
mantenimiento debido al mero paso del tiempo (pues ya hemos
descontado el uso del coche). Es una medida por el deterioro de
coche por el simple paso del tiempo.
}

\item Estime el siguiente modelo \texttt{ModeloC} 
\begin{displaymath}
  cost_{n} = \gamma_1 + \gamma_2\cdot age_n + \gamma_4 \cdot miles_n + otros\ factores_n
\end{displaymath}
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloC      <- ols cost 0 age miles
modeltab add
\end{verbatim}
}

\item Compare los resultados de los cinco modelos.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
modeltab show
\end{verbatim}
}

\item Piense qué signos serian los esperados para los coeficientes y
decida qué modelo prefiere.

{\color{gray!90!black} \small
En el cuarto modelo \texttt{ModeloB\_Raux} todos los regresores
(incluido \texttt{uhatAge}) tiene una interpretación natural;
además, en ese modelo los regresores son significativos y con los
signos esperados.

Nótese que como tanto el \texttt{ModeloC} como los dos con
regresiones auxiliares emplean la misma información (las mismas
variables), los tres tiene estadísticos de selección de modelos
idénticos. El ajuste es igual de bueno en los tres casos, aunque la
interpretación de los coeficientes estimados difiere.
}
\end{itemize}

\clearpage
\vspace{10pt}
\noindent
\textbf{Código completo de la práctica}
\vspace{10pt}
\lstinputlisting{scripts/RamanathanEX5-2v2.inp}
\clearpage


\section{Pobreza y sus determinantes (omisión de variables)}
\label{sec:org26d1b09}
\begin{center}
\begin{tabular}{ll}
Guión: & \href{https://github.com/mbujosab/Ectr/tree/master/Practicas/Gretl/scripts/RamanathanAp5-4.inp}{RamanathanAp5-4.inp}\\
\end{tabular}
\end{center}

Abra el conjunto de datos \texttt{data4-6.gdt}, del libro de Ramanathan,
sobre el porcentaje de familias con una renta por debajo del nivel de
pobreza (\texttt{povrate}) en los condados de California. Intentaremos
explicar dicho porcentaje con las siguientes variables: \texttt{urb} es el
porcentaje de población urbana; \texttt{famsize} es el número medio de
personas por hogar, \texttt{unemp} es la tasa de desempleo, \texttt{highschl} es el
porcentaje de población mayor de 25 que ha completado el ``high
school'', \texttt{college} es el porcentaje de la población mayor de 25 que
ha completado 4 o más años de ``college'', y \texttt{medinc} es la renta
media familiar.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
open data4-6.gdt
\end{verbatim}
}

\begin{itemize}
\item Observe la correlación entre las variables explicativas
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
corr urb famsize unemp highschl college medinc
\end{verbatim}
}

\item Estime el modelo ``ModeloA'' con todas las variables explicativas.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloA <- ols povrate const urb famsize unemp highschl college medinc
\end{verbatim}
}

\item Observe los elevados \emph{p}-valores de algunas variables. Observe
también el inesperado signo para \texttt{college}\dots{} ¿quizá es debido a
un problema de multicolinealidad?

\item Omita la variable menos significativa del modelo (la de mayor
\emph{p}-valor). Observe que prácticamente no hay cambios en el
resultado.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloB <- omit unemp
\end{verbatim}
}

\item Omita la siguiente variable menos significativa. Observe que ahora
todas las variables son significativas, pero se mantiene el signo
equivocado para la variable ``college''.  Esto sugiere la
posibilidad de multicolinealidad; realice el correspondiente
contraste \texttt{vif}.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloC <- omit urb
vif
\end{verbatim}
}

\item Aunque la variable de renta familiar media (\texttt{medinc}) es la más
significativa, cabe esperar que su efecto pueda ser aproximadamente
explicado por las variables \texttt{highschl} y \texttt{college}. Pruebe a excluir
dicha variable y compruebe que ahora el signo de \texttt{college} es
adecuado.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ModeloD <- omit medinc
\end{verbatim}
}

\item Realice una regresión auxiliar de \texttt{medinc} sobre \texttt{famsize}, \texttt{unemp},
\texttt{highschl} y \texttt{college} y compruebe que dichas variables explican
casi el 85\% de la varianza de \texttt{medinc}. Quizá una solución es omitir
dicha variable desde el principio, para poder captar adecuadamente
el efecto de las demás variables.
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
Aux     <- ols medinc 0 famsize unemp highschl college
\end{verbatim}
}

\item Estime un modelo con todas las variables explicativas excepto
\texttt{medinc}, y siga un procedimiento de eliminación secuencial de
variables no significativas. ¿Es satisfactorio el modelo final?
{\vspace{0pt} \color{gray!70!black}
\begin{verbatim}
ols povrate const urb famsize unemp highschl college
Final   <- omit --auto
\end{verbatim}
}
\end{itemize}


\vspace{10pt}
\noindent
\textbf{Código completo de la práctica}
\vspace{10pt}
\lstinputlisting{scripts/RamanathanAp5-4.inp}
\clearpage
\end{document}